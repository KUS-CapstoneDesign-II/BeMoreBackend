# ğŸ“˜ Phase 3: CBT ë¶„ì„ ìƒì„¸ êµ¬í˜„ ê°€ì´ë“œ

> **Cognitive Behavioral Therapy (CBT)** ì¸ì§€í–‰ë™ì¹˜ë£Œ ê¸°ë°˜ ì¸ì§€ ì™œê³¡ íƒì§€ ë° ì¹˜ë£Œì  ê°œì…

**ì‘ì„±ì¼**: 2025-01-17
**ëŒ€ìƒ Phase**: Phase 3 (CBT Analysis)
**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 12-16ì‹œê°„
**ë‚œì´ë„**: â­â­â­â­â­ (ìµœê³ ê¸‰)

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ì‚¬ì „ ì¤€ë¹„ì‚¬í•­](#ì‚¬ì „-ì¤€ë¹„ì‚¬í•­)
3. [Task 3.1: ì¸ì§€ ì™œê³¡ íƒì§€ ì‹œìŠ¤í…œ](#task-31-ì¸ì§€-ì™œê³¡-íƒì§€-ì‹œìŠ¤í…œ)
4. [Task 3.2: ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸ ìƒì„±](#task-32-ì†Œí¬ë¼í…ŒìŠ¤ì‹-ì§ˆë¬¸-ìƒì„±)
5. [Task 3.3: í–‰ë™ ê³¼ì œ ì¶”ì²œ](#task-33-í–‰ë™-ê³¼ì œ-ì¶”ì²œ)
6. [Task 3.4: ì¹˜ë£Œì  ê°œì… í†µí•©](#task-34-ì¹˜ë£Œì -ê°œì…-í†µí•©)
7. [í†µí•© í…ŒìŠ¤íŠ¸](#í†µí•©-í…ŒìŠ¤íŠ¸)
8. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## ê°œìš”

### Phase 3ì˜ ëª©í‘œ

Phase 2ì—ì„œ êµ¬ì¶•í•œ ë©€í‹°ëª¨ë‹¬ ë¶„ì„(í‘œì • + ìŒì„± + STT) ìœ„ì— **CBT (Cognitive Behavioral Therapy)** ê¸°ë°˜ ì‹¬ë¦¬ ì¹˜ë£Œ ê¸°ëŠ¥ì„ í†µí•©í•©ë‹ˆë‹¤.

**í•µì‹¬ ê¸°ëŠ¥**:
1. **10ê°€ì§€ ì¸ì§€ ì™œê³¡**: íŒŒêµ­í™”, í‘ë°±ë…¼ë¦¬, ê³¼ì¼ë°˜í™” ë“± ìë™ íƒì§€
2. **ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸**: ì¸ì§€ ì¬êµ¬ì¡°í™”ë¥¼ ìœ„í•œ ì§ˆë¬¸ ìë™ ìƒì„±
3. **í–‰ë™ ê³¼ì œ**: êµ¬ì²´ì ì¸ ì¹˜ë£Œ ê³¼ì œ ì¶”ì²œ
4. **ì‹¤ì‹œê°„ ê°œì…**: ìƒë‹´ ì¤‘ ì¹˜ë£Œì  ê°œì… ì œì•ˆ

### ì•„í‚¤í…ì²˜ ë³€í™”

```mermaid
graph TB
    subgraph "ì…ë ¥ ë°ì´í„°"
        A[STT í…ìŠ¤íŠ¸]
        B[ê°ì • ë¶„ì„ ê²°ê³¼]
        C[VAD ë©”íŠ¸ë¦­]
    end

    subgraph "CBT ë¶„ì„ ì—”ì§„"
        D[ì¸ì§€ ì™œê³¡ íƒì§€ê¸°]
        E[íŒ¨í„´ ë§¤ì¹­]
        F[ì‹¬ê°ë„ í‰ê°€]
    end

    subgraph "ê°œì… ìƒì„±"
        G[ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸]
        H[í–‰ë™ ê³¼ì œ]
        I[ì¹˜ë£Œì  í”¼ë“œë°±]
    end

    subgraph "Gemini AI í†µí•©"
        J[ì»¨í…ìŠ¤íŠ¸ ë¶„ì„]
        K[ë§ì¶¤í˜• ê°œì… ìƒì„±]
        L[ê²€ì¦ ë° í•„í„°ë§]
    end

    A --> D
    B --> F
    C --> F
    D --> E
    E --> F
    F --> G
    F --> H
    F --> I
    G --> J
    H --> J
    I --> J
    J --> K
    K --> L
    L --> M[/ws/sessionìœ¼ë¡œ ì „ì†¡]
```

### 10ê°€ì§€ ì¸ì§€ ì™œê³¡ (Beck's Cognitive Distortions)

| ë²ˆí˜¸ | ì™œê³¡ ìœ í˜• | ì„¤ëª… | ì˜ˆì‹œ |
|------|----------|------|------|
| 1 | **íŒŒêµ­í™”** (Catastrophizing) | ìµœì•…ì˜ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê°€ì • | "ì‹œí—˜ ë§ì¹˜ë©´ ì¸ìƒ ëì´ì•¼" |
| 2 | **í‘ë°±ë…¼ë¦¬** (All-or-Nothing) | ê·¹ë‹¨ì  ì´ë¶„ë²• ì‚¬ê³  | "ì™„ë²½í•˜ì§€ ì•Šìœ¼ë©´ ì‹¤íŒ¨ì•¼" |
| 3 | **ê³¼ì¼ë°˜í™”** (Overgeneralization) | í•œ ë²ˆì˜ ì‚¬ê±´ì„ ì¼ë°˜í™” | "í•­ìƒ ë‚˜ëŠ” ì‹¤íŒ¨í•´" |
| 4 | **ì •ì‹ ì  ì—¬ê³¼** (Mental Filter) | ë¶€ì •ì  ì¸¡ë©´ë§Œ ì§‘ì¤‘ | "ì¹­ì°¬ì€ ë¬´ì‹œí•˜ê³  ë¹„ë‚œë§Œ ê¸°ì–µ" |
| 5 | **ê¸ì • ë¶€ì¸** (Disqualifying Positive) | ê¸ì •ì  ê²½í—˜ ë¬´ì‹œ | "ìš´ì´ ì¢‹ì•˜ì„ ë¿ì´ì•¼" |
| 6 | **ì„±ê¸‰í•œ ê²°ë¡ ** (Jumping to Conclusions) | ì¦ê±° ì—†ì´ ë¶€ì •ì  í•´ì„ | "ê·¸ê°€ ë‚  ì‹«ì–´í•  ê±°ì•¼" |
| 7 | **í™•ëŒ€/ì¶•ì†Œ** (Magnification/Minimization) | ì¤‘ìš”ë„ ì™œê³¡ | "ë‚´ ì‹¤ìˆ˜ëŠ” í¬ê³  ì„±ì·¨ëŠ” ì‘ì•„" |
| 8 | **ê°ì •ì  ì¶”ë¡ ** (Emotional Reasoning) | ê°ì •ì„ ì‚¬ì‹¤ë¡œ ê°„ì£¼ | "ë¶ˆì•ˆí•˜ë‹ˆê¹Œ ìœ„í—˜í•œ ê±°ì•¼" |
| 9 | **ë‹¹ìœ„ì  ì‚¬ê³ ** (Should Statements) | ê²½ì§ëœ ê·œì¹™ ì ìš© | "ë‚˜ëŠ” ~í•´ì•¼ë§Œ í•´" |
| 10 | **ë‚™ì¸ì°ê¸°** (Labeling) | ë¶€ì •ì  ìê¸° ì •ì˜ | "ë‚˜ëŠ” ì‹¤íŒ¨ìì•¼" |

---

## ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

### 1. Node.js ì˜ì¡´ì„± ì„¤ì¹˜

```bash
# ìì—°ì–´ ì²˜ë¦¬
npm install natural
npm install compromise

# ê°ì • ë¶„ì„ (ì˜ì–´)
npm install sentiment

# í•œêµ­ì–´ í˜•íƒœì†Œ ë¶„ì„ (ì„ íƒ)
npm install koalanlp

# í…ìŠ¤íŠ¸ ìœ ì‚¬ë„
npm install string-similarity
```

### 2. ë””ë ‰í† ë¦¬ êµ¬ì¡°

```bash
services/
â”œâ”€â”€ cbt/
â”‚   â”œâ”€â”€ CognitiveDistortionDetector.js   # ìƒì„± ì˜ˆì •
â”‚   â”œâ”€â”€ SocraticQuestioner.js            # ìƒì„± ì˜ˆì •
â”‚   â”œâ”€â”€ BehavioralTaskRecommender.js     # ìƒì„± ì˜ˆì •
â”‚   â”œâ”€â”€ InterventionGenerator.js         # ìƒì„± ì˜ˆì •
â”‚   â””â”€â”€ patterns/
â”‚       â”œâ”€â”€ catastrophizing.json         # íŒ¨í„´ ë°ì´í„°
â”‚       â”œâ”€â”€ all-or-nothing.json
â”‚       â””â”€â”€ ... (10ê°œ íŒŒì¼)
â””â”€â”€ gemini/
    â””â”€â”€ gemini.js                        # ì—…ë°ì´íŠ¸ ì˜ˆì •
```

### 3. í™˜ê²½ ë³€ìˆ˜

`.env` íŒŒì¼ì— ì¶”ê°€:

```bash
# CBT ì„¤ì •
CBT_DETECTION_THRESHOLD=0.6       # ì¸ì§€ ì™œê³¡ íƒì§€ ì„ê³„ê°’
CBT_INTERVENTION_FREQUENCY=3      # 3íšŒ íƒì§€ ì‹œ ê°œì…
CBT_LANGUAGE=ko                   # í•œêµ­ì–´

# Gemini CBT ì „ìš© ëª¨ë¸
GEMINI_CBT_MODEL=gemini-2.5-flash
GEMINI_CBT_TEMPERATURE=0.7        # ì°½ì˜ì  ì§ˆë¬¸ ìƒì„±
```

---

## Task 3.1: ì¸ì§€ ì™œê³¡ íƒì§€ ì‹œìŠ¤í…œ

### 3.1.1 íŒ¨í„´ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±

**íŒŒì¼**: `services/cbt/patterns/catastrophizing.json`

```json
{
  "type": "catastrophizing",
  "name_ko": "íŒŒêµ­í™”",
  "name_en": "Catastrophizing",
  "description": "ìµœì•…ì˜ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê°€ì •í•˜ê±°ë‚˜ ìƒí™©ì„ ê³¼ë„í•˜ê²Œ ë¶€ì •ì ìœ¼ë¡œ í•´ì„í•˜ëŠ” ì‚¬ê³  íŒ¨í„´",
  "keywords": [
    "ëì´ì•¼", "ë§í–ˆì–´", "ìµœì•…", "ì ˆë§", "ì£½ì„ ê²ƒ ê°™ì•„",
    "ì‚´ ìˆ˜ ì—†ì–´", "ë¶ˆê°€ëŠ¥", "ì•„ë¬´ê²ƒë„", "ì „ë¶€", "ì˜ì›íˆ",
    "ë‹¤ ëë‚¬ì–´", "ë§ì³¤ì–´", "ì¬ì•™", "íŒŒë©¸"
  ],
  "patterns": [
    {
      "regex": "(ì‹œí—˜|ë°œí‘œ|ë©´ì ‘).*(ë§|ì‹¤íŒ¨).*(ì¸ìƒ|ë|ë¯¸ë˜)",
      "severity": "high",
      "example": "ì‹œí—˜ ë§ì¹˜ë©´ ì¸ìƒ ëì´ì•¼"
    },
    {
      "regex": "(ì´ë²ˆì—).*(ì•ˆ|ëª»).*(ë˜ë©´|í•˜ë©´).*(ë‹¤|ëª¨ë‘|ì „ë¶€).*(ë|ë§)",
      "severity": "high",
      "example": "ì´ë²ˆì— ì•ˆ ë˜ë©´ ë‹¤ ëì´ì•¼"
    },
    {
      "regex": "ìµœì•…|íŒŒêµ­|ì¬ì•™|ì ˆë§|ëì¥",
      "severity": "medium",
      "example": "ì´ê±´ ìµœì•…ì˜ ìƒí™©ì´ì•¼"
    },
    {
      "regex": "(ì ˆëŒ€|ì˜ì›íˆ).*(ì•ˆ|ëª»).*(ë |í• )",
      "severity": "medium",
      "example": "ì ˆëŒ€ ì•ˆ ë  ê±°ì•¼"
    }
  ],
  "psychological_impact": "ë¶ˆì•ˆ, ìš°ìš¸, ë¬´ê¸°ë ¥, íšŒí”¼",
  "intervention_priority": "high"
}
```

**íŒŒì¼**: `services/cbt/patterns/all-or-nothing.json`

```json
{
  "type": "all-or-nothing",
  "name_ko": "í‘ë°±ë…¼ë¦¬",
  "name_en": "All-or-Nothing Thinking",
  "description": "ì¤‘ê°„ ì§€ëŒ€ ì—†ì´ ê·¹ë‹¨ì  ì´ë¶„ë²•ìœ¼ë¡œ ìƒí™©ì„ íŒë‹¨í•˜ëŠ” ì‚¬ê³  íŒ¨í„´",
  "keywords": [
    "ì™„ë²½", "ì „ë¶€", "ì•„ë¬´ê²ƒë„", "í•­ìƒ", "ì ˆëŒ€", "ì „í˜€",
    "ëª¨ë‘", "í•˜ë‚˜ë„", "100%", "0%", "ì„±ê³µ", "ì‹¤íŒ¨"
  ],
  "patterns": [
    {
      "regex": "ì™„ë²½.*(ì•„ë‹ˆ|ëª»).*(ì‹¤íŒ¨|ì“¸ëª¨)",
      "severity": "high",
      "example": "ì™„ë²½í•˜ì§€ ì•Šìœ¼ë©´ ì‹¤íŒ¨ì•¼"
    },
    {
      "regex": "(ì „ë¶€|ëª¨ë‘|ë‹¤).*(ì„±ê³µ|ì™„ë²½).*(ì•„ë‹ˆë©´).*(ì˜ë¯¸|ì“¸ëª¨|ê°€ì¹˜).*(ì—†)",
      "severity": "high",
      "example": "ì „ë¶€ ì„±ê³µí•˜ì§€ ì•Šìœ¼ë©´ ì˜ë¯¸ ì—†ì–´"
    },
    {
      "regex": "(í•­ìƒ|ì ˆëŒ€).*(ì„±ê³µ|ì‹¤íŒ¨)",
      "severity": "medium",
      "example": "í•­ìƒ ì„±ê³µí•´ì•¼ í•´"
    },
    {
      "regex": "100%.*(ì•„ë‹ˆë©´|ëª»)",
      "severity": "medium",
      "example": "100% ì™„ë²½í•˜ì§€ ì•Šìœ¼ë©´ ì•ˆ ë¼"
    }
  ],
  "psychological_impact": "ì™„ë²½ì£¼ì˜, ìê¸°ë¹„íŒ, ìš°ìš¸",
  "intervention_priority": "high"
}
```

**ë‚˜ë¨¸ì§€ 8ê°œ íŒŒì¼** (`overgeneralization.json`, `mental-filter.json` ë“±)ë„ ê°™ì€ êµ¬ì¡°ë¡œ ìƒì„± (ìƒëµ)

---

### 3.1.2 ì¸ì§€ ì™œê³¡ íƒì§€ê¸° í´ë˜ìŠ¤

**íŒŒì¼**: `services/cbt/CognitiveDistortionDetector.js`

```javascript
const fs = require("fs");
const path = require("path");

class CognitiveDistortionDetector {
  constructor() {
    this.patterns = this._loadPatterns();
    this.threshold = parseFloat(process.env.CBT_DETECTION_THRESHOLD) || 0.6;
  }

  /**
   * 10ê°€ì§€ ì¸ì§€ ì™œê³¡ íŒ¨í„´ ë¡œë“œ
   */
  _loadPatterns() {
    const patternsDir = path.join(__dirname, "patterns");
    const patterns = [];

    const files = [
      "catastrophizing.json",
      "all-or-nothing.json",
      "overgeneralization.json",
      "mental-filter.json",
      "disqualifying-positive.json",
      "jumping-to-conclusions.json",
      "magnification.json",
      "emotional-reasoning.json",
      "should-statements.json",
      "labeling.json",
    ];

    files.forEach(file => {
      try {
        const filePath = path.join(patternsDir, file);
        const data = JSON.parse(fs.readFileSync(filePath, "utf8"));
        patterns.push(data);
      } catch (err) {
        console.error(`Failed to load pattern: ${file}`, err);
      }
    });

    console.log(`âœ… Loaded ${patterns.length} CBT patterns`);
    return patterns;
  }

  /**
   * STT í…ìŠ¤íŠ¸ì—ì„œ ì¸ì§€ ì™œê³¡ íƒì§€
   * @param {string} text - STT í…ìŠ¤íŠ¸
   * @returns {Array} íƒì§€ëœ ì™œê³¡ ëª©ë¡
   */
  detectDistortions(text) {
    if (!text || text.trim().length === 0) return [];

    const detections = [];

    this.patterns.forEach(pattern => {
      const matches = this._matchPattern(text, pattern);
      if (matches.length > 0) {
        detections.push({
          type: pattern.type,
          name: pattern.name_ko,
          matches: matches,
          severity: this._calculateSeverity(matches),
          description: pattern.description,
          psychologicalImpact: pattern.psychological_impact,
          priority: pattern.intervention_priority,
          timestamp: Date.now(),
        });
      }
    });

    // ì‹¬ê°ë„ ìˆœ ì •ë ¬
    detections.sort((a, b) => {
      const severityOrder = { high: 3, medium: 2, low: 1 };
      return severityOrder[b.severity] - severityOrder[a.severity];
    });

    return detections;
  }

  /**
   * íŒ¨í„´ ë§¤ì¹­
   */
  _matchPattern(text, pattern) {
    const matches = [];

    // 1. í‚¤ì›Œë“œ ë§¤ì¹­
    const keywordMatches = pattern.keywords.filter(kw => text.includes(kw));
    if (keywordMatches.length > 0) {
      matches.push({
        type: "keyword",
        matched: keywordMatches,
        confidence: 0.5,
      });
    }

    // 2. ì •ê·œí‘œí˜„ì‹ ë§¤ì¹­
    pattern.patterns.forEach(p => {
      const regex = new RegExp(p.regex, "gi");
      const regexMatches = text.match(regex);
      if (regexMatches) {
        matches.push({
          type: "pattern",
          matched: regexMatches,
          severity: p.severity,
          confidence: 0.8,
          example: p.example,
        });
      }
    });

    return matches;
  }

  /**
   * ì‹¬ê°ë„ ê³„ì‚°
   */
  _calculateSeverity(matches) {
    if (matches.length === 0) return "low";

    const patternMatches = matches.filter(m => m.type === "pattern");
    if (patternMatches.length === 0) return "low";

    const highSeverity = patternMatches.some(m => m.severity === "high");
    if (highSeverity) return "high";

    const mediumSeverity = patternMatches.some(m => m.severity === "medium");
    if (mediumSeverity) return "medium";

    return "low";
  }

  /**
   * ì‹¬ê°ë„ ì ìˆ˜ ê³„ì‚° (0-1)
   */
  getSeverityScore(detections) {
    if (detections.length === 0) return 0;

    const severityMap = { high: 1.0, medium: 0.6, low: 0.3 };
    const scores = detections.map(d => severityMap[d.severity] || 0);
    return Math.max(...scores);
  }
}

// Singleton
let instance = null;

function getCognitiveDistortionDetector() {
  if (!instance) {
    instance = new CognitiveDistortionDetector();
  }
  return instance;
}

module.exports = { getCognitiveDistortionDetector };
```

**í•µì‹¬ ê¸°ëŠ¥**:
- **10ê°€ì§€ íŒ¨í„´**: JSON íŒŒì¼ë¡œ ê´€ë¦¬ (ìœ ì§€ë³´ìˆ˜ ìš©ì´)
- **í‚¤ì›Œë“œ + Regex**: 2ë‹¨ê³„ ë§¤ì¹­ìœ¼ë¡œ ì •í™•ë„ í–¥ìƒ
- **ì‹¬ê°ë„ í‰ê°€**: high/medium/low ìë™ ë¶„ë¥˜
- **ìš°ì„ ìˆœìœ„**: ê°œì… í•„ìš”ì„± í‰ê°€

---

## Task 3.2: ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸ ìƒì„±

### 3.2.1 ì§ˆë¬¸ ìƒì„±ê¸° í´ë˜ìŠ¤

**íŒŒì¼**: `services/cbt/SocraticQuestioner.js`

```javascript
const { GoogleGenAI } = require("@google/genai");
require("dotenv").config();

const genAI = new GoogleGenAI(process.env.GEMINI_API_KEY);

class SocraticQuestioner {
  constructor() {
    this.model = process.env.GEMINI_CBT_MODEL || "gemini-2.5-flash";
    this.temperature = parseFloat(process.env.GEMINI_CBT_TEMPERATURE) || 0.7;
  }

  /**
   * ì¸ì§€ ì™œê³¡ì— ëŒ€í•œ ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸ ìƒì„±
   * @param {Object} distortion - íƒì§€ëœ ì™œê³¡ ê°ì²´
   * @param {string} originalText - ì›ë¬¸
   * @returns {Promise<Array>} ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸
   */
  async generateQuestions(distortion, originalText) {
    const prompt = this._buildPrompt(distortion, originalText);

    try {
      const response = await genAI.models.generateContent({
        model: this.model,
        contents: prompt,
        generationConfig: {
          temperature: this.temperature,
          maxOutputTokens: 500,
        },
      });

      const questions = this._parseResponse(response.text);
      console.log(`âœ… Generated ${questions.length} Socratic questions for ${distortion.type}`);
      return questions;

    } catch (err) {
      console.error("Gemini Socratic question generation error:", err);
      return this._getFallbackQuestions(distortion.type);
    }
  }

  /**
   * í”„ë¡¬í”„íŠ¸ êµ¬ì„±
   */
  _buildPrompt(distortion, originalText) {
    return `
ë‹¹ì‹ ì€ ì „ë¬¸ ì‹¬ë¦¬ ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. ë‚´ë‹´ìì˜ ì¸ì§€ ì™œê³¡ì„ ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸ë²•ìœ¼ë¡œ ì¬êµ¬ì¡°í™”í•˜ì„¸ìš”.

**ì¸ì§€ ì™œê³¡ ìœ í˜•**: ${distortion.name} (${distortion.type})
**ì„¤ëª…**: ${distortion.description}
**ì›ë¬¸**: "${originalText}"

**ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸ë²• ì›ì¹™**:
1. **ì¦ê±° íƒìƒ‰**: "ê·¸ë ‡ê²Œ ìƒê°í•˜ëŠ” ì¦ê±°ê°€ ìˆë‚˜ìš”?"
2. **ëŒ€ì•ˆ íƒìƒ‰**: "ë‹¤ë¥¸ ê°€ëŠ¥ì„±ì€ ì—†ì„ê¹Œìš”?"
3. **ê²°ê³¼ ì˜ˆì¸¡**: "ì‹¤ì œë¡œ ê·¸ë ‡ê²Œ ëœë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?"
4. **ê³¼ê±° ê²½í—˜**: "ê³¼ê±°ì— ë¹„ìŠ·í•œ ìƒí™©ì€ ì–´ë–»ê²Œ í•´ê²°í–ˆë‚˜ìš”?"
5. **íƒ€ì¸ ê´€ì **: "ì¹œêµ¬ê°€ ê°™ì€ ìƒí™©ì´ë¼ë©´ ë­ë¼ê³  í• ê¹Œìš”?"

**ìš”êµ¬ì‚¬í•­**:
- 3-5ê°œì˜ ì§ˆë¬¸ ìƒì„±
- ë¹„íŒì ì´ì§€ ì•Šê³  í˜¸ê¸°ì‹¬ ì–´ë¦° í†¤
- ë‚´ë‹´ìê°€ ìŠ¤ìŠ¤ë¡œ ë‹µì„ ì°¾ë„ë¡ ìœ ë„
- í•œêµ­ì–´ë¡œ ì‘ì„±
- ê° ì§ˆë¬¸ì€ ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„

**ì¶œë ¥ í˜•ì‹**:
Q1: [ì§ˆë¬¸ 1]
Q2: [ì§ˆë¬¸ 2]
Q3: [ì§ˆë¬¸ 3]
    `.trim();
  }

  /**
   * Gemini ì‘ë‹µ íŒŒì‹±
   */
  _parseResponse(text) {
    const lines = text.trim().split("\n").filter(l => l.trim().length > 0);
    const questions = [];

    lines.forEach(line => {
      // "Q1:", "1.", "- " ë“± ì œê±°
      const cleaned = line.replace(/^(Q\d+:|[\d]+\.|-)\s*/, "").trim();
      if (cleaned.length > 5) {
        questions.push(cleaned);
      }
    });

    return questions;
  }

  /**
   * í´ë°± ì§ˆë¬¸ (Gemini ì‹¤íŒ¨ ì‹œ)
   */
  _getFallbackQuestions(distortionType) {
    const fallbacks = {
      catastrophizing: [
        "ìµœì•…ì˜ ìƒí™©ì´ ì‹¤ì œë¡œ ì¼ì–´ë‚  ê°€ëŠ¥ì„±ì€ ì–¼ë§ˆë‚˜ ë ê¹Œìš”?",
        "ê³¼ê±°ì— ë¹„ìŠ·í•œ ê±±ì •ì„ í–ˆì„ ë•Œ ì‹¤ì œë¡œ ì–´ë–»ê²Œ ë˜ì—ˆë‚˜ìš”?",
        "ë§Œì•½ ì¹œêµ¬ê°€ ê°™ì€ ê±±ì •ì„ í•œë‹¤ë©´ ì–´ë–¤ ì¡°ì–¸ì„ í•´ì£¼ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?",
      ],
      "all-or-nothing": [
        "ì™„ë²½ê³¼ ì‹¤íŒ¨ ì‚¬ì´ì— ì¤‘ê°„ ë‹¨ê³„ê°€ ìˆì„ ìˆ˜ ìˆì„ê¹Œìš”?",
        "80% ì„±ê³µí–ˆë‹¤ë©´ ê·¸ê²ƒë„ ì‹¤íŒ¨ì¸ê°€ìš”?",
        "ë¶€ë¶„ì ì¸ ì„±ê³µë„ ì˜ë¯¸ê°€ ìˆì§€ ì•Šì„ê¹Œìš”?",
      ],
      overgeneralization: [
        "í•­ìƒ ê·¸ëŸ° ê±´ê°€ìš”? ì˜ˆì™¸ì ì¸ ê²½ìš°ëŠ” ì—†ì—ˆë‚˜ìš”?",
        "í•œ ë²ˆì˜ ê²½í—˜ì´ ëª¨ë“  ìƒí™©ì— ì ìš©ë ê¹Œìš”?",
        "ê³¼ê±°ì— ì„±ê³µí•œ ì ë„ ìˆì§€ ì•Šë‚˜ìš”?",
      ],
    };

    return fallbacks[distortionType] || [
      "ê·¸ë ‡ê²Œ ìƒê°í•˜ëŠ” êµ¬ì²´ì ì¸ ì´ìœ ê°€ ìˆì„ê¹Œìš”?",
      "ë‹¤ë¥¸ ê´€ì ì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” ë°©ë²•ì€ ì—†ì„ê¹Œìš”?",
      "ì´ ìƒê°ì´ ë„ì›€ì´ ë˜ë‚˜ìš”?",
    ];
  }
}

// Singleton
let instance = null;

function getSocraticQuestioner() {
  if (!instance) {
    instance = new SocraticQuestioner();
  }
  return instance;
}

module.exports = { getSocraticQuestioner };
```

**í•µì‹¬ ì›ë¦¬**:
- **Gemini AI**: ë§¥ë½ì— ë§ëŠ” ë§ì¶¤í˜• ì§ˆë¬¸ ìƒì„±
- **5ê°€ì§€ ì›ì¹™**: ì¦ê±°, ëŒ€ì•ˆ, ê²°ê³¼, ê²½í—˜, íƒ€ì¸ ê´€ì 
- **ë¹„íŒ ê¸ˆì§€**: í˜¸ê¸°ì‹¬ ì–´ë¦° í†¤ìœ¼ë¡œ ìê¸°ì„±ì°° ìœ ë„
- **í´ë°±**: AI ì‹¤íŒ¨ ì‹œ ì‚¬ì „ ì •ì˜ëœ ì§ˆë¬¸ ì‚¬ìš©

---

## Task 3.3: í–‰ë™ ê³¼ì œ ì¶”ì²œ

### 3.3.1 í–‰ë™ ê³¼ì œ ì¶”ì²œê¸° í´ë˜ìŠ¤

**íŒŒì¼**: `services/cbt/BehavioralTaskRecommender.js`

```javascript
const { GoogleGenAI } = require("@google/genai");
require("dotenv").config();

const genAI = new GoogleGenAI(process.env.GEMINI_API_KEY);

class BehavioralTaskRecommender {
  constructor() {
    this.model = process.env.GEMINI_CBT_MODEL || "gemini-2.5-flash";
    this.temperature = 0.8; // ì°½ì˜ì  ê³¼ì œ ìƒì„±
  }

  /**
   * í–‰ë™ ê³¼ì œ ì¶”ì²œ
   * @param {Object} distortion - ì¸ì§€ ì™œê³¡
   * @param {Object} context - ì„¸ì…˜ ì»¨í…ìŠ¤íŠ¸ (ê°ì •, VAD ë“±)
   * @returns {Promise<Array>} ê³¼ì œ ë¦¬ìŠ¤íŠ¸
   */
  async recommendTasks(distortion, context = {}) {
    const prompt = this._buildPrompt(distortion, context);

    try {
      const response = await genAI.models.generateContent({
        model: this.model,
        contents: prompt,
        generationConfig: {
          temperature: this.temperature,
          maxOutputTokens: 600,
        },
      });

      const tasks = this._parseResponse(response.text);
      console.log(`âœ… Recommended ${tasks.length} behavioral tasks for ${distortion.type}`);
      return tasks;

    } catch (err) {
      console.error("Gemini task recommendation error:", err);
      return this._getFallbackTasks(distortion.type);
    }
  }

  /**
   * í”„ë¡¬í”„íŠ¸ êµ¬ì„±
   */
  _buildPrompt(distortion, context) {
    return `
ë‹¹ì‹ ì€ CBT ì „ë¬¸ ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. ë‚´ë‹´ìì˜ ì¸ì§€ ì™œê³¡ì„ ê°œì„ í•˜ê¸° ìœ„í•œ êµ¬ì²´ì ì¸ í–‰ë™ ê³¼ì œë¥¼ ì¶”ì²œí•˜ì„¸ìš”.

**ì¸ì§€ ì™œê³¡**: ${distortion.name} (${distortion.type})
**ì„¤ëª…**: ${distortion.description}
**ì‹¬ë¦¬ì  ì˜í–¥**: ${distortion.psychologicalImpact}

${context.emotion ? `**í˜„ì¬ ê°ì •**: ${context.emotion}` : ""}
${context.vadMetrics ? `
**ìŒì„± íŒ¨í„´**:
- ë°œí™” ë¹„ìœ¨: ${context.vadMetrics.speechRate}%
- í‰ê·  ì¹¨ë¬µ ê¸¸ì´: ${(parseFloat(context.vadMetrics.avgSilenceDuration) / 1000).toFixed(1)}ì´ˆ
` : ""}

**í–‰ë™ ê³¼ì œ ì›ì¹™**:
1. **êµ¬ì²´ì **: ì¸¡ì • ê°€ëŠ¥í•˜ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ê³¼ì œ
2. **ì ì§„ì **: ì‘ì€ ë‹¨ê³„ë¶€í„° ì‹œì‘
3. **ì•ˆì „í•¨**: ë‚´ë‹´ìì—ê²Œ ë¶€ë‹´ ì—†ëŠ” ìˆ˜ì¤€
4. **ì¼ìƒì **: ì¼ìƒì—ì„œ ì‹¤ì²œ ê°€ëŠ¥
5. **ê¸°ë¡**: ê³¼ì œ ìˆ˜í–‰ í›„ ê¸°ë¡ ê¶Œì¥

**ìš”êµ¬ì‚¬í•­**:
- 2-3ê°œì˜ ê³¼ì œ ì¶”ì²œ
- ê° ê³¼ì œëŠ” ì œëª©, ì„¤ëª…, ê¸°ëŒ€ íš¨ê³¼ í¬í•¨
- í•œêµ­ì–´ë¡œ ì‘ì„±

**ì¶œë ¥ í˜•ì‹**:
[Task 1]
ì œëª©: [ê³¼ì œ ì œëª©]
ì„¤ëª…: [êµ¬ì²´ì  ì‹¤í–‰ ë°©ë²•]
ê¸°ëŒ€íš¨ê³¼: [ì˜ˆìƒ ì‹¬ë¦¬ì  íš¨ê³¼]

[Task 2]
...
    `.trim();
  }

  /**
   * ì‘ë‹µ íŒŒì‹±
   */
  _parseResponse(text) {
    const tasks = [];
    const blocks = text.split(/\[Task \d+\]/).filter(b => b.trim().length > 0);

    blocks.forEach(block => {
      const lines = block.trim().split("\n");
      const task = {};

      lines.forEach(line => {
        if (line.startsWith("ì œëª©:")) {
          task.title = line.replace("ì œëª©:", "").trim();
        } else if (line.startsWith("ì„¤ëª…:")) {
          task.description = line.replace("ì„¤ëª…:", "").trim();
        } else if (line.startsWith("ê¸°ëŒ€íš¨ê³¼:") || line.startsWith("ê¸°ëŒ€ íš¨ê³¼:")) {
          task.expectedEffect = line.replace(/ê¸°ëŒ€\s?íš¨ê³¼:/, "").trim();
        }
      });

      if (task.title && task.description) {
        tasks.push(task);
      }
    });

    return tasks;
  }

  /**
   * í´ë°± ê³¼ì œ
   */
  _getFallbackTasks(distortionType) {
    const fallbacks = {
      catastrophizing: [
        {
          title: "ìµœì•…ì˜ ì‹œë‚˜ë¦¬ì˜¤ vs í˜„ì‹¤ ë¹„êµ",
          description: "ê±±ì •ë˜ëŠ” ìƒí™©ì˜ 'ìµœì•…ì˜ ê²°ê³¼'ì™€ 'ê°€ì¥ í˜„ì‹¤ì ì¸ ê²°ê³¼'ë¥¼ ì¢…ì´ì— ì ì–´ë³´ì„¸ìš”. ê³¼ê±°ì— ë¹„ìŠ·í•œ ê±±ì •ì´ ì‹¤ì œë¡œ ì–´ë–»ê²Œ ë˜ì—ˆëŠ”ì§€ë„ ê¸°ë¡í•˜ì„¸ìš”.",
          expectedEffect: "ê³¼ë„í•œ ê±±ì •ê³¼ í˜„ì‹¤ì˜ ì°¨ì´ë¥¼ ì¸ì‹í•˜ê³ , ê±±ì •ì˜ ë¹„í•©ë¦¬ì„±ì„ ê¹¨ë‹¬ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        },
        {
          title: "í•˜ë£¨ 3ê°€ì§€ ê´œì°®ì•˜ë˜ ì¼ ê¸°ë¡",
          description: "ë§¤ì¼ ìê¸° ì „, 'ì˜¤ëŠ˜ ê´œì°®ì•˜ë˜ ì¼ 3ê°€ì§€'ë¥¼ ë©”ëª¨ì¥ì— ì ì–´ë³´ì„¸ìš”. ì•„ì£¼ ì‘ì€ ê²ƒë„ ê´œì°®ìŠµë‹ˆë‹¤ (ì˜ˆ: ë”°ëœ»í•œ ì»¤í”¼, ì¹œêµ¬ ë©”ì‹œì§€).",
          expectedEffect: "ë¶€ì •ì  ì‚¬ê³ ì—ì„œ ë²—ì–´ë‚˜ ê¸ì •ì  ì¸¡ë©´ì— ì£¼ì˜ë¥¼ ëŒë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        },
      ],
      "all-or-nothing": [
        {
          title: "ë¶€ë¶„ ì„±ê³µ ì¸ì •í•˜ê¸°",
          description: "ì™„ë²½í•˜ì§€ ì•Šì•˜ì§€ë§Œ ë¶€ë¶„ì ìœ¼ë¡œ ì„±ê³µí•œ ê²½í—˜ 3ê°€ì§€ë¥¼ ì°¾ì•„ ì ì–´ë³´ì„¸ìš”. ê°ê° ëª‡ % ì„±ê³µí–ˆëŠ”ì§€ ìˆ«ìë¡œ í‘œí˜„í•˜ì„¸ìš”.",
          expectedEffect: "ì™„ë²½ê³¼ ì‹¤íŒ¨ ì‚¬ì´ì˜ íšŒìƒ‰ ì§€ëŒ€ë¥¼ ì¸ì‹í•˜ê³ , ë¶€ë¶„ì  ì„±ê³µì˜ ê°€ì¹˜ë¥¼ ê¹¨ë‹«ìŠµë‹ˆë‹¤.",
        },
      ],
    };

    return fallbacks[distortionType] || [
      {
        title: "ìƒê° ê¸°ë¡í•˜ê¸°",
        description: "ë¶€ì •ì  ìƒê°ì´ ë“¤ ë•Œë§ˆë‹¤ ë©”ëª¨ì¥ì— ì ì–´ë³´ì„¸ìš”. ë‚˜ì¤‘ì— ë‹¤ì‹œ ì½ìœ¼ë©´ ìƒˆë¡œìš´ ê´€ì ì„ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        expectedEffect: "ìë™ì  ì‚¬ê³  íŒ¨í„´ì„ ì¸ì‹í•˜ê³ , ê°ê´€ì ìœ¼ë¡œ í‰ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
      },
    ];
  }
}

// Singleton
let instance = null;

function getBehavioralTaskRecommender() {
  if (!instance) {
    instance = new BehavioralTaskRecommender();
  }
  return instance;
}

module.exports = { getBehavioralTaskRecommender };
```

**ê³¼ì œ ì˜ˆì‹œ**:

```javascript
[
  {
    title: "ìµœì•…ì˜ ì‹œë‚˜ë¦¬ì˜¤ vs í˜„ì‹¤ ë¹„êµ",
    description: "ê±±ì •ë˜ëŠ” ìƒí™©ì˜ 'ìµœì•…ì˜ ê²°ê³¼'ì™€ 'ê°€ì¥ í˜„ì‹¤ì ì¸ ê²°ê³¼'ë¥¼ ì¢…ì´ì— ì ì–´ë³´ì„¸ìš”.",
    expectedEffect: "ê³¼ë„í•œ ê±±ì •ê³¼ í˜„ì‹¤ì˜ ì°¨ì´ë¥¼ ì¸ì‹í•©ë‹ˆë‹¤."
  },
  {
    title: "í•˜ë£¨ 3ê°€ì§€ ê´œì°®ì•˜ë˜ ì¼ ê¸°ë¡",
    description: "ë§¤ì¼ ìê¸° ì „ ì˜¤ëŠ˜ ê´œì°®ì•˜ë˜ ì¼ 3ê°€ì§€ë¥¼ ë©”ëª¨í•˜ì„¸ìš”.",
    expectedEffect: "ê¸ì •ì  ì¸¡ë©´ì— ì£¼ì˜ë¥¼ ëŒë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
  }
]
```

---

## Task 3.4: ì¹˜ë£Œì  ê°œì… í†µí•©

### 3.4.1 ê°œì… ìƒì„±ê¸° í´ë˜ìŠ¤

**íŒŒì¼**: `services/cbt/InterventionGenerator.js`

```javascript
const { getCognitiveDistortionDetector } = require("./CognitiveDistortionDetector");
const { getSocraticQuestioner } = require("./SocraticQuestioner");
const { getBehavioralTaskRecommender } = require("./BehavioralTaskRecommender");

class InterventionGenerator {
  constructor() {
    this.detector = getCognitiveDistortionDetector();
    this.questioner = getSocraticQuestioner();
    this.taskRecommender = getBehavioralTaskRecommender();

    this.interventionFrequency = parseInt(process.env.CBT_INTERVENTION_FREQUENCY) || 3;
    this.distortionHistory = new Map(); // sessionId -> [distortions]
  }

  /**
   * STT í…ìŠ¤íŠ¸ ë¶„ì„ ë° ê°œì… ìƒì„±
   * @param {string} sessionId
   * @param {string} text - STT í…ìŠ¤íŠ¸
   * @param {Object} context - ê°ì •, VAD ë©”íŠ¸ë¦­ ë“±
   * @returns {Promise<Object|null>} ê°œì… ê°ì²´ ë˜ëŠ” null
   */
  async analyzeAndIntervene(sessionId, text, context = {}) {
    // 1. ì¸ì§€ ì™œê³¡ íƒì§€
    const distortions = this.detector.detectDistortions(text);

    if (distortions.length === 0) {
      console.log(`âœ… No cognitive distortions detected in: "${text.slice(0, 50)}..."`);
      return null;
    }

    console.log(`âš ï¸ Detected ${distortions.length} cognitive distortion(s):`, distortions.map(d => d.name));

    // 2. íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
    if (!this.distortionHistory.has(sessionId)) {
      this.distortionHistory.set(sessionId, []);
    }
    const history = this.distortionHistory.get(sessionId);
    history.push(...distortions);

    // 3. ê°œì… í•„ìš”ì„± íŒë‹¨
    const shouldIntervene = this._shouldIntervene(distortions, history);

    if (!shouldIntervene) {
      console.log(`ğŸ“ Distortion recorded but intervention not triggered yet`);
      return { distortions, intervention: null };
    }

    // 4. ê°œì… ìƒì„±
    const intervention = await this._generateIntervention(distortions[0], text, context);

    console.log(`âœ… Intervention generated for ${distortions[0].name}`);
    return { distortions, intervention };
  }

  /**
   * ê°œì… í•„ìš”ì„± íŒë‹¨
   */
  _shouldIntervene(currentDistortions, history) {
    // 1. ì‹¬ê°ë„ê°€ highë©´ ì¦‰ì‹œ ê°œì…
    if (currentDistortions.some(d => d.severity === "high")) {
      return true;
    }

    // 2. ê°™ì€ ìœ í˜•ì˜ ì™œê³¡ì´ NíšŒ ì´ìƒ ë°˜ë³µë˜ë©´ ê°œì…
    const recentDistortions = history.slice(-10); // ìµœê·¼ 10ê°œë§Œ
    const typeCounts = {};

    recentDistortions.forEach(d => {
      typeCounts[d.type] = (typeCounts[d.type] || 0) + 1;
    });

    const maxCount = Math.max(...Object.values(typeCounts));
    if (maxCount >= this.interventionFrequency) {
      return true;
    }

    // 3. ë‹¤ì–‘í•œ ì™œê³¡ì´ ë™ì‹œ ë°œìƒí•˜ë©´ ê°œì…
    if (currentDistortions.length >= 2) {
      return true;
    }

    return false;
  }

  /**
   * ê°œì… ìƒì„± (ì§ˆë¬¸ + ê³¼ì œ)
   */
  async _generateIntervention(distortion, originalText, context) {
    try {
      // ë³‘ë ¬ ì²˜ë¦¬
      const [questions, tasks] = await Promise.all([
        this.questioner.generateQuestions(distortion, originalText),
        this.taskRecommender.recommendTasks(distortion, context),
      ]);

      return {
        distortionType: distortion.type,
        distortionName: distortion.name,
        severity: distortion.severity,
        description: distortion.description,
        questions,
        tasks,
        timestamp: new Date().toISOString(),
        context: {
          emotion: context.emotion || null,
          vadMetrics: context.vadMetrics || null,
        },
      };
    } catch (err) {
      console.error("Intervention generation error:", err);
      return null;
    }
  }

  /**
   * ì„¸ì…˜ ì¢…ë£Œ ì‹œ íˆìŠ¤í† ë¦¬ ì •ë¦¬
   */
  clearHistory(sessionId) {
    this.distortionHistory.delete(sessionId);
    console.log(`ğŸ§¹ Cleared CBT history for session: ${sessionId}`);
  }
}

// Singleton
let instance = null;

function getInterventionGenerator() {
  if (!instance) {
    instance = new InterventionGenerator();
  }
  return instance;
}

module.exports = { getInterventionGenerator };
```

**ê°œì… ì˜ˆì‹œ**:

```javascript
{
  distortionType: "catastrophizing",
  distortionName: "íŒŒêµ­í™”",
  severity: "high",
  description: "ìµœì•…ì˜ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê°€ì •í•˜ê±°ë‚˜ ìƒí™©ì„ ê³¼ë„í•˜ê²Œ ë¶€ì •ì ìœ¼ë¡œ í•´ì„í•˜ëŠ” ì‚¬ê³  íŒ¨í„´",
  questions: [
    "ìµœì•…ì˜ ìƒí™©ì´ ì‹¤ì œë¡œ ì¼ì–´ë‚  ê°€ëŠ¥ì„±ì€ ì–¼ë§ˆë‚˜ ë ê¹Œìš”?",
    "ê³¼ê±°ì— ë¹„ìŠ·í•œ ê±±ì •ì„ í–ˆì„ ë•Œ ì‹¤ì œë¡œ ì–´ë–»ê²Œ ë˜ì—ˆë‚˜ìš”?",
    "ë§Œì•½ ì¹œêµ¬ê°€ ê°™ì€ ê±±ì •ì„ í•œë‹¤ë©´ ì–´ë–¤ ì¡°ì–¸ì„ í•´ì£¼ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?"
  ],
  tasks: [
    {
      title: "ìµœì•…ì˜ ì‹œë‚˜ë¦¬ì˜¤ vs í˜„ì‹¤ ë¹„êµ",
      description: "ê±±ì •ë˜ëŠ” ìƒí™©ì˜ 'ìµœì•…ì˜ ê²°ê³¼'ì™€ 'ê°€ì¥ í˜„ì‹¤ì ì¸ ê²°ê³¼'ë¥¼ ì¢…ì´ì— ì ì–´ë³´ì„¸ìš”.",
      expectedEffect: "ê³¼ë„í•œ ê±±ì •ê³¼ í˜„ì‹¤ì˜ ì°¨ì´ë¥¼ ì¸ì‹í•©ë‹ˆë‹¤."
    }
  ],
  timestamp: "2025-01-17T10:30:00.000Z",
  context: {
    emotion: "ë¶ˆì•ˆ",
    vadMetrics: { /* VAD ë°ì´í„° */ }
  }
}
```

---

### 3.4.2 Gemini ë©€í‹°ëª¨ë‹¬ í†µí•© ì—…ë°ì´íŠ¸

**íŒŒì¼**: `services/gemini/gemini.js` (ê¸°ì¡´ íŒŒì¼ ìˆ˜ì •)

ê¸°ì¡´ `analyzeExpression` í•¨ìˆ˜ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ í™•ì¥:

```javascript
const { getInterventionGenerator } = require("../cbt/InterventionGenerator");

async function analyzeExpression(sessionId, accumulatedData, speechText = "", vadMetrics = null, psychoIndicators = []) {
  // ... ê¸°ì¡´ í‘œì • ë¶„ì„ ì½”ë“œ ...

  // CBT ê°œì… ìƒì„± (ìƒˆë¡œ ì¶”ê°€)
  let cbtIntervention = null;
  if (speechText && speechText.trim().length > 0) {
    const interventionGen = getInterventionGenerator();
    const result = await interventionGen.analyzeAndIntervene(sessionId, speechText, {
      vadMetrics,
      psychoIndicators,
    });

    if (result && result.intervention) {
      cbtIntervention = result.intervention;
    }
  }

  const prompt = `
    ë‹¹ì‹ ì€ ë©€í‹°ëª¨ë‹¬ ê°ì • ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
    ì•„ë˜ ì •ë³´ë¥¼ ì¢…í•©í•˜ì—¬ ì‚¬ìš©ìì˜ ê°ì •ì„ í•œ ë‹¨ì–´ë¡œ ìš”ì•½í•˜ì„¸ìš”.

    [í‘œì • ë°ì´í„°]
    ${summaryText}

    [ë°œí™” ë‚´ìš©(STT)]
    ${speechText?.trim() ? speechText : "ë°œí™” ì—†ìŒ"}

    ${vadMetrics ? `
    [ìŒì„± í™œë™ íŒ¨í„´(VAD)]
    - ë°œí™” ë¹„ìœ¨: ${vadMetrics.speechRate}%
    - ì¹¨ë¬µ ë¹„ìœ¨: ${vadMetrics.silenceRate}%
    - í‰ê·  ì¹¨ë¬µ ê¸¸ì´: ${(parseFloat(vadMetrics.avgSilenceDuration) / 1000).toFixed(1)}ì´ˆ
    - ìµœëŒ€ ì¹¨ë¬µ ê¸¸ì´: ${(parseFloat(vadMetrics.maxSilenceDuration) / 1000).toFixed(1)}ì´ˆ
    ` : ""}

    ${psychoIndicators.length > 0 ? `
    [ì‹¬ë¦¬ ì§€í‘œ]
    ${psychoIndicators.map(i => `- ${i.description}: ${i.psychologicalMeaning}`).join("\n")}
    ` : ""}

    ${cbtIntervention ? `
    [ì¸ì§€ ì™œê³¡ íƒì§€]
    - ìœ í˜•: ${cbtIntervention.distortionName}
    - ì‹¬ê°ë„: ${cbtIntervention.severity}
    - ì„¤ëª…: ${cbtIntervention.description}
    ` : ""}

    ë‹¨ê³„:
    1. í‘œì • ë³€í™”ë¥¼ í•´ì„í•©ë‹ˆë‹¤.
    2. ìŒì„± í™œë™ íŒ¨í„´ì„ ê³ ë ¤í•©ë‹ˆë‹¤.
    3. ë°œí™” ë‚´ìš©ê³¼ ì‹¬ë¦¬ ì§€í‘œë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.
    4. ì¸ì§€ ì™œê³¡ íŒ¨í„´ì´ ìˆë‹¤ë©´ ê°ì • íŒë‹¨ì— ë°˜ì˜í•©ë‹ˆë‹¤.
    5. ê°ì •ì„ ë‹¨ì–´ í•˜ë‚˜ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤. (ì˜ˆ: ë¶ˆì•ˆ, ìš°ìš¸, í‰ì˜¨, ê¸´ì¥ ë“±)
  `;

  try {
    const res = await genAI.models.generateContent({
      model: "gemini-2.5-flash",
      contents: prompt,
    });

    const emotion = res.text.trim().split("\n").pop();

    console.log(`Gemini ë¶„ì„ ì™„ë£Œ: ${emotion}${cbtIntervention ? " (CBT ê°œì… ìˆìŒ)" : ""}`);

    return {
      emotion,
      cbtIntervention, // ìƒˆë¡œ ì¶”ê°€
    };

  } catch (err) {
    console.error("Gemini Error:", err);
    return {
      emotion: "ë¶„ì„ ì‹¤íŒ¨",
      cbtIntervention: null,
    };
  }
}

module.exports = { analyzeExpression };
```

---

### 3.4.3 WebSocket í•¸ë“¤ëŸ¬ í†µí•©

**íŒŒì¼**: `services/socket/landmarksHandler.js` (ìˆ˜ì •)

10ì´ˆ ë¶„ì„ ì£¼ê¸°ì— CBT ê°œì… í¬í•¨:

```javascript
// ... ê¸°ì¡´ ì½”ë“œ ...

const analysisInterval = setInterval(async () => {
  if (session.status !== "active") return;

  const framesToAnalyze = [...session.landmarkBuffer];
  const sttToAnalyze = getAccumulatedSpeechText(lastAnalysisTime);
  const vadMetrics = session.vadMetrics || null;
  const psychoIndicators = session.psychologicalIndicators || [];

  try {
    // Gemini ë©€í‹°ëª¨ë‹¬ ë¶„ì„ (CBT í¬í•¨)
    const result = await analyzeExpression(
      session.sessionId,
      framesToAnalyze,
      sttToAnalyze,
      vadMetrics,
      psychoIndicators
    );

    console.log(`ğŸ¯ Gemini ë¶„ì„: ${result.emotion}${result.cbtIntervention ? " (CBT ê°œì…)" : ""}`);

    // ì„¸ì…˜ì— ì €ì¥
    session.emotions.push({
      timestamp: Date.now(),
      emotion: result.emotion,
      framesCount: framesToAnalyze.length,
      sttLength: sttToAnalyze.length,
      cbtIntervention: result.cbtIntervention, // ìƒˆë¡œ ì¶”ê°€
    });

    // /ws/sessionìœ¼ë¡œ ì „ì†¡
    if (session.wsConnections.session?.readyState === 1) {
      session.wsConnections.session.send(JSON.stringify({
        type: "emotion_update",
        data: {
          emotion: result.emotion,
          timestamp: new Date().toISOString(),
          framesCount: framesToAnalyze.length,
          cbtIntervention: result.cbtIntervention, // ìƒˆë¡œ ì¶”ê°€
        },
      }));
    }

    // ë²„í¼ ì´ˆê¸°í™”
    session.landmarkBuffer = [];
    lastAnalysisTime = Date.now();
    clearSpeechBuffer(lastAnalysisTime);

  } catch (err) {
    console.error("Analysis error:", err);
  }
}, ANALYSIS_INTERVAL_MS);
```

---

## í†µí•© í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ 1: ì¸ì§€ ì™œê³¡ íƒì§€ í…ŒìŠ¤íŠ¸

**íŒŒì¼**: `test-cbt.js` (ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ìƒì„±)

```javascript
const { getCognitiveDistortionDetector } = require("./services/cbt/CognitiveDistortionDetector");

const detector = getCognitiveDistortionDetector();

const testCases = [
  {
    text: "ì‹œí—˜ ë§ì¹˜ë©´ ì¸ìƒ ëì´ì•¼",
    expected: "catastrophizing",
  },
  {
    text: "ì™„ë²½í•˜ì§€ ì•Šìœ¼ë©´ ì‹¤íŒ¨ì•¼",
    expected: "all-or-nothing",
  },
  {
    text: "í•­ìƒ ë‚˜ëŠ” ì‹¤íŒ¨í•´",
    expected: "overgeneralization",
  },
  {
    text: "ë‚˜ëŠ” ì“¸ëª¨ì—†ëŠ” ì‚¬ëŒì´ì•¼",
    expected: "labeling",
  },
];

console.log("=== CBT ì¸ì§€ ì™œê³¡ íƒì§€ í…ŒìŠ¤íŠ¸ ===\n");

testCases.forEach((test, idx) => {
  console.log(`[Test ${idx + 1}] "${test.text}"`);
  const detections = detector.detectDistortions(test.text);

  if (detections.length > 0) {
    console.log(`âœ… íƒì§€ë¨: ${detections[0].name} (${detections[0].type})`);
    console.log(`   ì‹¬ê°ë„: ${detections[0].severity}`);
    console.log(`   ë§¤ì¹­: ${JSON.stringify(detections[0].matches, null, 2)}`);
  } else {
    console.log(`âŒ íƒì§€ ì‹¤íŒ¨`);
  }
  console.log("");
});
```

**ì‹¤í–‰**:

```bash
node test-cbt.js

# ì˜ˆìƒ ì¶œë ¥:
# === CBT ì¸ì§€ ì™œê³¡ íƒì§€ í…ŒìŠ¤íŠ¸ ===
#
# [Test 1] "ì‹œí—˜ ë§ì¹˜ë©´ ì¸ìƒ ëì´ì•¼"
# âœ… íƒì§€ë¨: íŒŒêµ­í™” (catastrophizing)
#    ì‹¬ê°ë„: high
#    ë§¤ì¹­: [{"type":"pattern","matched":["ì‹œí—˜ ë§ ì¸ìƒ ë"],"severity":"high",...}]
#
# [Test 2] "ì™„ë²½í•˜ì§€ ì•Šìœ¼ë©´ ì‹¤íŒ¨ì•¼"
# âœ… íƒì§€ë¨: í‘ë°±ë…¼ë¦¬ (all-or-nothing)
#    ì‹¬ê°ë„: high
#    ...
```

---

### í…ŒìŠ¤íŠ¸ 2: ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸ ìƒì„± í…ŒìŠ¤íŠ¸

```javascript
// test-socratic.js
const { getSocraticQuestioner } = require("./services/cbt/SocraticQuestioner");
const { getCognitiveDistortionDetector } = require("./services/cbt/CognitiveDistortionDetector");

(async () => {
  const detector = getCognitiveDistortionDetector();
  const questioner = getSocraticQuestioner();

  const text = "ì‹œí—˜ ë§ì¹˜ë©´ ì¸ìƒ ëì´ì•¼";
  const detections = detector.detectDistortions(text);

  if (detections.length > 0) {
    console.log(`íƒì§€ëœ ì™œê³¡: ${detections[0].name}\n`);

    const questions = await questioner.generateQuestions(detections[0], text);

    console.log("ìƒì„±ëœ ì§ˆë¬¸:");
    questions.forEach((q, idx) => {
      console.log(`${idx + 1}. ${q}`);
    });
  }
})();
```

**ì‹¤í–‰**:

```bash
node test-socratic.js

# ì˜ˆìƒ ì¶œë ¥:
# íƒì§€ëœ ì™œê³¡: íŒŒêµ­í™”
#
# ìƒì„±ëœ ì§ˆë¬¸:
# 1. ì‹œí—˜ì—ì„œ ì›í•˜ëŠ” ì„±ì ì„ ë°›ì§€ ëª»í•œë‹¤ë©´ ì •ë§ë¡œ ì¸ìƒì´ ëë‚˜ëŠ” ê±´ê°€ìš”?
# 2. ê³¼ê±°ì— ì‹œí—˜ì„ ë§ì³¤ì„ ë•Œ ì‹¤ì œë¡œ ì–´ë–¤ ì¼ì´ ì¼ì–´ë‚¬ë‚˜ìš”?
# 3. ì‹œí—˜ í•˜ë‚˜ê°€ ì „ì²´ ì¸ìƒì„ ê²°ì •í•œë‹¤ê³  ë³¼ ìˆ˜ ìˆì„ê¹Œìš”?
# 4. ë§Œì•½ ì¹œêµ¬ê°€ ê°™ì€ ê±±ì •ì„ í•œë‹¤ë©´ ì–´ë–¤ ë§ì„ í•´ì£¼ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?
```

---

### í…ŒìŠ¤íŠ¸ 3: í”„ë¡ íŠ¸ì—”ë“œ í†µí•© í…ŒìŠ¤íŠ¸

**íŒŒì¼**: `public/cbt-test.html` (ìƒˆë¡œ ìƒì„±)

```html
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>CBT ê°œì… í…ŒìŠ¤íŠ¸</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
    .intervention { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 10px 0; }
    .intervention.high { border-left-color: #dc3545; background: #f8d7da; }
    .questions { background: #d4edda; padding: 10px; margin: 10px 0; border-radius: 4px; }
    .tasks { background: #cfe2ff; padding: 10px; margin: 10px 0; border-radius: 4px; }
    button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§  CBT ê°œì… í…ŒìŠ¤íŠ¸</h1>

    <div>
      <button onclick="startSession()">ì„¸ì…˜ ì‹œì‘</button>
      <button onclick="connectWs()">WebSocket ì—°ê²°</button>
      <button onclick="sendTestMessage('ì‹œí—˜ ë§ì¹˜ë©´ ì¸ìƒ ëì´ì•¼')">íŒŒêµ­í™” í…ŒìŠ¤íŠ¸</button>
      <button onclick="sendTestMessage('ì™„ë²½í•˜ì§€ ì•Šìœ¼ë©´ ì‹¤íŒ¨ì•¼')">í‘ë°±ë…¼ë¦¬ í…ŒìŠ¤íŠ¸</button>
    </div>

    <div id="interventionPanel" style="margin-top: 20px;"></div>
  </div>

  <script>
    let sessionId = null;
    let sessionWs = null;

    async function startSession() {
      const res = await fetch("http://localhost:8000/api/session/start", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId: "test_cbt", counselorId: "counselor" })
      });

      const data = await res.json();
      sessionId = data.data.sessionId;
      console.log("âœ… ì„¸ì…˜ ìƒì„±:", sessionId);
    }

    function connectWs() {
      sessionWs = new WebSocket(`ws://localhost:8000/ws/session?sessionId=${sessionId}`);

      sessionWs.onopen = () => console.log("âœ… Session WS ì—°ê²°ë¨");

      sessionWs.onmessage = (event) => {
        const data = JSON.parse(event.data);

        if (data.type === "emotion_update" && data.data.cbtIntervention) {
          displayIntervention(data.data.cbtIntervention);
        }
      };
    }

    function sendTestMessage(text) {
      // ì‹¤ì œë¡œëŠ” STTì—ì„œ ì „ì†¡ë˜ì§€ë§Œ, í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì§ì ‘ ì„œë²„ ë©”ëª¨ë¦¬ì— ì‚½ì…
      console.log(`ğŸ“¤ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡: "${text}"`);
      alert(`ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” STTë¥¼ í†µí•´ ì „ì†¡ë©ë‹ˆë‹¤.\ní…ŒìŠ¤íŠ¸ í…ìŠ¤íŠ¸: "${text}"`);
    }

    function displayIntervention(intervention) {
      const panel = document.getElementById("interventionPanel");

      const div = document.createElement("div");
      div.className = `intervention ${intervention.severity}`;
      div.innerHTML = `
        <h3>âš ï¸ ${intervention.distortionName} ê°ì§€</h3>
        <p>${intervention.description}</p>
        <p><strong>ì‹¬ê°ë„:</strong> ${intervention.severity}</p>

        <div class="questions">
          <h4>ğŸ’¡ ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸</h4>
          <ol>
            ${intervention.questions.map(q => `<li>${q}</li>`).join("")}
          </ol>
        </div>

        <div class="tasks">
          <h4>ğŸ“ í–‰ë™ ê³¼ì œ</h4>
          ${intervention.tasks.map(t => `
            <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 4px;">
              <strong>${t.title}</strong><br>
              <small>${t.description}</small><br>
              <em>ê¸°ëŒ€íš¨ê³¼: ${t.expectedEffect}</em>
            </div>
          `).join("")}
        </div>

        <p><small>ì‹œê°„: ${intervention.timestamp}</small></p>
      `;

      panel.appendChild(div);
    }
  </script>
</body>
</html>
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: íŒ¨í„´ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨

**ì¦ìƒ**:
```
Failed to load pattern: catastrophizing.json
```

**í•´ê²°**:

```bash
# 1. íŒ¨í„´ ë””ë ‰í† ë¦¬ í™•ì¸
ls services/cbt/patterns/

# 2. íŒŒì¼ ê¶Œí•œ í™•ì¸
chmod 644 services/cbt/patterns/*.json

# 3. JSON êµ¬ë¬¸ ê²€ì¦
node -e "console.log(JSON.parse(require('fs').readFileSync('services/cbt/patterns/catastrophizing.json')))"
```

---

### ë¬¸ì œ 2: Gemini API í• ë‹¹ëŸ‰ ì´ˆê³¼

**ì¦ìƒ**:
```
Gemini Error: 429 Too Many Requests
```

**í•´ê²°**:

1. **í´ë°± ë©”ì»¤ë‹ˆì¦˜ í™œì„±í™”**:
```javascript
// SocraticQuestioner.jsì—ì„œ ì´ë¯¸ êµ¬í˜„ë¨
return this._getFallbackQuestions(distortion.type);
```

2. **ìš”ì²­ ì œí•œ ì„¤ì •** (`.env`):
```bash
CBT_INTERVENTION_FREQUENCY=5  # 3íšŒ â†’ 5íšŒ (ê°œì… ë¹ˆë„ ë‚®ì¶¤)
```

3. **ìºì‹± ì¶”ê°€**:
```javascript
// SocraticQuestioner.js
this.cache = new Map(); // type -> questions

async generateQuestions(distortion, originalText) {
  const cacheKey = `${distortion.type}_${originalText.slice(0, 20)}`;

  if (this.cache.has(cacheKey)) {
    console.log("âœ… Using cached questions");
    return this.cache.get(cacheKey);
  }

  const questions = await this._callGemini(...);
  this.cache.set(cacheKey, questions);
  return questions;
}
```

---

### ë¬¸ì œ 3: í•œêµ­ì–´ í…ìŠ¤íŠ¸ ë§¤ì¹­ ì •í™•ë„ ë‚®ìŒ

**ì¦ìƒ**:
```
"ì‹œí—˜ ë§ì¹˜ë©´ ì¸ìƒ ëì´ì•¼" â†’ íƒì§€ ì‹¤íŒ¨
```

**í•´ê²°**:

1. **ì •ê·œí‘œí˜„ì‹ íŠœë‹**:
```json
// catastrophizing.json
{
  "regex": "(ì‹œí—˜|ë°œí‘œ|ë©´ì ‘).*(ë§|ì‹¤íŒ¨).*(ì¸ìƒ|ë|ë¯¸ë˜)",
  "regex": "(ì‹œí—˜|ë°œí‘œ|ë©´ì ‘).{0,5}(ë§|ì‹¤íŒ¨).{0,5}(ì¸ìƒ|ë|ë¯¸ë˜)"
}
```

2. **í‚¤ì›Œë“œ í™•ì¥**:
```json
{
  "keywords": [
    "ëì´ì•¼", "ë§í–ˆì–´", "ìµœì•…", "ì ˆë§", "ì£½ì„ ê²ƒ ê°™ì•„",
    "ëì¥", "íŒŒíƒ„", "ì¬ì•™", "ë¹„ì°¸", "ì°¸ë‹´"  // ì¶”ê°€
  ]
}
```

3. **í˜•íƒœì†Œ ë¶„ì„ ì‚¬ìš©** (ì„ íƒ):
```bash
npm install koalanlp
```

```javascript
// CognitiveDistortionDetector.js
const koalanlp = require("koalanlp");

_tokenize(text) {
  // í˜•íƒœì†Œ ë¶„ì„ í›„ í‚¤ì›Œë“œ ë§¤ì¹­ ì •í™•ë„ í–¥ìƒ
  const tokens = koalanlp.analyze(text);
  return tokens.map(t => t.surface);
}
```

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

### Task 3.1: ì¸ì§€ ì™œê³¡ íƒì§€
- [ ] 10ê°œ íŒ¨í„´ JSON íŒŒì¼ ìƒì„±
- [ ] `CognitiveDistortionDetector.js` êµ¬í˜„
- [ ] íŒ¨í„´ ë¡œë”© ë° ë§¤ì¹­ í…ŒìŠ¤íŠ¸
- [ ] í•œêµ­ì–´ ì •ê·œí‘œí˜„ì‹ ê²€ì¦

### Task 3.2: ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸
- [ ] `SocraticQuestioner.js` êµ¬í˜„
- [ ] Gemini í”„ë¡¬í”„íŠ¸ ìµœì í™”
- [ ] í´ë°± ì§ˆë¬¸ ì‘ì„±
- [ ] ì§ˆë¬¸ í’ˆì§ˆ ê²€ì¦

### Task 3.3: í–‰ë™ ê³¼ì œ ì¶”ì²œ
- [ ] `BehavioralTaskRecommender.js` êµ¬í˜„
- [ ] ê³¼ì œ í…œí”Œë¦¿ ì‘ì„±
- [ ] Gemini ê³¼ì œ ìƒì„± í…ŒìŠ¤íŠ¸
- [ ] ê³¼ì œ ì‹¤í–‰ ê°€ëŠ¥ì„± ê²€ì¦

### Task 3.4: ì¹˜ë£Œì  ê°œì… í†µí•©
- [ ] `InterventionGenerator.js` êµ¬í˜„
- [ ] Gemini ë©€í‹°ëª¨ë‹¬ í†µí•© ì—…ë°ì´íŠ¸
- [ ] WebSocket í•¸ë“¤ëŸ¬ ìˆ˜ì •
- [ ] í”„ë¡ íŠ¸ì—”ë“œ UI êµ¬í˜„

### í†µí•© í…ŒìŠ¤íŠ¸
- [ ] 10ê°€ì§€ ì™œê³¡ íƒì§€ ì •í™•ë„ ê²€ì¦
- [ ] ê°œì… ìƒì„± í’ˆì§ˆ í‰ê°€
- [ ] ì„¸ì…˜ ì¼ì‹œì •ì§€/ì¬ê°œ ì‹œ ë™ì‘ í™•ì¸
- [ ] ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§

---

## ì˜ˆìƒ ì†Œìš” ì‹œê°„

| Task | ì˜ˆìƒ ì‹œê°„ | ë‚œì´ë„ |
|------|-----------|--------|
| 3.1: ì¸ì§€ ì™œê³¡ íƒì§€ | 4-5ì‹œê°„ | â­â­â­â­â­ |
| 3.2: ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸ | 2-3ì‹œê°„ | â­â­â­â­ |
| 3.3: í–‰ë™ ê³¼ì œ ì¶”ì²œ | 2-3ì‹œê°„ | â­â­â­â­ |
| 3.4: ì¹˜ë£Œì  ê°œì… í†µí•© | 3-4ì‹œê°„ | â­â­â­â­ |
| í†µí•© í…ŒìŠ¤íŠ¸ & íŠœë‹ | 1-2ì‹œê°„ | â­â­â­ |
| **í•©ê³„** | **12-16ì‹œê°„** | |

---

## ë‹¤ìŒ ë‹¨ê³„

Phase 3 ì™„ë£Œ í›„ **Phase 4: ë©€í‹°ëª¨ë‹¬ í†µí•© ë¶„ì„ & ë¦¬í¬íŠ¸**ë¡œ ì´ë™:
- í‘œì • + ìŒì„± + STT + CBT í†µí•© ë¶„ì„
- ì„¸ì…˜ë³„ ì¢…í•© ë¦¬í¬íŠ¸ ìë™ ìƒì„±
- ê°ì • íƒ€ì„ë¼ì¸ ì‹œê°í™”
- PDF ë¦¬í¬íŠ¸ ìƒì„±

ìƒì„¸ ê°€ì´ë“œ: `docs/STEP4_GUIDE.md` (ë‹¤ìŒ ë¬¸ì„œ)

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-01-17
**ë¬¸ì„œ ë²„ì „**: 1.0.0
**ì‘ì„±ì**: BeMore ê°œë°œíŒ€
