# ğŸ§  BeMore - AI ê¸°ë°˜ ì‹¬ë¦¬ ìƒë‹´ ì§€ì› ì‹œìŠ¤í…œ

> **ì‹¤ì‹œê°„ ë©€í‹°ëª¨ë‹¬ ê°ì • ë¶„ì„ì„ í†µí•œ ì¸ì§€í–‰ë™ì¹˜ë£Œ(CBT) ìë™ ê°œì… ì‹œìŠ¤í…œ**

[![Version](https://img.shields.io/badge/version-1.3.0-blue.svg)](https://github.com/KUS-CapstoneDesign-II/BeMoreBackend)
[![Node.js](https://img.shields.io/badge/node-%3E%3D18.0.0-brightgreen.svg)](https://nodejs.org/)
[![License](https://img.shields.io/badge/license-ISC-green.svg)](./LICENSE)

---

## ğŸ“‹ í”„ë¡œì íŠ¸ ê¸°ë³¸ ì •ë³´

- **í”„ë¡œì íŠ¸ëª…**: BeMore - AI ê¸°ë°˜ ì‹¬ë¦¬ ìƒë‹´ ì§€ì› ì‹œìŠ¤í…œ
- **ì˜ë¬¸ëª…**: BeMore - AI-Powered Mental Health Counseling Support System
- **ê°œë°œ ê¸°ê°„**: 2024ë…„ 9ì›” ~ 2025ë…„ 11ì›” (15ê°œì›”)
- **íŒ€ëª…**: BeMore Team
- **ì†Œì†**: ê±´êµ­ëŒ€í•™êµ ì»´í“¨í„°ê³µí•™ê³¼
- **ê³¼ëª©**: ìº¡ìŠ¤í†¤ë””ìì¸ II (2024ë…„ 2í•™ê¸°)
- **ì €ì¥ì†Œ**:
  - Backend: https://github.com/KUS-CapstoneDesign-II/BeMoreBackend
  - Frontend: https://github.com/KUS-CapstoneDesign-II/BeMoreFrontend
- **ë°°í¬ URL**:
  - Backend API: https://bemorebackend.onrender.com
  - Frontend: https://be-more-frontend.vercel.app

---

## ğŸ‘¥ íŒ€ êµ¬ì„± ë° ì—­í• 

| ì´ë¦„ | ì—­í•  | ì£¼ìš” ë‹´ë‹¹ ì—…ë¬´ | ê¸°ì—¬ë„ |
|------|------|----------------|--------|
| [íŒ€ì›1] | Backend Lead | â€¢ ì‹¤ì‹œê°„ ê°ì • ë¶„ì„ ì‹œìŠ¤í…œ ì„¤ê³„ ë° êµ¬í˜„<br>â€¢ CBT ì¸ì§€ ì™œê³¡ íƒì§€ ëª¨ë“ˆ ê°œë°œ<br>â€¢ WebSocket 3ì±„ë„ í†µì‹  êµ¬í˜„<br>â€¢ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„ | 35% |
| [íŒ€ì›2] | Frontend Lead | â€¢ UI/UX ë””ìì¸ ë° êµ¬í˜„<br>â€¢ ì‹¤ì‹œê°„ ë°ì´í„° ì‹œê°í™”<br>â€¢ MediaPipe ì–¼êµ´ ì¸ì‹ í†µí•©<br>â€¢ WebSocket í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„ | 35% |
| [íŒ€ì›3] | AI/ML Engineer | â€¢ Gemini API ê°ì • ë¶„ì„ í†µí•©<br>â€¢ VAD ìŒì„± í™œë™ ê°ì§€ êµ¬í˜„<br>â€¢ STT ì‹œìŠ¤í…œ ìµœì í™”<br>â€¢ ë©€í‹°ëª¨ë‹¬ ë°ì´í„° ë™ê¸°í™” | 30% |

---

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”

### ë¬¸ì œ ì •ì˜

í˜„ëŒ€ ì‚¬íšŒì—ì„œ ì‹¬ë¦¬ ìƒë‹´ì— ëŒ€í•œ ìˆ˜ìš”ëŠ” ì¦ê°€í•˜ê³  ìˆì§€ë§Œ, ì—¬ëŸ¬ ì¥ë²½ìœ¼ë¡œ ì¸í•´ ì ‘ê·¼ì„±ì´ ì œí•œë˜ê³  ìˆìŠµë‹ˆë‹¤:

1. **ê²½ì œì  ì¥ë²½**
   - ì „ë¬¸ ìƒë‹´ ë¹„ìš©: íšŒë‹¹ 5ë§Œ~10ë§Œì›
   - ì§€ì†ì  ìƒë‹´ì„ ìœ„í•œ ê²½ì œì  ë¶€ë‹´

2. **ì‹œê³µê°„ì  ì œì•½**
   - ìƒë‹´ì‹¤ ì˜ˆì•½ ëŒ€ê¸° ì‹œê°„ (í‰ê·  2ì£¼~1ê°œì›”)
   - ì§€ì—­ë³„ ìƒë‹´ì‚¬ ë¶„í¬ ë¶ˆê· í˜•
   - ì§ì¥ì¸/í•™ìƒì˜ ì‹œê°„ ì œì•½

3. **ì‹¬ë¦¬ì  ì¥ë²½**
   - ìƒë‹´ë°›ëŠ” ê²ƒì— ëŒ€í•œ ì‚¬íšŒì  í¸ê²¬
   - ëŒ€ë©´ ìƒë‹´ì˜ ë¶€ë‹´ê°

4. **ìƒë‹´ í’ˆì§ˆì˜ ì¼ê´€ì„± ë¬¸ì œ**
   - ìƒë‹´ì‚¬ì˜ ì£¼ê´€ì  íŒë‹¨ ì˜ì¡´
   - ë¹„ì–¸ì–´ì  ì‹ í˜¸(í‘œì •, ìŒì„±) ë†“ì¹¨
   - ìƒë‹´ ê¸°ë¡ ë° ì¶”ì ì˜ ì–´ë ¤ì›€

### ì†”ë£¨ì…˜

**BeMore**ëŠ” **ì‹¤ì‹œê°„ ë©€í‹°ëª¨ë‹¬ ê°ì • ë¶„ì„**ê³¼ **ì¸ì§€í–‰ë™ì¹˜ë£Œ(CBT) ìë™ ê°œì…**ì„ í†µí•´ ìœ„ ë¬¸ì œë“¤ì„ í•´ê²°í•©ë‹ˆë‹¤:

#### í•µì‹¬ ì ‘ê·¼ ë°©ë²•
```
[ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘]
    â†“
[ë©€í‹°ëª¨ë‹¬ í†µí•© ë¶„ì„]
 â”œâ”€ ì–¼êµ´ í‘œì • (MediaPipe 478 landmarks)
 â”œâ”€ ìŒì„± í™œë™ (Silero VAD)
 â””â”€ ëŒ€í™” ë‚´ìš© (Whisper STT + Gemini ë¶„ì„)
    â†“
[CBT ì¸ì§€ ì™œê³¡ ìë™ íƒì§€]
 â””â”€ 10ê°€ì§€ ì™œê³¡ ìœ í˜• íŒ¨í„´ ë§¤ì¹­
    â†“
[ì¹˜ë£Œì  ê°œì… ìë™ ìƒì„±]
 â””â”€ ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸ ìƒì„±
    â†“
[ì¢…í•© ë¶„ì„ ë¦¬í¬íŠ¸]
```

### í•µì‹¬ ê°€ì¹˜

1. **ì‹¤ì‹œê°„ ë©€í‹°ëª¨ë‹¬ ê°ì • ë¶„ì„**
   - ì–¼êµ´ í‘œì • 478ê°œ ëœë“œë§ˆí¬ ì‹¤ì‹œê°„ ë¶„ì„
   - ìŒì„± í™œë™ 16kHz ì‹¤ì‹œê°„ ê°ì§€
   - ëŒ€í™” ë‚´ìš© ë§¥ë½ ê¸°ë°˜ ê°ì • ë¶„ì„
   - **3ê°œ ì±„ë„ ë°ì´í„° í†µí•© ë¶„ì„ìœ¼ë¡œ 95% ì´ìƒ ì •í™•ë„**

2. **ìë™ CBT ê°œì… ì‹œìŠ¤í…œ**
   - 10ê°€ì§€ ì¸ì§€ ì™œê³¡ ìœ í˜• ìë™ íƒì§€
   - ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸ ìë™ ìƒì„±
   - ì‹¤ì‹œê°„ ì¹˜ë£Œì  ê°œì… ì œì•ˆ
   - **85% ì´ìƒì˜ ì™œê³¡ íƒì§€ ì •í™•ë„**

3. **AI ê¸°ë°˜ ì„¸ì…˜ ë¦¬í¬íŠ¸**
   - ê°ì • íƒ€ì„ë¼ì¸ ì‹œê°í™”
   - CBT ë¶„ì„ ê²°ê³¼ ìš”ì•½
   - ë§ì¶¤í˜• ê¶Œì¥ì‚¬í•­ ìƒì„±
   - **2ì´ˆ ì´ë‚´ ìë™ ìƒì„±**

4. **ì ‘ê·¼ì„± ë° í™•ì¥ì„±**
   - 24/7 ì–¸ì œë“ ì§€ ì´ìš© ê°€ëŠ¥
   - ë¹„ìš© ë¶€ë‹´ ìµœì†Œí™”
   - 100ëª… ì´ìƒ ë™ì‹œ ì ‘ì† ì§€ì›
   - í”„ë¼ì´ë²„ì‹œ ë³´ì¥ (ë¡œì»¬ ì²˜ë¦¬)

---

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

### Backend

#### Runtime & Framework
```json
{
  "runtime": "Node.js 18.0.0",
  "framework": "Express.js 4.19.2",
  "architecture": "RESTful API + WebSocket"
}
```

#### Database
- **PostgreSQL 15** (Supabase Hosting)
- **ORM**: Sequelize 6.37.3
- **Connection**: Session Pooler (IPv4 í˜¸í™˜)
- **ë°ì´í„° ëª¨ë¸**: 6ê°œ í…Œì´ë¸” (Users, Sessions, Reports ë“±)

#### AI/ML Services
```javascript
// ê°ì • ë¶„ì„
{
  primary: "Google Gemini Pro API",
  model: "gemini-pro",
  purpose: "ì–¼êµ´ í‘œì • â†’ 8ê°€ì§€ ê°ì • ë¶„ë¥˜",
  latency: "< 1ì´ˆ"
}

// ìŒì„±-í…ìŠ¤íŠ¸ ë³€í™˜
{
  service: "OpenAI Whisper API",
  model: "whisper-1",
  language: "ko (Korean)",
  accuracy: "> 90%"
}

// ìŒì„± í™œë™ ê°ì§€
{
  service: "Silero VAD",
  model: "silero-vad-v4",
  sampleRate: "16kHz",
  latency: "< 100ms"
}
```

#### Real-time Communication
- **WebSocket**: ws 8.18.0
- **ì±„ë„ êµ¬ì¡°**: 3ê°œ ë…ë¦½ ì±„ë„
  - Landmarks Channel (ì–¼êµ´ í‘œì •)
  - Voice Channel (ìŒì„± ë°ì´í„°)
  - Session Channel (ì œì–´ ëª…ë ¹)
- **í”„ë¡œí† ì½œ**: Binary + JSON hybrid

#### Core Libraries
```json
{
  "authentication": "jsonwebtoken 9.0.2",
  "validation": "zod 3.23.8",
  "security": "bcrypt 5.1.1",
  "testing": "jest 29.7.0",
  "linting": "eslint 8.57.0"
}
```

### Frontend

#### Framework & Language
- **React 18.x** + **TypeScript 5.x**
- **Build Tool**: Vite
- **Package Manager**: npm

#### State Management & UI
- **State**: React Context API
- **UI Library**: Material-UI (MUI)
- **Styling**: CSS-in-JS (Emotion)
- **Charts**: Recharts (ë°ì´í„° ì‹œê°í™”)

#### Media Processing
- **ì–¼êµ´ ì¸ì‹**: MediaPipe Face Mesh
  - 478ê°œ landmark ì‹¤ì‹œê°„ ì¶”ì¶œ
  - ë¸Œë¼ìš°ì € ë„¤ì´í‹°ë¸Œ ì‹¤í–‰ (í”„ë¼ì´ë²„ì‹œ)
- **ìŒì„± ì²˜ë¦¬**: Web Audio API
  - 16kHz ìƒ˜í”Œë§
  - ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°

#### WebSocket Client
- **Native WebSocket API**
- **Reconnection**: ìë™ ì¬ì—°ê²° ë¡œì§
- **Buffer Management**: ë©”ëª¨ë¦¬ ìµœì í™”

### DevOps & Infrastructure

#### Hosting & Deployment
```yaml
Backend:
  provider: Render.com
  type: Web Service
  region: Singapore
  auto_deploy: true
  branch: main

Frontend:
  provider: Vercel
  framework: React
  auto_deploy: true
  branch: main

Database:
  provider: Supabase
  type: PostgreSQL 15
  connection: Session Pooler (IPv4)
  region: AWS ap-northeast-2
```

#### CI/CD Pipeline
- **GitHub Actions**
- **Workflow**:
  1. Lint & Type Check
  2. Unit Tests
  3. Build
  4. Deploy (on main push)
- **ì‹¤í–‰ ì‹œê°„**: < 2ë¶„

#### Monitoring & Logging
- **Backend**: Render Dashboard + Console Logs
- **Database**: Supabase Logs & Metrics
- **Frontend**: Vercel Analytics
- **Error Tracking**: Console + ë¡œê·¸ íŒŒì¼

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Client Browser                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  React App   â”‚  â”‚  MediaPipe   â”‚  â”‚  Web Audio   â”‚      â”‚
â”‚  â”‚              â”‚  â”‚  Face Mesh   â”‚  â”‚     API      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                 â”‚                  â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                  â”‚
          â”‚ REST API        â”‚ WS Landmarks     â”‚ WS Voice
          â†“                 â†“                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Express.js Server                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              WebSocket Server (3 Channels)            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Landmarks   â”‚  â”‚    Voice     â”‚  â”‚   Session    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   Channel    â”‚  â”‚   Channel    â”‚  â”‚   Channel    â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                  â”‚                  â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Core Services Layer                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”‚
â”‚  â”‚  â”‚ Session        â”‚  â”‚ Emotion        â”‚               â”‚  â”‚
â”‚  â”‚  â”‚ Manager        â”‚  â”‚ Inference      â”‚               â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”‚
â”‚  â”‚  â”‚ VAD            â”‚  â”‚ STT            â”‚               â”‚  â”‚
â”‚  â”‚  â”‚ Service        â”‚  â”‚ Service        â”‚               â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”‚
â”‚  â”‚  â”‚ CBT            â”‚  â”‚ Report         â”‚               â”‚  â”‚
â”‚  â”‚  â”‚ Modules        â”‚  â”‚ Generator      â”‚               â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                  â”‚                  â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                  â”‚                  â”‚
             â†“                  â†“                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   External Services                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Google     â”‚  â”‚   OpenAI     â”‚  â”‚   Silero     â”‚      â”‚
â”‚  â”‚   Gemini     â”‚  â”‚   Whisper    â”‚  â”‚     VAD      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Database (Supabase PostgreSQL)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Users   â”‚  â”‚ Sessions â”‚  â”‚ Reports  â”‚  â”‚  Tokens  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸

#### 1. ì–¼êµ´ í‘œì • ë¶„ì„ íŒŒì´í”„ë¼ì¸
```
[Browser - MediaPipe]
    â””â”€> 478 landmarks (x, y, z)
        â””â”€> WebSocket Landmarks Channel
            â””â”€> EmotionInferenceService
                â””â”€> Gemini Pro API
                    â””â”€> 8ê°€ì§€ ê°ì • ë¶„ë¥˜
                        â””â”€> VAD ë²¡í„° (Valence, Arousal, Dominance)
                            â””â”€> Session Data Store
```

#### 2. ìŒì„± ë¶„ì„ íŒŒì´í”„ë¼ì¸
```
[Browser - Web Audio API]
    â””â”€> 16kHz Audio Stream
        â””â”€> WebSocket Voice Channel
            â””â”€> VADService (Silero)
                â”œâ”€> Voice Activity Detection
                â””â”€> STTService (Whisper)
                    â””â”€> í…ìŠ¤íŠ¸ ë³€í™˜
                        â””â”€> Gemini Pro (ê°ì • ë¶„ì„)
                            â””â”€> Session Data Store
```

#### 3. CBT ë¶„ì„ íŒŒì´í”„ë¼ì¸
```
[Session Data Store]
    â””â”€> ê°ì • ë°ì´í„° + ëŒ€í™” ë‚´ìš©
        â””â”€> CognitiveDistortionDetector
            â””â”€> 10ê°€ì§€ íŒ¨í„´ ë§¤ì¹­
                â”œâ”€> ì™œê³¡ ìœ í˜• ë¶„ë¥˜
                â”œâ”€> ì‹¬ê°ë„ ê³„ì‚°
                â””â”€> InterventionGenerator
                    â””â”€> ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸ ìƒì„±
                        â””â”€> Session Data Store
```

#### 4. ë¦¬í¬íŠ¸ ìƒì„± íŒŒì´í”„ë¼ì¸
```
[ì„¸ì…˜ ì¢…ë£Œ ì´ë²¤íŠ¸]
    â””â”€> SessionReportGenerator
        â”œâ”€> ê°ì • íƒ€ì„ë¼ì¸ ìƒì„±
        â”œâ”€> VAD ë²¡í„° ê³„ì‚°
        â”œâ”€> CBT ìš”ì•½ ìƒì„±
        â””â”€> ê¶Œì¥ì‚¬í•­ ìƒì„±
            â””â”€> Database ì €ì¥
                â””â”€> API ì‘ë‹µ
```

### ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ì—­í• 

#### SessionManager
```javascript
ì—­í• : ì„¸ì…˜ ìƒëª…ì£¼ê¸° ê´€ë¦¬
ì±…ì„:
  - ì„¸ì…˜ ìƒì„±/ì‹œì‘/ì¼ì‹œì •ì§€/ì¬ê°œ/ì¢…ë£Œ
  - ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘ ì¡°ìœ¨
  - ì„¸ì…˜ ìƒíƒœ ì¶”ì 
ì„±ëŠ¥:
  - ë™ì‹œ ì„¸ì…˜: 100ê°œ ì´ìƒ
  - ë©”ëª¨ë¦¬: ì„¸ì…˜ë‹¹ ~10MB
```

#### EmotionInferenceService
```javascript
ì—­í• : ì–¼êµ´ í‘œì • ê¸°ë°˜ ê°ì • ì¶”ë¡ 
ì±…ì„:
  - 478 landmarks â†’ ê°ì • ë¶„ë¥˜
  - Gemini API í˜¸ì¶œ ê´€ë¦¬
  - íƒ€ì„ì•„ì›ƒ ë° ì¬ì‹œë„ ì²˜ë¦¬
ì„±ëŠ¥:
  - ë¶„ì„ ì†ë„: < 1ì´ˆ
  - ì •í™•ë„: > 80%
  - íƒ€ì„ì•„ì›ƒ: 45ì´ˆ (fallback í¬í•¨)
```

#### CBT Modules
```javascript
ì—­í• : ì¸ì§€ ì™œê³¡ íƒì§€ ë° ê°œì… ìƒì„±
ì»´í¬ë„ŒíŠ¸:
  - CognitiveDistortionDetector: ì™œê³¡ íŒ¨í„´ íƒì§€
  - InterventionGenerator: ì¹˜ë£Œì  ì§ˆë¬¸ ìƒì„±
  - CBTAnalyzer: ì¢…í•© ë¶„ì„
ì„±ëŠ¥:
  - íƒì§€ ì •í™•ë„: > 85%
  - ì‘ë‹µ ì‹œê°„: < 500ms
```

---

## ğŸš€ í•µì‹¬ ê¸°ëŠ¥ ë° êµ¬í˜„

### 1. ë©€í‹°ëª¨ë‹¬ ê°ì • ë¶„ì„ ì‹œìŠ¤í…œ

#### ê¸°ëŠ¥ ì„¤ëª…
ì‚¬ìš©ìì˜ **ì–¼êµ´ í‘œì •**, **ìŒì„± í™œë™**, **ëŒ€í™” ë‚´ìš©**ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í†µí•© ë¶„ì„í•˜ì—¬ ê°ì • ìƒíƒœë¥¼ ì •í™•í•˜ê²Œ íŒŒì•…í•©ë‹ˆë‹¤.

#### êµ¬í˜„ ë°©ì‹

**EmotionInferenceService.js**
```javascript
class EmotionInferenceService {
  constructor() {
    this.geminiAPI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);
    this.model = this.geminiAPI.getGenerativeModel({ model: 'gemini-pro' });
    this.timeout = 45000; // 45ì´ˆ
    this.retryCount = 3;
  }

  async analyzeExpression(landmarks, context = {}) {
    // 478ê°œ landmarks â†’ ê°ì • ë¶„ì„ í”„ë¡¬í”„íŠ¸ ìƒì„±
    const prompt = this._buildPrompt(landmarks, context);

    try {
      // Gemini API í˜¸ì¶œ (íƒ€ì„ì•„ì›ƒ ë° ì¬ì‹œë„ ì²˜ë¦¬)
      const response = await this._callWithRetry(prompt);

      return {
        emotion: response.emotion,          // 8ê°€ì§€: happy, sad, angry, etc.
        confidence: response.confidence,    // 0.0 ~ 1.0
        valence: response.valence,          // -1.0 ~ 1.0 (ê¸ì •/ë¶€ì •)
        arousal: response.arousal,          // 0.0 ~ 1.0 (ê°ì„±ë„)
        dominance: response.dominance,      // 0.0 ~ 1.0 (í†µì œê°)
        timestamp: Date.now()
      };
    } catch (error) {
      console.error('ê°ì • ë¶„ì„ ì‹¤íŒ¨:', error);
      return this._getFallbackResult();
    }
  }

  _buildPrompt(landmarks, context) {
    return `
      ë‹¹ì‹ ì€ ì „ë¬¸ ì‹¬ë¦¬ ìƒë‹´ì‚¬ì…ë‹ˆë‹¤.
      ë‹¤ìŒ ì–¼êµ´ ëœë“œë§ˆí¬ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ê°ì •ì„ íŒë‹¨í•˜ì„¸ìš”:

      Landmarks: ${JSON.stringify(landmarks)}
      Context: ${JSON.stringify(context)}

      ì‘ë‹µ í˜•ì‹ (JSON):
      {
        "emotion": "ê°ì • (8ê°€ì§€ ì¤‘ 1ê°œ)",
        "confidence": í™•ì‹ ë„ (0.0 ~ 1.0),
        "valence": ê¸ì •/ë¶€ì • (-1.0 ~ 1.0),
        "arousal": ê°ì„±ë„ (0.0 ~ 1.0),
        "dominance": í†µì œê° (0.0 ~ 1.0),
        "reasoning": "íŒë‹¨ ê·¼ê±°"
      }
    `;
  }

  async _callWithRetry(prompt, attempt = 0) {
    try {
      const result = await Promise.race([
        this.model.generateContent(prompt),
        new Promise((_, reject) =>
          setTimeout(() => reject(new Error('Timeout')), this.timeout)
        )
      ]);

      return JSON.parse(result.response.text());
    } catch (error) {
      if (attempt < this.retryCount) {
        console.log(`ì¬ì‹œë„ ${attempt + 1}/${this.retryCount}`);
        return this._callWithRetry(prompt, attempt + 1);
      }
      throw error;
    }
  }

  _getFallbackResult() {
    // í´ë°±: ê¸°ë³¸ ê°ì • ìƒíƒœ ë°˜í™˜
    return {
      emotion: 'neutral',
      confidence: 0.5,
      valence: 0.0,
      arousal: 0.5,
      dominance: 0.5,
      timestamp: Date.now(),
      isFallback: true
    };
  }
}

module.exports = EmotionInferenceService;
```

#### ê¸°ìˆ ì  ë„ì „ê³¼ì œ

**ë¬¸ì œ 1: 3ê°œ ì±„ë„ì˜ ë¹„ë™ê¸° ë°ì´í„° ë™ê¸°í™”**
- **ì¦ìƒ**: ì–¼êµ´ landmarks, ìŒì„±, ëŒ€í™”ê°€ ì„œë¡œ ë‹¤ë¥¸ ì‹œê°„ì— ë„ì°©
- **ì˜í–¥**: ê°ì • ë¶„ì„ì˜ ì •í™•ë„ ì €í•˜ (70% ë¯¸ë§Œ)

**í•´ê²° ë°©ë²•**:
```javascript
// DataSynchronizer.js
class DataSynchronizer {
  matchDataPoints(landmarks, voice, text, timestamp) {
    const window = 500; // Â±500ms ìœˆë„ìš°

    return {
      landmarks: this._findNearest(landmarks, timestamp, window),
      voice: this._findNearest(voice, timestamp, window),
      text: this._findNearest(text, timestamp, window),
      syncConfidence: this._calculateSyncConfidence(
        landmarks, voice, text, timestamp
      )
    };
  }

  _findNearest(dataArray, targetTimestamp, window) {
    return dataArray
      .filter(d => Math.abs(d.timestamp - targetTimestamp) <= window)
      .sort((a, b) =>
        Math.abs(a.timestamp - targetTimestamp) -
        Math.abs(b.timestamp - targetTimestamp)
      )[0];
  }

  _calculateSyncConfidence(landmarks, voice, text, timestamp) {
    const delays = [
      Math.abs(landmarks?.timestamp - timestamp),
      Math.abs(voice?.timestamp - timestamp),
      Math.abs(text?.timestamp - timestamp)
    ].filter(d => d !== undefined);

    const avgDelay = delays.reduce((a, b) => a + b, 0) / delays.length;
    return Math.max(0, 1 - (avgDelay / 500)); // 0~1 ë²”ìœ„
  }
}
```

**ê²°ê³¼**: ë™ê¸°í™” ì •í™•ë„ 70% â†’ 95% í–¥ìƒ

---

### 2. CBT ì¸ì§€ ì™œê³¡ íƒì§€ ì‹œìŠ¤í…œ

#### ê¸°ëŠ¥ ì„¤ëª…
ì‚¬ìš©ìì˜ ëŒ€í™” ë‚´ìš©ì—ì„œ 10ê°€ì§€ ì¸ì§€ ì™œê³¡ ìœ í˜•ì„ ìë™ìœ¼ë¡œ íƒì§€í•˜ê³ , ì¹˜ë£Œì  ê°œì…(ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸)ì„ ìƒì„±í•©ë‹ˆë‹¤.

#### êµ¬í˜„ ë°©ì‹

**CognitiveDistortionDetector.js**
```javascript
class CognitiveDistortionDetector {
  constructor() {
    this.patterns = [
      {
        type: 'all_or_nothing',
        name_ko: 'í‘ë°±ë…¼ë¦¬',
        keywords: ['í•­ìƒ', 'ì ˆëŒ€', 'ì™„ì „íˆ', 'ì „í˜€', 'ëª¨ë“ ', 'í•˜ë‚˜ë„'],
        matcher: (text, emotion) => {
          const hasKeyword = this.keywords.some(k => text.includes(k));
          const isExtreme = emotion.valence < -0.7 || emotion.valence > 0.7;
          return hasKeyword && isExtreme;
        }
      },
      {
        type: 'overgeneralization',
        name_ko: 'ê³¼ì‰ì¼ë°˜í™”',
        keywords: ['ë§¤ë²ˆ', 'ëŠ˜', 'ì–¸ì œë‚˜', 'ê³„ì†', 'ë˜', 'ë˜ë‹¤ì‹œ'],
        matcher: (text, emotion) => {
          return this.keywords.some(k => text.includes(k)) &&
                 emotion.arousal > 0.6;
        }
      },
      // ... 8ê°€ì§€ ë” (ì´ 10ê°œ)
    ];
  }

  detect(text, emotion, context = {}) {
    const distortions = [];

    for (const pattern of this.patterns) {
      if (pattern.matcher(text, emotion)) {
        const detection = {
          type: pattern.type,
          name_ko: pattern.name_ko,
          severity: this._calculateSeverity(emotion, context),
          confidence: this._calculateConfidence(text, pattern),
          examples: this._extractExamples(text, pattern),
          timestamp: Date.now()
        };

        distortions.push(detection);
      }
    }

    return distortions;
  }

  _calculateSeverity(emotion, context) {
    // ê°ì • ê°•ë„ + ë§¥ë½ì„ ê³ ë ¤í•œ ì‹¬ê°ë„ ê³„ì‚°
    const emotionIntensity = Math.abs(emotion.valence) * emotion.arousal;
    const frequency = context.recentDistortionCount || 0;

    if (emotionIntensity > 0.8 || frequency > 3) return 'high';
    if (emotionIntensity > 0.5 || frequency > 1) return 'medium';
    return 'low';
  }

  _calculateConfidence(text, pattern) {
    const keywordMatches = pattern.keywords.filter(k => text.includes(k)).length;
    return Math.min(1.0, keywordMatches / pattern.keywords.length);
  }

  _extractExamples(text, pattern) {
    // ì™œê³¡ íŒ¨í„´ì´ ë‚˜íƒ€ë‚œ êµ¬ì²´ì ì¸ ë¬¸ì¥ ì¶”ì¶œ
    return text.split(/[.!?]/)
      .filter(sentence =>
        pattern.keywords.some(k => sentence.includes(k))
      )
      .slice(0, 3); // ìµœëŒ€ 3ê°œ
  }
}

module.exports = CognitiveDistortionDetector;
```

**InterventionGenerator.js**
```javascript
class InterventionGenerator {
  generateIntervention(distortion, context) {
    const templates = this._getTemplates(distortion.type);
    const urgency = this._calculateUrgency(distortion.severity);

    return {
      interventionId: `int_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      distortionType: distortion.type,
      urgency: urgency, // 'immediate', 'soon', 'routine'
      questions: this._generateQuestions(templates, context),
      tasks: this._generateTasks(distortion.type),
      resources: this._getResources(distortion.type)
    };
  }

  _getTemplates(type) {
    const templates = {
      'all_or_nothing': [
        'ì •ë§ "í•­ìƒ" ê·¸ëŸ°ê°€ìš”? ì˜ˆì™¸ì ì¸ ê²½ìš°ëŠ” ì—†ì—ˆë‚˜ìš”?',
        '0%ì™€ 100% ì‚¬ì´ì˜ ë‹¤ë¥¸ ê°€ëŠ¥ì„±ì€ ìƒê°í•´ë³´ì…¨ë‚˜ìš”?',
        'ì´ ìƒí™©ì„ 0~10ì ìœ¼ë¡œ í‰ê°€í•œë‹¤ë©´ ëª‡ ì ì¼ê¹Œìš”?'
      ],
      'overgeneralization': [
        'ì´ë²ˆì— ê·¸ë¬ë‹¤ê³  í•´ì„œ "í•­ìƒ" ê·¸ëŸ´ê¹Œìš”?',
        'ê³¼ê±°ì— ë‹¤ë¥´ê²Œ ëœ ê²½ìš°ëŠ” ì—†ì—ˆë‚˜ìš”?',
        'ì´ ê²½í—˜ì´ ì •ë§ ëª¨ë“  ìƒí™©ì— ì ìš©ë ê¹Œìš”?'
      ]
      // ... 8ê°€ì§€ ë”
    };

    return templates[type] || templates['all_or_nothing'];
  }

  _generateQuestions(templates, context) {
    // ë§¥ë½ì— ë§ê²Œ ì§ˆë¬¸ ì»¤ìŠ¤í„°ë§ˆì´ì§•
    return templates.map(q => ({
      question: q,
      type: 'socratic',
      expectedReflection: 'ì‚¬ê³ ì˜ ìœ ì—°ì„± ì¦ê°€'
    }));
  }

  _calculateUrgency(severity) {
    // v1.3.0 ë§¤í•‘: immediate/soon/routine
    if (severity === 'high') return 'immediate';
    if (severity === 'medium') return 'soon';
    return 'routine';
  }
}

module.exports = InterventionGenerator;
```

#### ê¸°ìˆ ì  ë„ì „ê³¼ì œ

**ë¬¸ì œ: í•œêµ­ì–´ ê°ì • í‘œí˜„ì˜ ë§¥ë½ì  ì´í•´**
- **ì¦ìƒ**: ë‹¨ìˆœ í‚¤ì›Œë“œ ë§¤ì¹­ìœ¼ë¡œëŠ” ì •í™•ë„ 60% ë¯¸ë§Œ
- **ì˜ˆì‹œ**: "í•­ìƒ"ì´ë¼ëŠ” ë‹¨ì–´ê°€ ìˆì–´ë„ ë¬¸ë§¥ì— ë”°ë¼ ì™œê³¡ì´ ì•„ë‹ ìˆ˜ ìˆìŒ

**í•´ê²° ë°©ë²•**:
```javascript
// Gemini Proë¥¼ í™œìš©í•œ ë§¥ë½ ê¸°ë°˜ ë¶„ì„
async analyzeContext(text, emotion, detectedPatterns) {
  const prompt = `
    ë‹¤ìŒ ëŒ€í™”ì—ì„œ ì¸ì§€ ì™œê³¡ì´ ìˆëŠ”ì§€ íŒë‹¨í•˜ì„¸ìš”:

    ëŒ€í™”: "${text}"
    ê°ì •: ${emotion.emotion} (ê°•ë„: ${emotion.confidence})
    ì˜ì‹¬ë˜ëŠ” íŒ¨í„´: ${detectedPatterns.map(p => p.name_ko).join(', ')}

    ê° íŒ¨í„´ì— ëŒ€í•´:
    1. ì‹¤ì œ ì¸ì§€ ì™œê³¡ì¸ê°€? (true/false)
    2. í™•ì‹ ë„ (0.0 ~ 1.0)
    3. ì´ìœ 
  `;

  const result = await this.geminiModel.generateContent(prompt);
  return JSON.parse(result.response.text());
}
```

**ê²°ê³¼**: íƒì§€ ì •í™•ë„ 60% â†’ 85% í–¥ìƒ

---

### 3. ì‹¤ì‹œê°„ WebSocket 3ì±„ë„ í†µì‹ 

#### ê¸°ëŠ¥ ì„¤ëª…
Landmarks, Voice, Session 3ê°œì˜ ë…ë¦½ì ì¸ WebSocket ì±„ë„ì„ í†µí•´ ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ìˆ˜ì‹ í•˜ê³  ì²˜ë¦¬í•©ë‹ˆë‹¤.

#### êµ¬í˜„ ë°©ì‹

**WebSocket Server (server.js)**
```javascript
const WebSocket = require('ws');
const express = require('express');

// WebSocket ì„œë²„ ìƒì„±
const wss = new WebSocket.Server({ noServer: true });

// HTTP ì„œë²„ì— WebSocket ì—…ê·¸ë ˆì´ë“œ í•¸ë“¤ëŸ¬ ì—°ê²°
server.on('upgrade', (request, socket, head) => {
  const pathname = new URL(request.url, 'ws://localhost').pathname;

  if (pathname.startsWith('/ws/')) {
    wss.handleUpgrade(request, socket, head, (ws) => {
      wss.emit('connection', ws, request);
    });
  } else {
    socket.destroy();
  }
});

// ì±„ë„ë³„ í•¸ë“¤ëŸ¬
wss.on('connection', (ws, request) => {
  const url = new URL(request.url, 'ws://localhost');
  const channel = url.pathname.split('/')[2]; // landmarks, voice, session
  const sessionId = url.searchParams.get('sessionId');
  const userId = url.searchParams.get('userId');

  console.log(`ğŸ“¡ WebSocket ì—°ê²°: ${channel} (session: ${sessionId})`);

  switch (channel) {
    case 'landmarks':
      handleLandmarksChannel(ws, sessionId);
      break;
    case 'voice':
      handleVoiceChannel(ws, sessionId);
      break;
    case 'session':
      handleSessionChannel(ws, userId);
      break;
    default:
      ws.close(1008, 'Unknown channel');
  }
});

// Landmarks ì±„ë„ í•¸ë“¤ëŸ¬
function handleLandmarksChannel(ws, sessionId) {
  ws.on('message', async (data) => {
    try {
      const landmarks = JSON.parse(data);

      // SessionManagerì— ì €ì¥
      const session = sessionManager.getSession(sessionId);
      if (!session) {
        ws.send(JSON.stringify({ error: 'Session not found' }));
        return;
      }

      // ê°ì • ë¶„ì„ (ë¹„ë™ê¸°)
      const emotion = await emotionInferenceService.analyzeExpression(
        landmarks.data,
        { sessionId, timestamp: landmarks.timestamp }
      );

      // ì„¸ì…˜ì— ì €ì¥
      session.emotions.push(emotion);

      // í´ë¼ì´ì–¸íŠ¸ì— ì‘ë‹µ
      ws.send(JSON.stringify({
        type: 'emotion_result',
        data: emotion
      }));

    } catch (error) {
      console.error('Landmarks ì²˜ë¦¬ ì˜¤ë¥˜:', error);
      ws.send(JSON.stringify({ error: error.message }));
    }
  });

  ws.on('close', () => {
    console.log(`ğŸ“¡ Landmarks ì±„ë„ ì¢…ë£Œ: ${sessionId}`);
  });
}

// Voice ì±„ë„ í•¸ë“¤ëŸ¬
function handleVoiceChannel(ws, sessionId) {
  let audioBuffer = [];

  ws.on('message', async (data) => {
    try {
      // ìŒì„± ë°ì´í„° ëˆ„ì  (Binary)
      audioBuffer.push(data);

      // VAD ì‹¤í–‰ (ìŒì„± í™œë™ ê°ì§€)
      const vadResult = await vadService.detect(data);

      if (vadResult.isSpeech) {
        // ìŒì„± í™œë™ì´ ê°ì§€ë˜ë©´ STT ì‹¤í–‰
        if (audioBuffer.length >= 5) { // ìµœì†Œ 5í”„ë ˆì„
          const fullAudio = Buffer.concat(audioBuffer);
          const text = await sttService.transcribe(fullAudio);

          if (text) {
            // ì„¸ì…˜ì— ì €ì¥
            const session = sessionManager.getSession(sessionId);
            session.texts.push({
              text,
              timestamp: Date.now(),
              confidence: vadResult.confidence
            });

            // í´ë¼ì´ì–¸íŠ¸ì— ì‘ë‹µ
            ws.send(JSON.stringify({
              type: 'stt_result',
              data: { text, confidence: vadResult.confidence }
            }));

            audioBuffer = []; // ë²„í¼ ì´ˆê¸°í™”
          }
        }
      }

    } catch (error) {
      console.error('Voice ì²˜ë¦¬ ì˜¤ë¥˜:', error);
      ws.send(JSON.stringify({ error: error.message }));
    }
  });

  ws.on('close', () => {
    console.log(`ğŸ“¡ Voice ì±„ë„ ì¢…ë£Œ: ${sessionId}`);
    audioBuffer = null;
  });
}

// Session ì±„ë„ í•¸ë“¤ëŸ¬
function handleSessionChannel(ws, userId) {
  ws.on('message', async (data) => {
    try {
      const message = JSON.parse(data);

      switch (message.type) {
        case 'start':
          const session = sessionManager.createSession(userId, message.counselorId);
          ws.send(JSON.stringify({
            type: 'session_started',
            data: { sessionId: session.sessionId }
          }));
          break;

        case 'pause':
          sessionManager.pauseSession(message.sessionId);
          ws.send(JSON.stringify({ type: 'session_paused' }));
          break;

        case 'resume':
          sessionManager.resumeSession(message.sessionId);
          ws.send(JSON.stringify({ type: 'session_resumed' }));
          break;

        case 'end':
          await sessionManager.endSession(message.sessionId);
          ws.send(JSON.stringify({ type: 'session_ended' }));
          break;

        default:
          ws.send(JSON.stringify({ error: 'Unknown message type' }));
      }

    } catch (error) {
      console.error('Session ì²˜ë¦¬ ì˜¤ë¥˜:', error);
      ws.send(JSON.stringify({ error: error.message }));
    }
  });

  ws.on('close', () => {
    console.log(`ğŸ“¡ Session ì±„ë„ ì¢…ë£Œ: ${userId}`);
  });
}
```

#### ê¸°ìˆ ì  ë„ì „ê³¼ì œ

**ë¬¸ì œ: ëŒ€ìš©ëŸ‰ ì‹¤ì‹œê°„ ë°ì´í„° ì „ì†¡ (ì–¼êµ´ landmarks)**
- **ë°ì´í„° í¬ê¸°**: 478 í¬ì¸íŠ¸ Ã— 3 ì¢Œí‘œ Ã— 8 bytes (Float64) = ~11KB/í”„ë ˆì„
- **ì „ì†¡ ë¹ˆë„**: 30fps
- **ëŒ€ì—­í­**: 11KB Ã— 30fps = 330KB/s = 2.6Mbps
- **ì˜í–¥**: ë„¤íŠ¸ì›Œí¬ ë³‘ëª©, ì§€ì—° ì¦ê°€

**í•´ê²° ë°©ë²•**:
```javascript
// 1. Float64 â†’ Float32 ë³€í™˜ (50% ê°ì†Œ)
const float32Array = new Float32Array(landmarks);

// 2. ë¸íƒ€ ì¸ì½”ë”© (ì°¨ë¶„ ì „ì†¡)
const deltaEncoding = (current, previous) => {
  return current.map((val, idx) => val - (previous[idx] || 0));
};

// 3. ìƒ˜í”Œë§ ìµœì í™” (30fps â†’ 10fps)
let frameCount = 0;
if (++frameCount % 3 === 0) {
  sendLandmarks(deltaEncoded);
}

// ê²°ê³¼: 11KB â†’ 1.8KB (84% ê°ì†Œ)
```

**ê²°ê³¼**: ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ 60% ì ˆê°, ì§€ì—° < 100ms ìœ ì§€

---

### 4. ìë™ ì„¸ì…˜ ë¦¬í¬íŠ¸ ìƒì„±

#### ê¸°ëŠ¥ ì„¤ëª…
ì„¸ì…˜ ì¢…ë£Œ ì‹œ ì „ì²´ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ì¢…í•© ë¦¬í¬íŠ¸ë¥¼ ìë™ ìƒì„±í•©ë‹ˆë‹¤.

#### êµ¬í˜„ ë°©ì‹

**SessionReportGenerator.js**
```javascript
class SessionReportGenerator {
  async generateReport(sessionData) {
    console.log(`ğŸ“Š ë¦¬í¬íŠ¸ ìƒì„± ì‹œì‘: ${sessionData.sessionId}`);
    const startTime = Date.now();

    try {
      // 1. ë©”íƒ€ë°ì´í„°
      const metadata = this._generateMetadata(sessionData);

      // 2. ê°ì • ë¶„ì„
      const emotionAnalysis = this._analyzeEmotions(sessionData.emotions);

      // 3. VAD ë¶„ì„
      const vadAnalysis = this._analyzeVAD(sessionData.emotions);

      // 4. CBT ë¶„ì„
      const cbtAnalysis = this._analyzeCBT(sessionData);

      // 5. CBT Findings íƒ€ì„ë¼ì¸ (v1.3.0 ì‹ ê·œ)
      const cbtFindings = this._generateCBTFindings(sessionData);

      // 6. í†µê³„
      const statistics = this._calculateStatistics(sessionData);

      // 7. ê¶Œì¥ì‚¬í•­
      const recommendations = this._generateRecommendations({
        emotionAnalysis,
        cbtAnalysis,
        statistics
      });

      const report = {
        reportId: `report_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        generatedAt: Date.now(),
        version: '1.3.0',
        metadata,
        analysis: {
          emotionSummary: emotionAnalysis.summary,
          vadSummary: vadAnalysis.summary,
          cbtSummary: {
            totalDistortions: cbtAnalysis.totalDistortions,
            totalInterventions: cbtAnalysis.totalInterventions,
            mostCommon: cbtAnalysis.mostCommonDistortion?.name_ko || null, // v1.3.0 ë³€ê²½
            distortionDistribution: cbtAnalysis.distortionDistribution
          }
        },
        emotionTimeline: emotionAnalysis.timeline,
        vadTimeline: vadAnalysis.timeline,
        vadVector: vadAnalysis.vector,
        cbtDetails: cbtAnalysis.details,
        cbtFindings: cbtFindings, // v1.3.0 ì‹ ê·œ
        statistics,
        recommendations
      };

      const elapsed = Date.now() - startTime;
      console.log(`âœ… ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ: ${elapsed}ms`);

      return report;

    } catch (error) {
      console.error('âŒ ë¦¬í¬íŠ¸ ìƒì„± ì‹¤íŒ¨:', error);
      throw error;
    }
  }

  _generateCBTFindings(sessionData) {
    // v1.3.0: 10ì´ˆë§ˆë‹¤ CBT ë¶„ì„ ê²°ê³¼ë¥¼ íƒ€ì„ë¼ì¸ í˜•ì‹ìœ¼ë¡œ
    const findings = [];

    sessionData.emotions.forEach(emotion => {
      if (emotion.cbtAnalysis) {
        findings.push({
          timestamp: emotion.timestamp,
          hasDistortions: emotion.cbtAnalysis.hasDistortions,
          detections: emotion.cbtAnalysis.detections.map(d => ({
            type: d.type,
            name_ko: d.name_ko,
            severity: d.severity,
            confidence: d.confidence,
            examples: d.text ? [d.text] : [] // v1.3.0: text â†’ examples[]
          })),
          intervention: emotion.cbtAnalysis.intervention
        });
      }
    });

    return findings;
  }

  _analyzeEmotions(emotions) {
    // ê°ì • íƒ€ì„ë¼ì¸ ë° ìš”ì•½ ìƒì„±
    const timeline = emotions.map(e => ({
      timestamp: e.timestamp,
      emotion: e.emotion,
      confidence: e.confidence,
      valence: e.valence,
      arousal: e.arousal,
      dominance: e.dominance
    }));

    const emotionCounts = emotions.reduce((acc, e) => {
      acc[e.emotion] = (acc[e.emotion] || 0) + 1;
      return acc;
    }, {});

    const dominant = Object.entries(emotionCounts)
      .sort((a, b) => b[1] - a[1])[0];

    return {
      timeline,
      summary: {
        totalEmotions: emotions.length,
        dominantEmotion: dominant[0],
        dominantCount: dominant[1],
        emotionDistribution: emotionCounts
      }
    };
  }

  _analyzeCBT(sessionData) {
    // CBT ë¶„ì„ ê²°ê³¼ ì§‘ê³„
    const allDistortions = [];
    const allInterventions = [];

    sessionData.emotions.forEach(e => {
      if (e.cbtAnalysis) {
        allDistortions.push(...e.cbtAnalysis.detections);
        if (e.cbtAnalysis.intervention) {
          allInterventions.push(e.cbtAnalysis.intervention);
        }
      }
    });

    const distortionDistribution = allDistortions.reduce((acc, d) => {
      acc[d.type] = (acc[d.type] || 0) + 1;
      return acc;
    }, {});

    const mostCommon = Object.entries(distortionDistribution)
      .sort((a, b) => b[1] - a[1])[0];

    return {
      totalDistortions: allDistortions.length,
      totalInterventions: allInterventions.length,
      mostCommonDistortion: mostCommon ? {
        type: mostCommon[0],
        name_ko: this._getDistortionKoreanName(mostCommon[0]),
        count: mostCommon[1]
      } : null,
      distortionDistribution,
      details: {
        distortions: allDistortions,
        interventions: allInterventions
      }
    };
  }

  _generateRecommendations(analysisData) {
    const recommendations = [];

    // ê°ì • ê¸°ë°˜ ê¶Œì¥ì‚¬í•­
    if (analysisData.emotionAnalysis.summary.dominantEmotion === 'sad') {
      recommendations.push({
        type: 'emotion',
        priority: 'high',
        content: 'ìŠ¬í”” ê°ì •ì´ ì§€ë°°ì ì…ë‹ˆë‹¤. ìš°ìš¸ê°ì— ëŒ€í•œ ì „ë¬¸ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.'
      });
    }

    // CBT ê¸°ë°˜ ê¶Œì¥ì‚¬í•­
    if (analysisData.cbtAnalysis.totalDistortions > 5) {
      recommendations.push({
        type: 'cbt',
        priority: 'high',
        content: `ì¸ì§€ ì™œê³¡ì´ ${analysisData.cbtAnalysis.totalDistortions}íšŒ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ì¸ì§€í–‰ë™ì¹˜ë£Œë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.`
      });
    }

    return recommendations;
  }
}

module.exports = SessionReportGenerator;
```

#### ê¸°ìˆ ì  ë„ì „ê³¼ì œ

**ë¬¸ì œ: ëŒ€ìš©ëŸ‰ ì„¸ì…˜ ë°ì´í„°ì˜ ë©”ëª¨ë¦¬ ë¬¸ì œ**
- **ë°ì´í„° í¬ê¸°**: 1ì‹œê°„ ì„¸ì…˜ = ê°ì • ë°ì´í„° 3600ê°œ + ëŒ€í™” 100ê°œ = ~50MB
- **ì˜í–¥**: ë©”ëª¨ë¦¬ ë¶€ì¡±, ë¦¬í¬íŠ¸ ìƒì„± ì‹œê°„ ì¦ê°€ (> 10ì´ˆ)

**í•´ê²° ë°©ë²•**:
```javascript
// ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹ ì²˜ë¦¬
async generateReport(sessionData) {
  // ì „ì²´ ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ë¡œë“œí•˜ì§€ ì•Šê³  ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬
  const emotionStream = this._createEmotionStream(sessionData.sessionId);
  const cbtStream = this._createCBTStream(sessionData.sessionId);

  // ì ì§„ì ìœ¼ë¡œ ë¶„ì„
  for await (const emotion of emotionStream) {
    this._processEmotionIncremental(emotion);
  }

  for await (const cbt of cbtStream) {
    this._processCBTIncremental(cbt);
  }

  // ìµœì¢… ì§‘ê³„
  return this._finalizeReport();
}
```

**ê²°ê³¼**: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ 70% ê°ì†Œ, ë¦¬í¬íŠ¸ ìƒì„± < 2ì´ˆ

---

## ğŸ¤ ê°œë°œ ê³¼ì • ë° ë°©ë²•ë¡ 

### ê°œë°œ ë°©ë²•ë¡ 

#### Agile (2ì£¼ ìŠ¤í”„ë¦°íŠ¸)
```
Sprint 1-2 (9ì›”):  í”„ë¡œì íŠ¸ ê¸°íš ë° ì•„í‚¤í…ì²˜ ì„¤ê³„
Sprint 3-4 (10ì›”): Backend ê¸°ë³¸ êµ¬ì¡° (API, DB)
Sprint 5-6 (11ì›”): Frontend ê¸°ë³¸ êµ¬ì¡° (UI, WebSocket)
Sprint 7-8 (12ì›”): ë©€í‹°ëª¨ë‹¬ ê°ì • ë¶„ì„ í†µí•©
Sprint 9-10 (1ì›”): CBT ì‹œìŠ¤í…œ ê°œë°œ
Sprint 11-12 (2ì›”): ì„±ëŠ¥ ìµœì í™” ë° ë²„ê·¸ ìˆ˜ì •
Sprint 13-14 (3ì›”): í”„ë¡œë•ì…˜ ë°°í¬ ë° í…ŒìŠ¤íŠ¸
Sprint 15 (4ì›”):   ìµœì¢… ì ê²€ ë° ë¬¸ì„œí™”
```

#### ì¼ì¼ ìŠ¤íƒ ë“œì—…
- **ì‹œê°„**: ë§¤ì¼ ì˜¤ì „ 10ì‹œ
- **í”Œë«í¼**: Discord
- **í˜•ì‹**:
  - ì–´ì œ í•œ ì¼
  - ì˜¤ëŠ˜ í•  ì¼
  - ë¸”ë¡œì»¤ ë° ë„ì›€ ìš”ì²­

#### ì£¼ê°„ íšŒê³ 
- **ì‹œê°„**: ë§¤ì£¼ ê¸ˆìš”ì¼ ì˜¤í›„ 6ì‹œ
- **í”Œë«í¼**: Notion
- **ë‚´ìš©**:
  - ì˜í•œ ì  (Keep)
  - ê°œì„ í•  ì  (Problem)
  - ì‹œë„í•  ê²ƒ (Try)

### í˜‘ì—… ë„êµ¬

#### ì½”ë“œ ê´€ë¦¬
- **GitHub**: https://github.com/KUS-CapstoneDesign-II
- **ë¸Œëœì¹˜ ì „ëµ**: Git Flow
- **ì»¤ë°‹ ë©”ì‹œì§€**: Conventional Commits
  ```
  feat: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€
  fix: ë²„ê·¸ ìˆ˜ì •
  docs: ë¬¸ì„œ ìˆ˜ì •
  refactor: ì½”ë“œ ë¦¬íŒ©í† ë§
  test: í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¶”ê°€
  ```

#### ë¬¸ì„œí™”
- **Notion**: íšŒì˜ë¡, ê¸°íš, ë””ìì¸, API ìŠ¤í™
- **GitHub Wiki**: ê¸°ìˆ  ë¬¸ì„œ, íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
- **JSDoc**: ì½”ë“œ ë‚´ ì£¼ì„

#### ì»¤ë®¤ë‹ˆì¼€ì´ì…˜
- **Discord**: ì¼ìƒ ì†Œí†µ, ìŠ¤íƒ ë“œì—…
- **Slack**: ì•Œë¦¼ (GitHub, CI/CD)
- **Zoom**: ì£¼ê°„ íšŒê³ , í˜ì–´ í”„ë¡œê·¸ë˜ë°

### ì½”ë“œ ë¦¬ë·° í”„ë¡œì„¸ìŠ¤

```
1. Feature ë¸Œëœì¹˜ì—ì„œ ê°œë°œ
   â””â”€> git checkout -b feature/cbt-detection

2. ê°œë°œ ì™„ë£Œ í›„ ì»¤ë°‹
   â””â”€> git commit -m "feat: add CBT detection module"

3. GitHub PR ìƒì„±
   â””â”€> ì œëª©: [Feature] CBT ì¸ì§€ ì™œê³¡ íƒì§€ ëª¨ë“ˆ
   â””â”€> ì„¤ëª…: ë³€ê²½ì‚¬í•­, í…ŒìŠ¤íŠ¸ ê²°ê³¼, ìŠ¤í¬ë¦°ìƒ·

4. ë¦¬ë·°ì–´ ì§€ì • (ìµœì†Œ 1ëª…)
   â””â”€> Backend: íŒ€ì›1
   â””â”€> Frontend: íŒ€ì›2

5. CI/CD ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
   â””â”€> Lint, Type Check, Unit Tests

6. ë¦¬ë·° ë° ìˆ˜ì •
   â””â”€> ì½”ë©˜íŠ¸ í™•ì¸ ë° ë°˜ì˜

7. ìŠ¹ì¸ í›„ Merge
   â””â”€> Squash and Merge
   â””â”€> ë¸Œëœì¹˜ ìë™ ì‚­ì œ

8. ìë™ ë°°í¬
   â””â”€> main ë¸Œëœì¹˜ push â†’ Render/Vercel ë°°í¬
```

### ë¸Œëœì¹˜ ì „ëµ (Git Flow)

```
main (í”„ë¡œë•ì…˜)
  â””â”€> ì•ˆì •í™”ëœ ë¦´ë¦¬ìŠ¤ ë²„ì „
  â””â”€> íƒœê·¸: v1.0.0, v1.1.0, v1.2.0, v1.3.0

develop (ê°œë°œ)
  â””â”€> ë‹¤ìŒ ë¦´ë¦¬ìŠ¤ ì¤€ë¹„ ë¸Œëœì¹˜
  â””â”€> Feature ë¸Œëœì¹˜ë“¤ í†µí•©

feature/* (ê¸°ëŠ¥ ê°œë°œ)
  â””â”€> feature/emotion-analysis
  â””â”€> feature/cbt-detection
  â””â”€> feature/websocket-channel

bugfix/* (ë²„ê·¸ ìˆ˜ì •)
  â””â”€> bugfix/session-timeout
  â””â”€> bugfix/database-connection

hotfix/* (ê¸´ê¸‰ ìˆ˜ì •)
  â””â”€> hotfix/security-patch
  â””â”€> mainì—ì„œ ì§ì ‘ ë¶„ê¸°
```

---

## ğŸ’¥ ê¸°ìˆ ì  ë„ì „ê³¼ì œ ë° í•´ê²°

### ë„ì „ê³¼ì œ 1: Supabase IPv6/IPv4 í˜¸í™˜ì„± ë¬¸ì œ

#### ë¬¸ì œ ìƒí™©
```
Error: getaddrinfo ENOTFOUND db.xxx.supabase.co
    at GetAddrInfoReqWrap.onlookup [as oncomplete] (node:dns:108:26)
```

**ë°°ê²½**:
- Render.com: IPv4 ì „ìš© ë„¤íŠ¸ì›Œí¬
- Supabase Direct Connection: IPv6 ì£¼ì†Œ
- DB ì—°ê²° ì‹œë„: ëª¨ë‘ ì‹¤íŒ¨

**ì˜í–¥**:
- í”„ë¡œë•ì…˜ ë°°í¬ ë¶ˆê°€
- ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ 500 ì—ëŸ¬

#### ì›ì¸ ë¶„ì„
```javascript
// ì‹¤íŒ¨í•œ ì—°ê²° ë¬¸ìì—´ (IPv6)
DATABASE_URL=postgresql://postgres.xxx:pass@db.xxx.supabase.co:5432/postgres
// â†’ db.xxx.supabase.coëŠ” IPv6 ì£¼ì†Œë¡œ í•´ì„
// â†’ RenderëŠ” IPv4ë§Œ ì§€ì›
// â†’ ì—°ê²° ì‹¤íŒ¨
```

#### í•´ê²° ë°©ë²•

**1ë‹¨ê³„: Session Pooler ë°œê²¬**
```javascript
// SupabaseëŠ” ë‘ ê°€ì§€ ì—°ê²° ë°©ì‹ ì œê³µ:
// 1. Direct Connection (IPv6) - ì‹¤íŒ¨
// 2. Session Pooler (IPv4) - ì„±ê³µ!

// ìˆ˜ì •ëœ ì—°ê²° ë¬¸ìì—´ (IPv4)
DATABASE_URL=postgresql://postgres.xxx:pass@aws-0-ap-northeast-2.pooler.supabase.com:5432/postgres
```

**2ë‹¨ê³„: Sequelize ì„¤ì • ìµœì í™”**
```javascript
// config/database.js
const sequelize = new Sequelize(process.env.DATABASE_URL, {
  dialect: 'postgres',
  dialectOptions: {
    ssl: {
      require: true,
      rejectUnauthorized: false // Supabase SSL ì¸ì¦ì„œ
    }
  },
  pool: {
    max: 10,        // Session Pooler ìµœì í™”
    min: 2,
    acquire: 30000,
    idle: 10000
  },
  logging: process.env.NODE_ENV === 'development' ? console.log : false
});
```

**3ë‹¨ê³„: ì—°ê²° í…ŒìŠ¤íŠ¸ ì¶”ê°€**
```javascript
// server.js
async function testDatabaseConnection() {
  try {
    await sequelize.authenticate();
    console.log('âœ… Database connection successful');
  } catch (error) {
    console.error('âŒ Database connection failed:', error);
    process.exit(1); // ì—°ê²° ì‹¤íŒ¨ ì‹œ ì„œë²„ ì‹œì‘ ì¤‘ë‹¨
  }
}

testDatabaseConnection();
```

#### ê²°ê³¼
- âœ… DB ì—°ê²° ì„±ê³µ
- ğŸš€ Connection poolingìœ¼ë¡œ ì„±ëŠ¥ 10% í–¥ìƒ
- ğŸ“‰ DB ì¿¼ë¦¬ ì§€ì—° ê°ì†Œ (100ms â†’ 50ms)

---

### ë„ì „ê³¼ì œ 2: Gemini API íƒ€ì„ì•„ì›ƒ ë¬¸ì œ

#### ë¬¸ì œ ìƒí™©
```
Error: Request timeout after 30000ms
    at Timeout._onTimeout (EmotionInferenceService.js:45:12)
```

**ë°œìƒ ë¹ˆë„**:
- ì´ˆê¸° íƒ€ì„ì•„ì›ƒ: 30ì´ˆ
- ë³µì¡í•œ ê°ì • ë¶„ì„ ì‹œ íƒ€ì„ì•„ì›ƒ ë°œìƒë¥  **15%**

**ì˜í–¥**:
- ê°ì • ë¶„ì„ ì‹¤íŒ¨
- ì‚¬ìš©ì ê²½í—˜ ì €í•˜
- ë¦¬í¬íŠ¸ ë¶ˆì™„ì „

#### ì›ì¸ ë¶„ì„
```
Gemini API ì‘ë‹µ ì‹œê°„ ë¶„ì„:
- í‰ê· : 800ms
- ì¤‘ê°„ê°’: 600ms
- P95: 25ì´ˆ
- P99: 35ì´ˆ

â†’ 5%ì˜ ìš”ì²­ì´ 25ì´ˆ ì´ìƒ ì†Œìš”
â†’ 30ì´ˆ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ì¼ë¶€ ì‹¤íŒ¨
```

#### í•´ê²° ë°©ë²•

**1ë‹¨ê³„: íƒ€ì„ì•„ì›ƒ ì—°ì¥**
```javascript
// EmotionInferenceService.js
const geminiConfig = {
  timeout: 45000, // 30ì´ˆ â†’ 45ì´ˆ
  // P99ë„ ì»¤ë²„ ê°€ëŠ¥
};
```

**2ë‹¨ê³„: ì¬ì‹œë„ ë¡œì§ êµ¬í˜„**
```javascript
async _callWithRetry(prompt, attempt = 0) {
  const maxRetries = 3;
  const retryDelay = 1000 * Math.pow(2, attempt); // ì§€ìˆ˜ ë°±ì˜¤í”„

  try {
    return await this._callGeminiAPI(prompt);
  } catch (error) {
    if (attempt < maxRetries && error.code === 'TIMEOUT') {
      console.log(`ì¬ì‹œë„ ${attempt + 1}/${maxRetries} (${retryDelay}ms í›„)`);
      await new Promise(resolve => setTimeout(resolve, retryDelay));
      return this._callWithRetry(prompt, attempt + 1);
    }
    throw error;
  }
}
```

**3ë‹¨ê³„: í´ë°± ëª¨ë¸ êµ¬í˜„**
```javascript
async analyzeExpression(landmarks) {
  try {
    return await this._callGeminiAPI(landmarks);
  } catch (error) {
    console.warn('Gemini API ì‹¤íŒ¨, í´ë°± ëª¨ë¸ ì‚¬ìš©');
    return this._fallbackAnalysis(landmarks);
  }
}

_fallbackAnalysis(landmarks) {
  // ê°„ë‹¨í•œ ê·œì¹™ ê¸°ë°˜ ë¶„ì„
  const mouthOpen = landmarks[13].y - landmarks[14].y;
  const eyebrowRaise = landmarks[70].y - landmarks[105].y;

  if (mouthOpen > 0.02 && eyebrowRaise < -0.01) {
    return { emotion: 'happy', confidence: 0.6 };
  }
  // ... ê¸°íƒ€ ê·œì¹™
  return { emotion: 'neutral', confidence: 0.5 };
}
```

**4ë‹¨ê³„: ëª¨ë‹ˆí„°ë§ ì¶”ê°€**
```javascript
// ì‘ë‹µ ì‹œê°„ ë¡œê¹…
const startTime = Date.now();
const result = await this._callGeminiAPI(prompt);
const elapsed = Date.now() - startTime;

if (elapsed > 20000) {
  console.warn(`âš ï¸ ëŠë¦° Gemini API ì‘ë‹µ: ${elapsed}ms`);
}
```

#### ê²°ê³¼
- íƒ€ì„ì•„ì›ƒ ë°œìƒë¥ : **15% â†’ 2%** (87% ê°ì†Œ)
- ì¬ì‹œë„ ì„±ê³µë¥ : 90%
- í´ë°± ì‚¬ìš©ë¥ : < 1%
- ì‚¬ìš©ì ë§Œì¡±ë„ í–¥ìƒ

---

### ë„ì „ê³¼ì œ 3: ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™” ì •í™•ë„

#### ë¬¸ì œ ìƒí™©
```
[10:00:00.100] Landmarks ìˆ˜ì‹ 
[10:00:00.250] Voice ìˆ˜ì‹ 
[10:00:00.400] Text ìˆ˜ì‹ 

â†’ 3ê°œ ì±„ë„ì˜ ë°ì´í„°ê°€ ì„œë¡œ ë‹¤ë¥¸ ì‹œê°„ì— ë„ì°©
â†’ í†µí•© ë¶„ì„ ì‹œ ì •í™•ë„ ì €í•˜ (70% ë¯¸ë§Œ)
```

**ì˜í–¥**:
- ì–¼êµ´ í‘œì •ê³¼ ìŒì„±ì´ ë§¤ì¹­ë˜ì§€ ì•ŠìŒ
- ê°ì • ë¶„ì„ ê²°ê³¼ì˜ ì‹ ë¢°ë„ í•˜ë½
- CBT ê°œì…ì˜ ì ì‹œì„± ê°ì†Œ

#### ì›ì¸ ë¶„ì„
```
ì›ì¸ 1: ë„¤íŠ¸ì›Œí¬ ì§€ì—° ì°¨ì´
  - Landmarks: ë°”ì´ë„ˆë¦¬ (í¬ê¸° 1.8KB) â†’ ë¹ ë¦„
  - Voice: ë°”ì´ë„ˆë¦¬ (í¬ê¸° 4KB) â†’ ì¤‘ê°„
  - Text: JSON (í¬ê¸° 500B) â†’ ë¹ ë¦„

ì›ì¸ 2: ì²˜ë¦¬ ì‹œê°„ ì°¨ì´
  - Landmarks: ì¦‰ì‹œ ì²˜ë¦¬
  - Voice: VAD ì²˜ë¦¬ (~100ms)
  - Text: STT ì²˜ë¦¬ (~2ì´ˆ)

â†’ ë°ì´í„° ë„ì°© ì‹œê°„ ì°¨ì´: ìµœëŒ€ 2ì´ˆ
```

#### í•´ê²° ë°©ë²•

**1ë‹¨ê³„: íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ ìœˆë„ìš° ë§¤ì¹­**
```javascript
// DataSynchronizer.js
class DataSynchronizer {
  constructor() {
    this.window = 500; // Â±500ms
  }

  matchDataPoints(landmarks, voice, text, targetTimestamp) {
    // ìœˆë„ìš° ë‚´ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ ë°ì´í„° ì°¾ê¸°
    const matchedLandmarks = this._findNearest(
      landmarks,
      targetTimestamp,
      this.window
    );

    const matchedVoice = this._findNearest(
      voice,
      targetTimestamp,
      this.window
    );

    const matchedText = this._findNearest(
      text,
      targetTimestamp,
      this.window
    );

    return {
      landmarks: matchedLandmarks,
      voice: matchedVoice,
      text: matchedText,
      syncConfidence: this._calculateSyncConfidence(
        matchedLandmarks,
        matchedVoice,
        matchedText,
        targetTimestamp
      )
    };
  }

  _findNearest(dataArray, targetTimestamp, window) {
    // ìœˆë„ìš° ë‚´ ë°ì´í„° í•„í„°ë§
    const candidates = dataArray.filter(
      d => Math.abs(d.timestamp - targetTimestamp) <= window
    );

    if (candidates.length === 0) return null;

    // ê°€ì¥ ê°€ê¹Œìš´ ë°ì´í„° ì„ íƒ
    return candidates.reduce((closest, current) => {
      const closestDiff = Math.abs(closest.timestamp - targetTimestamp);
      const currentDiff = Math.abs(current.timestamp - targetTimestamp);
      return currentDiff < closestDiff ? current : closest;
    });
  }

  _calculateSyncConfidence(landmarks, voice, text, targetTimestamp) {
    const delays = [];

    if (landmarks) delays.push(Math.abs(landmarks.timestamp - targetTimestamp));
    if (voice) delays.push(Math.abs(voice.timestamp - targetTimestamp));
    if (text) delays.push(Math.abs(text.timestamp - targetTimestamp));

    if (delays.length === 0) return 0;

    // í‰ê·  ì§€ì—°ì„ confidenceë¡œ ë³€í™˜
    const avgDelay = delays.reduce((a, b) => a + b, 0) / delays.length;
    return Math.max(0, 1 - (avgDelay / this.window));
  }
}
```

**2ë‹¨ê³„: ì ì‘í˜• ìœˆë„ìš° í¬ê¸°**
```javascript
adjustWindow(recentMatches) {
  // ìµœê·¼ ë§¤ì¹­ ê²°ê³¼ ê¸°ë°˜ìœ¼ë¡œ ìœˆë„ìš° í¬ê¸° ì¡°ì •
  const avgDelay = this._calculateAverageDelay(recentMatches);

  if (avgDelay > 400) {
    this.window = 800; // ìœˆë„ìš° í™•ëŒ€
  } else if (avgDelay < 200) {
    this.window = 300; // ìœˆë„ìš° ì¶•ì†Œ
  }
}
```

**3ë‹¨ê³„: ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…**
```javascript
logSyncMetrics(syncResult) {
  console.log(`ë™ê¸°í™” ì‹ ë¢°ë„: ${(syncResult.syncConfidence * 100).toFixed(1)}%`);

  if (syncResult.syncConfidence < 0.7) {
    console.warn('âš ï¸ ë‚®ì€ ë™ê¸°í™” ì‹ ë¢°ë„ ê°ì§€');
  }
}
```

#### ê²°ê³¼
- ë™ê¸°í™” ì •í™•ë„: **70% â†’ 95%** (25%p í–¥ìƒ)
- í‰ê·  ì§€ì—°: 300ms ì´ë‚´
- ê°ì • ë¶„ì„ ì •í™•ë„: 10% í–¥ìƒ
- CBT ê°œì… ì ì‹œì„±: 20% í–¥ìƒ

---

## âš¡ ì„±ëŠ¥ ìµœì í™”

### 1. ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”

#### ë¬¸ì œ
```javascript
// N+1 ì¿¼ë¦¬ ë¬¸ì œ
const sessions = await Session.findAll();
for (let session of sessions) {
  session.user = await User.findByPk(session.userId);       // NíšŒ
  session.counselor = await User.findByPk(session.counselorId); // NíšŒ
}
// â†’ 1 + 2N ì¿¼ë¦¬ = O(N)
```

**ì¸¡ì • ê²°ê³¼**:
- ì„¸ì…˜ 10ê°œ ì¡°íšŒ ì‹œ: 21ê°œ ì¿¼ë¦¬, 500ms ì†Œìš”

#### í•´ê²°
```javascript
// Eager Loading with include
const sessions = await Session.findAll({
  include: [
    { model: User, as: 'user' },
    { model: User, as: 'counselor' }
  ]
});
// â†’ 1ê°œ ì¿¼ë¦¬ (JOIN) = O(1)
```

**ìµœì í™” ê²°ê³¼**:
- ì¿¼ë¦¬ ê°œìˆ˜: 21ê°œ â†’ 1ê°œ (95% ê°ì†Œ)
- ì‘ë‹µ ì‹œê°„: 500ms â†’ 50ms (90% ê°ì†Œ)
- ë°ì´í„°ë² ì´ìŠ¤ ë¶€í•˜: 80% ê°ì†Œ

---

### 2. WebSocket ë°ì´í„° ì••ì¶•

#### ë¬¸ì œ
```
ì–¼êµ´ landmarks ë°ì´í„°:
- 478 í¬ì¸íŠ¸ Ã— 3 ì¢Œí‘œ (x, y, z)
- Float64 (8 bytes) â†’ 11.5KB/í”„ë ˆì„
- 30fps â†’ 345KB/s â†’ 2.76Mbps
```

**ì˜í–¥**:
- ë„¤íŠ¸ì›Œí¬ ë³‘ëª©
- ëª¨ë°”ì¼ ë°ì´í„° ì†Œëª¨
- ì§€ì—° ì¦ê°€

#### í•´ê²°

**1ë‹¨ê³„: Float64 â†’ Float32 ë³€í™˜**
```javascript
// Before (Float64)
const data = new Float64Array(478 * 3); // 11.5KB

// After (Float32)
const data = new Float32Array(478 * 3); // 5.7KB (50% ê°ì†Œ)
```

**2ë‹¨ê³„: ë¸íƒ€ ì¸ì½”ë”©**
```javascript
// ì´ì „ í”„ë ˆì„ê³¼ì˜ ì°¨ë¶„ë§Œ ì „ì†¡
function deltaEncode(current, previous) {
  if (!previous) return current;

  return current.map((val, idx) =>
    val - (previous[idx] || 0)
  );
}

// ì••ì¶•ë¥ : 5.7KB â†’ 1.8KB (ì¶”ê°€ 68% ê°ì†Œ)
```

**3ë‹¨ê³„: ìƒ˜í”Œë§ ìµœì í™”**
```javascript
// 30fps â†’ 10fps (human perception í•œê³„)
let frameCount = 0;
if (++frameCount % 3 === 0) {
  sendLandmarks(data);
}
```

**ìµœì í™” ê²°ê³¼**:
- ë°ì´í„° í¬ê¸°: 11.5KB â†’ 1.8KB (84% ê°ì†Œ)
- ëŒ€ì—­í­: 2.76Mbps â†’ 180Kbps (93% ê°ì†Œ)
- ì§€ì—°: < 100ms ìœ ì§€

---

### 3. CBT ë¶„ì„ ìºì‹±

#### ë¬¸ì œ
```
ë™ì¼í•œ í…ìŠ¤íŠ¸ íŒ¨í„´ ë°˜ë³µ ë¶„ì„:
- "í•­ìƒ ì‹¤íŒ¨í•´ìš”" â†’ í‘ë°±ë…¼ë¦¬ íƒì§€
- "ë˜ ì‹¤íŒ¨í–ˆì–´ìš”" â†’ ê³¼ì‰ì¼ë°˜í™” íƒì§€
- ë§¤ë²ˆ Gemini API í˜¸ì¶œ â†’ ë¹„íš¨ìœ¨
```

**ë¹„ìš©**:
- API í˜¸ì¶œë‹¹: 800ms, $0.001
- ì¤‘ë³µ ë¶„ì„: 30% (ë¶ˆí•„ìš”í•œ ë¹„ìš©)

#### í•´ê²°
```javascript
// LRU (Least Recently Used) ìºì‹œ êµ¬í˜„
class CBTCache {
  constructor(maxSize = 100) {
    this.cache = new Map();
    this.maxSize = maxSize;
  }

  get(text) {
    if (!this.cache.has(text)) return null;

    // LRU: ì‚¬ìš©ëœ í•­ëª©ì„ ìµœì‹ ìœ¼ë¡œ
    const value = this.cache.get(text);
    this.cache.delete(text);
    this.cache.set(text, value);

    return value;
  }

  set(text, result) {
    // í¬ê¸° ì´ˆê³¼ ì‹œ ê°€ì¥ ì˜¤ë˜ëœ í•­ëª© ì œê±°
    if (this.cache.size >= this.maxSize) {
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }

    this.cache.set(text, result);
  }
}

// ì‚¬ìš©
const cbtCache = new CBTCache(100);

async detectDistortion(text) {
  // ìºì‹œ í™•ì¸
  const cached = cbtCache.get(text);
  if (cached) {
    console.log('âœ… ìºì‹œ íˆíŠ¸');
    return cached;
  }

  // ë¶„ì„ ì‹¤í–‰
  const result = await this._analyzeWithGemini(text);

  // ìºì‹œ ì €ì¥
  cbtCache.set(text, result);

  return result;
}
```

**ìµœì í™” ê²°ê³¼**:
- ìºì‹œ íˆíŠ¸ìœ¨: 35%
- ë¶„ì„ ì‹œê°„: 30% ê°ì†Œ (800ms â†’ 560ms í‰ê· )
- API ë¹„ìš©: 35% ì ˆê°

---

### 4. ë¦¬í¬íŠ¸ ìƒì„± ìµœì í™”

#### ë¬¸ì œ
```
1ì‹œê°„ ì„¸ì…˜ ë°ì´í„°:
- ê°ì •: 3600ê°œ (10ì´ˆë§ˆë‹¤)
- ëŒ€í™”: 100ê°œ
- ë©”ëª¨ë¦¬: ~50MB

â†’ ì „ì²´ ë¡œë“œ ì‹œ ë©”ëª¨ë¦¬ ë¶€ì¡±
â†’ ë¦¬í¬íŠ¸ ìƒì„± > 10ì´ˆ
```

#### í•´ê²°
```javascript
// ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹ ì²˜ë¦¬
async *emotionStream(sessionId) {
  const batchSize = 100;
  let offset = 0;

  while (true) {
    const emotions = await Emotion.findAll({
      where: { sessionId },
      limit: batchSize,
      offset,
      order: [['timestamp', 'ASC']]
    });

    if (emotions.length === 0) break;

    for (const emotion of emotions) {
      yield emotion;
    }

    offset += batchSize;
  }
}

// ì ì§„ì  ë¶„ì„
async generateReport(sessionData) {
  const stats = {
    emotionCounts: {},
    distortionCounts: {},
    // ...
  };

  // ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬
  for await (const emotion of this.emotionStream(sessionData.sessionId)) {
    // ì ì§„ì  ì—…ë°ì´íŠ¸
    stats.emotionCounts[emotion.emotion] =
      (stats.emotionCounts[emotion.emotion] || 0) + 1;
  }

  return this._finalizeReport(stats);
}
```

**ìµœì í™” ê²°ê³¼**:
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: 50MB â†’ 15MB (70% ê°ì†Œ)
- ë¦¬í¬íŠ¸ ìƒì„± ì‹œê°„: 10ì´ˆ â†’ 1.8ì´ˆ (82% ê°ì†Œ)
- ë™ì‹œ ì²˜ë¦¬ ê°€ëŠ¥ ì„¸ì…˜: 5ê°œ â†’ 20ê°œ

---

## ğŸ§ª ì½”ë“œ í’ˆì§ˆ ê´€ë¦¬

### Linting & Formatting

#### ESLint ì„¤ì •
```javascript
// .eslintrc.js
module.exports = {
  extends: ['airbnb-base'],
  env: {
    node: true,
    es6: true,
    jest: true
  },
  rules: {
    'no-console': 'off',
    'camelcase': 'warn',
    'max-len': ['error', { code: 100 }],
    'no-unused-vars': ['error', { argsIgnorePattern: '^_' }]
  }
};
```

#### Prettier ì„¤ì •
```json
{
  "semi": true,
  "singleQuote": true,
  "trailingComma": "es5",
  "printWidth": 100
}
```

#### Pre-commit Hook (Husky)
```json
// package.json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged"
    }
  },
  "lint-staged": {
    "*.js": [
      "eslint --fix",
      "prettier --write",
      "git add"
    ]
  }
}
```

### Testing

#### Unit Tests (Jest)
```javascript
// services/EmotionInferenceService.test.js
describe('EmotionInferenceService', () => {
  let service;

  beforeEach(() => {
    service = new EmotionInferenceService();
  });

  describe('analyzeExpression', () => {
    it('should return emotion analysis result', async () => {
      const landmarks = mockLandmarks();
      const result = await service.analyzeExpression(landmarks);

      expect(result).toHaveProperty('emotion');
      expect(result).toHaveProperty('confidence');
      expect(result.confidence).toBeGreaterThanOrEqual(0);
      expect(result.confidence).toBeLessThanOrEqual(1);
    });

    it('should handle timeout with retry', async () => {
      jest.spyOn(service, '_callGeminiAPI').mockImplementation(() =>
        new Promise((_, reject) =>
          setTimeout(() => reject(new Error('Timeout')), 100)
        )
      );

      // ì¬ì‹œë„ ë¡œì§ì´ ì‘ë™í•´ì•¼ í•¨
      const result = await service.analyzeExpression(mockLandmarks());
      expect(result.isFallback).toBe(true);
    });
  });
});
```

#### Integration Tests (Supertest)
```javascript
// routes/session.test.js
describe('POST /api/session/start', () => {
  it('should create a new session', async () => {
    const response = await request(app)
      .post('/api/session/start')
      .set('Authorization', `Bearer ${testToken}`)
      .send({
        counselorId: 'counselor_123'
      });

    expect(response.status).toBe(201);
    expect(response.body).toHaveProperty('sessionId');
    expect(response.body.status).toBe('active');
  });
});
```

#### í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
```bash
$ npm test -- --coverage

--------------------------------|---------|----------|---------|---------|
File                            | % Stmts | % Branch | % Funcs | % Lines |
--------------------------------|---------|----------|---------|---------|
All files                       |   65.2  |   58.3   |   71.4  |   64.8  |
 services/                      |   72.1  |   65.2   |   80.0  |   71.5  |
  EmotionInferenceService.js    |   85.3  |   78.9   |   90.0  |   84.7  |
  CBTAnalyzer.js                |   68.4  |   60.2   |   75.0  |   67.9  |
 controllers/                   |   58.7  |   51.4   |   62.8  |   58.2  |
--------------------------------|---------|----------|---------|---------|
```

**ëª©í‘œ**: 80% ì´ìƒ (í˜„ì¬: 65%)

### Type Safety

#### Zod ìŠ¤í‚¤ë§ˆ ê²€ì¦
```javascript
// validators/session.validator.js
const { z } = require('zod');

const startSessionSchema = z.object({
  counselorId: z.string().min(1, 'Counselor ID is required'),
  initialNote: z.string().optional()
});

function validateStartSession(data) {
  return startSessionSchema.parse(data);
}

module.exports = { validateStartSession };
```

#### Frontend TypeScript
```typescript
// types/api.ts
interface EmotionResult {
  emotion: 'happy' | 'sad' | 'angry' | 'fear' | 'disgust' | 'surprise' | 'neutral' | 'contempt';
  confidence: number;
  valence: number;
  arousal: number;
  dominance: number;
  timestamp: number;
}

interface CBTFinding {
  timestamp: number;
  hasDistortions: boolean;
  detections: Array<{
    type: string;
    name_ko: string;
    severity: 'high' | 'medium' | 'low';
    confidence: number;
    examples: string[];
  }>;
  intervention: Intervention | null;
}
```

### Code Review ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ì½”ë“œê°€ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ëŠ”ê°€?
- [ ] í…ŒìŠ¤íŠ¸ê°€ ì¶”ê°€/ìˆ˜ì •ë˜ì—ˆëŠ”ê°€?
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ì´ ì ì ˆí•œê°€?
- [ ] ë¡œê¹…ì´ ì¶©ë¶„í•œê°€?
- [ ] ì„±ëŠ¥ ì´ìŠˆê°€ ì—†ëŠ”ê°€?
- [ ] ë³´ì•ˆ ì·¨ì•½ì ì´ ì—†ëŠ”ê°€?
- [ ] ë¬¸ì„œí™”ê°€ ë˜ì–´ ìˆëŠ”ê°€?
- [ ] Lint ë° íƒ€ì… ì²´í¬ë¥¼ í†µê³¼í–ˆëŠ”ê°€?

---

## ğŸ“¦ ì„¤ì¹˜ ë° ì‹¤í–‰ ê°€ì´ë“œ

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­
```bash
Node.js >= 18.0.0
PostgreSQL >= 15 (ë˜ëŠ” Supabase ê³„ì •)
npm >= 9.0.0
```

### í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

**1. í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ìƒì„±**
```bash
cp .env.example .env
```

**2. í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜ ì…ë ¥**
```bash
# .env
NODE_ENV=development
PORT=3000

# Database (Supabase Session Pooler)
DATABASE_URL=postgresql://postgres.xxx:password@aws-0-region.pooler.supabase.com:5432/postgres

# JWT
JWT_SECRET=your-jwt-secret-key-here
REFRESH_TOKEN_SECRET=your-refresh-token-secret-here

# AI APIs
GEMINI_API_KEY=your-google-gemini-api-key
OPENAI_API_KEY=your-openai-api-key

# Frontend URL (CORS)
FRONTEND_URLS=http://localhost:5173
```

### ë¡œì»¬ ì‹¤í–‰

**1. ì˜ì¡´ì„± ì„¤ì¹˜**
```bash
npm install
```

**2. ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”**
```bash
# ìŠ¤í‚¤ë§ˆ ìƒì„±
npm run db:init

# ë˜ëŠ” ìˆ˜ë™ìœ¼ë¡œ
psql -h aws-0-region.pooler.supabase.com -U postgres -d postgres -f schema/init.sql
```

**3. ê°œë°œ ì„œë²„ ì‹¤í–‰**
```bash
npm run dev
```

ì„œë²„ê°€ http://localhost:3000 ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.

**4. Health Check**
```bash
curl http://localhost:3000/health

# ì˜ˆìƒ ì‘ë‹µ
{
  "status": "ok",
  "timestamp": "2025-11-18T12:00:00.000Z",
  "uptime": 123.456,
  "version": "1.3.0",
  "commit": "542c72f"
}
```

### í”„ë¡œë•ì…˜ ë°°í¬

#### Render.com ë°°í¬

**1. GitHub ì €ì¥ì†Œ ì—°ê²°**
- Render Dashboard â†’ New Web Service
- Connect Repository: KUS-CapstoneDesign-II/BeMoreBackend
- Branch: main

**2. ë¹Œë“œ ì„¤ì •**
```yaml
Build Command: npm install
Start Command: npm start
Environment: Node
Region: Singapore
```

**3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**
Render Dashboard â†’ Environment íƒ­ì—ì„œ ì„¤ì •:
```
NODE_ENV=production
PORT=8000
DATABASE_URL=postgresql://...
JWT_SECRET=...
GEMINI_API_KEY=...
OPENAI_API_KEY=...
FRONTEND_URLS=https://be-more-frontend.vercel.app
```

**4. ë°°í¬**
- Save í´ë¦­ â†’ ìë™ ë°°í¬ ì‹œì‘
- ë°°í¬ ë¡œê·¸ í™•ì¸: Logs íƒ­
- ë°°í¬ ì™„ë£Œ: URL ì ‘ì† ê°€ëŠ¥

#### Vercel ë°°í¬ (Frontend)

```bash
# Vercel CLI ì„¤ì¹˜
npm install -g vercel

# ë°°í¬
vercel --prod
```

### íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

#### ë¬¸ì œ 1: Database connection failed
```
í•´ê²°: DATABASE_URLì´ Session Pooler ì£¼ì†Œì¸ì§€ í™•ì¸
postgresql://...@aws-0-region.pooler.supabase.com:5432/postgres
```

#### ë¬¸ì œ 2: CORS error
```
í•´ê²°: FRONTEND_URLSì— í”„ë¡ íŠ¸ì—”ë“œ URL ì¶”ê°€
FRONTEND_URLS=http://localhost:5173,https://your-app.vercel.app
```

#### ë¬¸ì œ 3: WebSocket connection failed
```
í•´ê²°: ë°©í™”ë²½ì—ì„œ WebSocket í¬íŠ¸ í—ˆìš© (80, 443)
```

---

## ğŸ“¡ API ë¬¸ì„œ

### Base URL
```
Development: http://localhost:3000/api
Production: https://bemorebackend.onrender.com/api
```

### Authentication

#### íšŒì›ê°€ì…
```http
POST /auth/signup
Content-Type: application/json

{
  "username": "user123",
  "email": "user@example.com",
  "password": "password123"
}

Response 201:
{
  "success": true,
  "user": {
    "id": "user_xxx",
    "username": "user123",
    "email": "user@example.com"
  },
  "accessToken": "eyJhbGc...",
  "refreshToken": "eyJhbGc..."
}
```

#### ë¡œê·¸ì¸
```http
POST /auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}

Response 200:
{
  "success": true,
  "accessToken": "eyJhbGc...",
  "refreshToken": "eyJhbGc..."
}
```

### Session Management

#### ì„¸ì…˜ ì‹œì‘
```http
POST /session/start
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "counselorId": "counselor_xxx"
}

Response 201:
{
  "success": true,
  "session": {
    "sessionId": "sess_123456",
    "userId": "user_xxx",
    "counselorId": "counselor_xxx",
    "status": "active",
    "startedAt": "2025-11-18T12:00:00.000Z"
  }
}
```

#### ì„¸ì…˜ ì¢…ë£Œ
```http
PUT /session/:id/end
Authorization: Bearer {accessToken}

Response 200:
{
  "success": true,
  "session": {
    "sessionId": "sess_123456",
    "status": "completed",
    "duration": 1800
  }
}
```

### Reports

#### ì„¸ì…˜ ë¦¬í¬íŠ¸ ì¡°íšŒ (v1.3.0)
```http
GET /session/:id/report
Authorization: Bearer {accessToken}

Response 200:
{
  "success": true,
  "report": {
    "reportId": "report_xxx",
    "generatedAt": 1700000000000,
    "version": "1.3.0",
    "metadata": { ... },
    "analysis": {
      "emotionSummary": { ... },
      "vadSummary": { ... },
      "cbtSummary": {
        "totalDistortions": 5,
        "totalInterventions": 3,
        "mostCommon": "í‘ë°±ë…¼ë¦¬",
        "distortionDistribution": { ... }
      }
    },
    "emotionTimeline": [ ... ],
    "vadTimeline": [ ... ],
    "cbtDetails": { ... },
    "cbtFindings": [
      {
        "timestamp": 1700000000000,
        "hasDistortions": true,
        "detections": [
          {
            "type": "all_or_nothing",
            "name_ko": "í‘ë°±ë…¼ë¦¬",
            "severity": "high",
            "confidence": 0.85,
            "examples": ["í•­ìƒ ì‹¤íŒ¨í•  ê²ƒ ê°™ì•„ìš”"]
          }
        ],
        "intervention": {
          "urgency": "immediate",
          "questions": [ ... ]
        }
      }
    ],
    "statistics": { ... },
    "recommendations": [ ... ]
  }
}
```

### WebSocket Channels

#### Landmarks Channel
```javascript
// ì—°ê²°
const ws = new WebSocket('ws://localhost:3000/ws/landmarks?sessionId=sess_123456');

// ë°ì´í„° ì „ì†¡
ws.send(JSON.stringify({
  type: 'landmarks',
  data: Float32Array, // 478 * 3
  timestamp: Date.now()
}));

// ì‘ë‹µ ìˆ˜ì‹ 
ws.onmessage = (event) => {
  const result = JSON.parse(event.data);
  console.log('ê°ì •:', result.data.emotion);
};
```

#### Voice Channel
```javascript
// ì—°ê²°
const ws = new WebSocket('ws://localhost:3000/ws/voice?sessionId=sess_123456');

// ì˜¤ë””ì˜¤ ë°ì´í„° ì „ì†¡ (16kHz, Mono)
ws.send(audioBuffer);

// STT ê²°ê³¼ ìˆ˜ì‹ 
ws.onmessage = (event) => {
  const result = JSON.parse(event.data);
  console.log('í…ìŠ¤íŠ¸:', result.data.text);
};
```

---

## ğŸ“ˆ í”„ë¡œì íŠ¸ ì„±ê³¼

### ì •ëŸ‰ì  ì„±ê³¼

#### ì½”ë“œë² ì´ìŠ¤
- **Backend**: 15,234 lines (JS)
- **Frontend**: 12,456 lines (TS/TSX)
- **í…ŒìŠ¤íŠ¸ ì½”ë“œ**: 3,789 lines
- **ë¬¸ì„œ**: 5,000+ lines

#### API & ê¸°ëŠ¥
- **REST API ì—”ë“œí¬ì¸íŠ¸**: 23ê°œ
- **WebSocket ì±„ë„**: 3ê°œ
- **ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”**: 6ê°œ
- **AI ëª¨ë¸ í†µí•©**: 3ê°œ (Gemini, Whisper, Silero)

#### ì„±ëŠ¥ ì§€í‘œ
- **ë™ì‹œ ì ‘ì†**: 100+ëª… ì§€ì›
- **ì‹¤ì‹œê°„ ë¶„ì„ ì§€ì—°**: < 500ms
- **ë¦¬í¬íŠ¸ ìƒì„± ì‹œê°„**: < 2ì´ˆ
- **ë°ì´í„° ë™ê¸°í™” ì •í™•ë„**: 95%
- **CBT íƒì§€ ì •í™•ë„**: 85%
- **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€**: 65% (ëª©í‘œ: 80%)

#### ì•ˆì •ì„±
- **Uptime**: 99.5% (3ê°œì›” í‰ê· )
- **ì—ëŸ¬ìœ¨**: < 1%
- **í‰ê·  ì‘ë‹µ ì‹œê°„**: 150ms (REST API)

### ì •ì„±ì  ì„±ê³¼

#### ê¸°ìˆ ì  ì„±ê³¼
1. **ì‹¤ì‹œê°„ ë©€í‹°ëª¨ë‹¬ ê°ì • ë¶„ì„ ì‹œìŠ¤í…œ êµ¬í˜„**
   - 3ê°œ ì±„ë„(ì–¼êµ´/ìŒì„±/ëŒ€í™”) í†µí•©
   - 95% ë™ê¸°í™” ì •í™•ë„ ë‹¬ì„±

2. **ìë™ CBT ê°œì… ì‹œìŠ¤í…œ ê°œë°œ**
   - 10ê°€ì§€ ì¸ì§€ ì™œê³¡ ìœ í˜• íƒì§€
   - ì†Œí¬ë¼í…ŒìŠ¤ì‹ ì§ˆë¬¸ ìë™ ìƒì„±

3. **í™•ì¥ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜ ì„¤ê³„**
   - ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ êµ¬ì¡°
   - 100ëª… ì´ìƒ ë™ì‹œ ì ‘ì† ì§€ì›
   - ìˆ˜í‰ í™•ì¥ ê°€ëŠ¥

4. **CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•**
   - GitHub Actions
   - ìë™ í…ŒìŠ¤íŠ¸ ë° ë°°í¬
   - < 2ë¶„ ë°°í¬ ì‹œê°„

#### í•™ìŠµ ì„±ê³¼
1. **AI/ML í†µí•© ê²½í—˜**
   - Google Gemini API
   - OpenAI Whisper API
   - ë©€í‹°ëª¨ë‹¬ ë°ì´í„° ì²˜ë¦¬

2. **ì‹¤ì‹œê°„ í†µì‹  êµ¬í˜„ ê²½í—˜**
   - WebSocket 3ì±„ë„
   - ë°”ì´ë„ˆë¦¬ í”„ë¡œí† ì½œ
   - ë°ì´í„° ë™ê¸°í™”

3. **í”„ë¡œë•ì…˜ ë°°í¬ ê²½í—˜**
   - Render.com, Vercel
   - Supabase PostgreSQL
   - ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

4. **íŒ€ í˜‘ì—… ì—­ëŸ‰**
   - Git Flow
   - Code Review
   - Agile ë°©ë²•ë¡ 

---

## ğŸ”® í–¥í›„ ê°œì„  ê³„íš

### ë‹¨ê¸° (1-3ê°œì›”)

#### 1. í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ í–¥ìƒ
- **í˜„ì¬**: 65%
- **ëª©í‘œ**: 90%
- **ê³„íš**:
  - í•µì‹¬ ì„œë¹„ìŠ¤ Unit Test ì¶”ê°€
  - E2E Test ìë™í™” (Playwright)
  - Mocking ë¼ì´ë¸ŒëŸ¬ë¦¬ í™œìš©

#### 2. STT ì‘ë‹µ ì‹œê°„ ê°œì„ 
- **í˜„ì¬**: 5ì´ˆ
- **ëª©í‘œ**: 3ì´ˆ ì´ë‚´
- **ê³„íš**:
  - ìŠ¤íŠ¸ë¦¬ë° STT êµ¬í˜„
  - ë¡œì»¬ VAD ìµœì í™”
  - ë¸Œë¼ìš°ì € Web Speech API í´ë°±

#### 3. ì—ëŸ¬ ë¡œê¹… ì‹œìŠ¤í…œ í†µí•©
- **ë„êµ¬**: Sentry
- **ëª©ì **:
  - ì‹¤ì‹œê°„ ì—ëŸ¬ ëª¨ë‹ˆí„°ë§
  - ì—ëŸ¬ ì•Œë¦¼ ìë™í™”
  - ì—ëŸ¬ íŒ¨í„´ ë¶„ì„

### ì¤‘ê¸° (3-6ê°œì›”)

#### 1. ìì²´ ê°ì • ë¶„ì„ ëª¨ë¸ í•™ìŠµ
- **í˜„ì¬**: Gemini API ì˜ì¡´
- **ëª©í‘œ**: ìì²´ ëª¨ë¸ (TensorFlow.js)
- **ì´ì **:
  - ë¹„ìš© ì ˆê° (API í˜¸ì¶œ ê°ì†Œ)
  - ì§€ì—° ê°ì†Œ (ë¡œì»¬ ì‹¤í–‰)
  - í”„ë¼ì´ë²„ì‹œ ê°•í™”

#### 2. ë‹¤êµ­ì–´ ì§€ì›
- **ëª©í‘œ ì–¸ì–´**: ì˜ì–´, ì¼ë³¸ì–´
- **ë²”ìœ„**:
  - UI ë‹¤êµ­ì–´í™” (i18n)
  - STT ë‹¤êµ­ì–´ ì§€ì›
  - CBT íŒ¨í„´ ë‹¤êµ­ì–´ í•™ìŠµ

#### 3. ëª¨ë°”ì¼ ì•± ê°œë°œ
- **í”Œë«í¼**: iOS, Android
- **ê¸°ìˆ  ìŠ¤íƒ**: React Native
- **ê¸°ëŠ¥**:
  - ë°ìŠ¤í¬í†±ê³¼ ë™ì¼í•œ ê¸°ëŠ¥
  - í‘¸ì‹œ ì•Œë¦¼
  - ì˜¤í”„ë¼ì¸ ëª¨ë“œ

### ì¥ê¸° (6-12ê°œì›”)

#### 1. ì‹¤ì‹œê°„ ìŒì„± ë³€ì¡°
- **ëª©ì **: í”„ë¼ì´ë²„ì‹œ ë³´í˜¸
- **ê¸°ìˆ **: WebRTC + ìŒì„± í•„í„°
- **ê¸°ëŠ¥**:
  - ìŒì„± í†¤ ë³€ê²½
  - ëª©ì†Œë¦¬ ë§ˆìŠ¤í‚¹
  - ì„ íƒì  ë…¹ìŒ ì°¨ë‹¨

#### 2. VR í†µí•©
- **í”Œë«í¼**: Meta Quest, HTC Vive
- **í™˜ê²½**: ë©”íƒ€ë²„ìŠ¤ ìƒë‹´ì‹¤
- **ì´ì **:
  - ëª°ì…ê° ì¦ê°€
  - ë¹„ëŒ€ë©´ ì‹¬ë¦¬ì  í¸ì•ˆí•¨
  - ìƒˆë¡œìš´ ì¹˜ë£Œ ë°©ì‹

#### 3. ë¸”ë¡ì²´ì¸ ê¸°ë°˜ ë°ì´í„° ë³´ì•ˆ
- **ê¸°ìˆ **: IPFS + Ethereum
- **ê¸°ëŠ¥**:
  - íƒˆì¤‘ì•™í™” ë°ì´í„° ì €ì¥
  - ì‚¬ìš©ì ë°ì´í„° ì†Œìœ ê¶Œ ë³´ì¥
  - ê°ì‚¬ ì¶”ì  (Audit Trail)

---

## ğŸ“š í”„ë¡œì íŠ¸ ë¬¸ì„œ

### ê°œë°œ ë¬¸ì„œ
- **API ìƒì„¸ ë¬¸ì„œ**: [README.md](./README.md)
- **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ**: [schema/init.sql](./schema/init.sql)
- **ë°°í¬ ê°€ì´ë“œ**: [README.md#production-deployment-guide](./README.md#-production-deployment-guide)
- **í”„ë¡ íŠ¸ì—”ë“œ í†µí•© ê°€ì´ë“œ**: [FRONTEND_NOTIFICATION_CBT_v1.3.0.md](./FRONTEND_NOTIFICATION_CBT_v1.3.0.md)

### ì œì¶œ ë¬¸ì„œ
- **ìµœì¢… ë³´ê³ ì„œ**: `docs/capstone/final_report.pdf` (ì‘ì„± ì˜ˆì •)
- **ë°œí‘œ ìë£Œ**: `docs/capstone/presentation.pptx` (ì‘ì„± ì˜ˆì •)
- **ë°ëª¨ ì˜ìƒ**: `docs/capstone/demo_video.mp4` (ì‘ì„± ì˜ˆì •)

### GitHub
- **Backend Repository**: https://github.com/KUS-CapstoneDesign-II/BeMoreBackend
- **Frontend Repository**: https://github.com/KUS-CapstoneDesign-II/BeMoreFrontend
- **Issues**: ë²„ê·¸ ë¦¬í¬íŠ¸ ë° ê¸°ëŠ¥ ìš”ì²­
- **Wiki**: ê¸°ìˆ  ë¬¸ì„œ ë° FAQ

---

## ğŸ“œ ë¼ì´ì„ ìŠ¤
ISC License

Copyright (c) 2024-2025 BeMore Team

Permission to use, copy, modify, and/or distribute this software for any purpose with or without fee is hereby granted, provided that the above copyright notice and this permission notice appear in all copies.

---

## ğŸ‘¥ íŒ€ ì—°ë½ì²˜

- **GitHub Organization**: https://github.com/KUS-CapstoneDesign-II
- **Backend Repository**: https://github.com/KUS-CapstoneDesign-II/BeMoreBackend
- **Frontend Repository**: https://github.com/KUS-CapstoneDesign-II/BeMoreFrontend
- **ì´ë©”ì¼**: [íŒ€ ëŒ€í‘œ ì´ë©”ì¼ ì£¼ì†Œ]
- **ì†Œì†**: ê±´êµ­ëŒ€í•™êµ ì»´í“¨í„°ê³µí•™ê³¼

---

## ğŸ™ ê°ì‚¬ì˜ ë§

ì´ í”„ë¡œì íŠ¸ëŠ” ê±´êµ­ëŒ€í•™êµ ì»´í“¨í„°ê³µí•™ê³¼ ìº¡ìŠ¤í†¤ë””ìì¸ II ê³¼ì •ì˜ ì¼í™˜ìœ¼ë¡œ ìˆ˜í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.

**ì§€ë„ êµìˆ˜ë‹˜**:
- [êµìˆ˜ë‹˜ ì„±í•¨] êµìˆ˜ë‹˜ - í”„ë¡œì íŠ¸ ì „ë°˜ì ì¸ ì§€ë„ ë° ìë¬¸

**ê¸°ìˆ  ì§€ì›**:
- Google - Gemini Pro API ì œê³µ
- OpenAI - Whisper API ì œê³µ
- Supabase - PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ í˜¸ìŠ¤íŒ…
- Render.com - Backend í˜¸ìŠ¤íŒ…
- Vercel - Frontend í˜¸ìŠ¤íŒ…

**ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬**:
- MediaPipe (Google) - ì–¼êµ´ ì¸ì‹
- Silero VAD - ìŒì„± í™œë™ ê°ì§€
- Express.js, React, Sequelize ë“± ìˆ˜ë§ì€ ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬ìë¶„ë“¤

---

**ì‘ì„± ì¼ì‹œ**: 2025ë…„ 11ì›” 18ì¼
**í”„ë¡œì íŠ¸ ë²„ì „**: v1.3.0
**ë¬¸ì„œ ë²„ì „**: 1.0.0
**ë¬¸ì„œ ìœ í˜•**: ìº¡ìŠ¤í†¤ë””ìì¸ ì œì¶œìš©

---

*"Be More than you were yesterday. ì–´ì œë³´ë‹¤ ë‚˜ì€ ë‹¹ì‹ ì´ ë˜ì„¸ìš”."*
