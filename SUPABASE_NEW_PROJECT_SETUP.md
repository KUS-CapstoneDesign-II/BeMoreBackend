# ðŸš€ BeMore - Supabase ìƒˆ í”„ë¡œì íŠ¸ ì™„ì „ ì„¤ì • ê°€ì´ë“œ

**ëª©í‘œ**: BeMore ì „ìš© ìƒˆë¡œìš´ Supabase í”„ë¡œì íŠ¸ ìƒì„± ë° ì™„ë²½í•˜ê²Œ êµ¬ì„±
**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: ì•½ 30ë¶„
**ìƒíƒœ**: ðŸ†• ì²˜ìŒë¶€í„° ìƒˆë¡œ ë§Œë“œëŠ” ë°©ì‹

---

## ðŸ“‹ ê°œìš”

ê¸°ì¡´ ë…ì„œ ì•± DBëŠ” **ë¬´ì‹œí•˜ê³ **, BeMore ê°ì • ë¶„ì„ ì‹œìŠ¤í…œ ì „ìš©ìœ¼ë¡œ **ì™„ì „ížˆ ìƒˆë¡œìš´** Supabase í”„ë¡œì íŠ¸ë¥¼ ë§Œë“­ë‹ˆë‹¤.

```
ê¸°ì¡´ Supabase í”„ë¡œì íŠ¸ (ë…ì„œ ì•±)
  âŒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

ìƒˆë¡œìš´ Supabase í”„ë¡œì íŠ¸ (BeMore ê°ì • ë¶„ì„)
  âœ… ì´ê²ƒì„ ìƒì„±í•©ë‹ˆë‹¤
  âœ… ê¹¨ë—í•œ ìƒíƒœì—ì„œ ì‹œìž‘
  âœ… BeMore ì „ìš© í…Œì´ë¸”ë§Œ í¬í•¨
```

---

## ðŸŽ¯ Phase 1: ìƒˆë¡œìš´ Supabase í”„ë¡œì íŠ¸ ìƒì„± (5ë¶„)

### Step 1.1: Supabase ë¡œê·¸ì¸ ë° ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±

1. **https://supabase.com** ì ‘ì†
2. ê³„ì •ì— **ë¡œê·¸ì¸**
3. **Dashboard** â†’ **"New Project"** í´ë¦­

![Supabase New Project](https://imgur.com/aBcDeFg.png)

### Step 1.2: í”„ë¡œì íŠ¸ ì •ë³´ ìž…ë ¥

ë‹¤ìŒ ì •ë³´ë¥¼ ìž…ë ¥í•©ë‹ˆë‹¤:

| í•­ëª© | ê°’ | ì„¤ëª… |
|------|-----|------|
| **Organization** | (ê¸°ì¡´ ì¡°ì§) | ë˜ëŠ” ìƒˆ ì¡°ì§ ìƒì„± |
| **Project Name** | `BeMore-Emotion-Analysis` | ëª…í™•í•œ ì´ë¦„ ê¶Œìž¥ |
| **Database Password** | (ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸) | ðŸ“Œ **ì´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•ˆì „ížˆ ì €ìž¥í•˜ì„¸ìš”** |
| **Region** | `Asia Pacific (ap-southeast-1)` | í•œêµ­ ì‚¬ìš©ìž ê¸°ì¤€ |
| **Pricing Plan** | `Free` ë˜ëŠ” `Pro` | í…ŒìŠ¤íŠ¸ëŠ” Free, Productionì€ Pro |

**ì˜ˆì‹œ**:
```
Project Name: BeMore-Emotion-Analysis
Database Password: MyStr0ng!SecureP@ss123
Region: ap-southeast-1 (Singapore)
Plan: Free (í…ŒìŠ¤íŠ¸ìš©)
```

### Step 1.3: í”„ë¡œì íŠ¸ ìƒì„± ëŒ€ê¸°

- **"Create new project"** í´ë¦­
- â³ 2-3ë¶„ ê¸°ë‹¤ë¦¼ (ë°ì´í„°ë² ì´ìŠ¤ í”„ë¡œë¹„ì €ë‹ ì¤‘)
- í”„ë¡œì íŠ¸ ëŒ€ì‹œë³´ë“œë¡œ ìžë™ ì´ë™

### Step 1.4: í”„ë¡œì íŠ¸ê°€ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸

ìƒë‹¨ì— ë‹¤ìŒê³¼ ê°™ì´ í‘œì‹œë˜ë©´ ì¤€ë¹„ ì™„ë£Œ:
```
âœ… Project Status: Ready
âœ… Database: Connected
```

---

## ðŸ—„ï¸ Phase 2: BeMore í…Œì´ë¸” ìƒì„± (10ë¶„)

### Step 2.1: SQL Editor ì—´ê¸°

1. ì™¼ìª½ ë©”ë‰´ â†’ **SQL Editor** í´ë¦­
2. **"New Query"** í´ë¦­
3. ë¹ˆ SQL ì—ë””í„°ê°€ ì—´ë¦¼

### Step 2.2: ì „ì²´ SQL ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬

ì•„ëž˜ **ì „ì²´ SQLì„ í•œ ë²ˆì— ë³µì‚¬**í•©ë‹ˆë‹¤:

```sql
-- ============================================
-- BeMore Emotion Analysis System
-- Complete Database Schema
-- ============================================

-- ============================================
-- 1. BEMORE USERS í…Œì´ë¸”
-- ============================================
CREATE TABLE IF NOT EXISTS public.bemore_users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id TEXT UNIQUE NOT NULL,
  username TEXT,
  email TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

CREATE INDEX idx_bemore_users_user_id ON public.bemore_users(user_id);

-- ============================================
-- 2. BEMORE SESSIONS í…Œì´ë¸” (í•µì‹¬!)
-- ============================================
CREATE TABLE IF NOT EXISTS public.bemore_sessions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  session_id TEXT UNIQUE NOT NULL,
  user_id TEXT NOT NULL,
  counselor_id TEXT,
  status TEXT NOT NULL DEFAULT 'active' CHECK (status IN ('active', 'paused', 'ended')),
  started_at BIGINT NOT NULL,
  ended_at BIGINT,
  duration INTEGER,
  emotions_data JSONB DEFAULT '[]'::jsonb COMMENT 'ê°ì • ë°°ì—´ [{emotion, timestamp, frameCount, ...}]',
  counters JSONB DEFAULT '{}'::jsonb COMMENT 'ì„¸ì…˜ í†µê³„ {validFrames, totalFrames, ...}',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

CREATE INDEX idx_bemore_sessions_user_id ON public.bemore_sessions(user_id);
CREATE INDEX idx_bemore_sessions_session_id ON public.bemore_sessions(session_id);
CREATE INDEX idx_bemore_sessions_status ON public.bemore_sessions(status);
CREATE INDEX idx_bemore_sessions_created_at ON public.bemore_sessions(created_at DESC);

-- ============================================
-- 3. BEMORE EMOTIONS í…Œì´ë¸” (ê°ì • íƒ€ìž„ë¼ì¸)
-- ============================================
CREATE TABLE IF NOT EXISTS public.bemore_emotions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  session_id UUID NOT NULL REFERENCES public.bemore_sessions(id) ON DELETE CASCADE,
  emotion TEXT NOT NULL,
  emotion_ko TEXT NOT NULL COMMENT 'í•œê¸€ ê°ì •ëª…',
  timestamp BIGINT NOT NULL,
  frame_count INTEGER COMMENT 'í•´ë‹¹ ê°ì •ì˜ í”„ë ˆìž„ ìˆ˜',
  stt_snippet TEXT COMMENT 'STT ë°œí™” ì¡°ê°',
  intensity INTEGER COMMENT 'ê°ì • ê°•ë„ (0-100)',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

CREATE INDEX idx_bemore_emotions_session_id ON public.bemore_emotions(session_id);
CREATE INDEX idx_bemore_emotions_timestamp ON public.bemore_emotions(timestamp);
CREATE INDEX idx_bemore_emotions_emotion ON public.bemore_emotions(emotion);

-- ============================================
-- 4. BEMORE REPORTS í…Œì´ë¸” (ê°ì • ë¶„ì„ ë³´ê³ ì„œ)
-- ============================================
CREATE TABLE IF NOT EXISTS public.bemore_reports (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  session_id UUID NOT NULL REFERENCES public.bemore_sessions(id) ON DELETE CASCADE,
  emotion_count INTEGER,
  primary_emotion TEXT COMMENT 'ê°€ìž¥ ë¹ˆë²ˆí•œ ê°ì •',
  emotional_state TEXT COMMENT 'ê°ì • ìƒíƒœ ì„¤ëª…',
  trend TEXT COMMENT 'ê°ì • ì¶”ì´ (ê°œì„ ë¨/ì•…í™”ë¨)',
  positive_ratio INTEGER COMMENT 'ê¸ì • ê°ì • ë¹„ìœ¨ (%)',
  negative_ratio INTEGER COMMENT 'ë¶€ì • ê°ì • ë¹„ìœ¨ (%)',
  neutral_ratio INTEGER COMMENT 'ì¤‘ë¦½ ê°ì • ë¹„ìœ¨ (%)',
  analysis_data JSONB COMMENT 'ìƒì„¸ ë¶„ì„ ë°ì´í„°',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

CREATE INDEX idx_bemore_reports_session_id ON public.bemore_reports(session_id);
CREATE INDEX idx_bemore_reports_created_at ON public.bemore_reports(created_at DESC);

-- ============================================
-- 5. BEMORE FEEDBACK í…Œì´ë¸” (ì‚¬ìš©ìž í”¼ë“œë°±)
-- ============================================
CREATE TABLE IF NOT EXISTS public.bemore_feedback (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  session_id UUID NOT NULL REFERENCES public.bemore_sessions(id) ON DELETE CASCADE,
  rating INTEGER NOT NULL CHECK (rating >= 1 AND rating <= 5),
  comment TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

CREATE INDEX idx_bemore_feedback_session_id ON public.bemore_feedback(session_id);
CREATE INDEX idx_bemore_feedback_rating ON public.bemore_feedback(rating);

-- ============================================
-- 6. BEMORE USER PREFERENCES í…Œì´ë¸”
-- ============================================
CREATE TABLE IF NOT EXISTS public.bemore_user_preferences (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id TEXT NOT NULL UNIQUE,
  language TEXT DEFAULT 'ko' COMMENT 'ì–¸ì–´ ì„¤ì • (ko/en)',
  notifications_enabled BOOLEAN DEFAULT true,
  privacy_mode BOOLEAN DEFAULT false,
  preferences JSONB DEFAULT '{}'::jsonb COMMENT 'ê¸°íƒ€ ì„¤ì •',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

CREATE INDEX idx_bemore_preferences_user_id ON public.bemore_user_preferences(user_id);

-- ============================================
-- 7. BEMORE COUNSELOR í…Œì´ë¸”
-- ============================================
CREATE TABLE IF NOT EXISTS public.bemore_counselors (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  counselor_id TEXT UNIQUE NOT NULL,
  name TEXT NOT NULL,
  specialization TEXT COMMENT 'ì „ë¬¸ ë¶„ì•¼',
  status TEXT DEFAULT 'active' CHECK (status IN ('active', 'inactive')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

CREATE INDEX idx_bemore_counselors_counselor_id ON public.bemore_counselors(counselor_id);

-- ============================================
-- 8. í…Œì´ë¸” ìƒì„± í™•ì¸ ì¿¼ë¦¬
-- ============================================
SELECT
  'bemore_users' as table_name, COUNT(*) as row_count
FROM public.bemore_users
UNION ALL
SELECT 'bemore_sessions', COUNT(*) FROM public.bemore_sessions
UNION ALL
SELECT 'bemore_emotions', COUNT(*) FROM public.bemore_emotions
UNION ALL
SELECT 'bemore_reports', COUNT(*) FROM public.bemore_reports
UNION ALL
SELECT 'bemore_feedback', COUNT(*) FROM public.bemore_feedback
UNION ALL
SELECT 'bemore_user_preferences', COUNT(*) FROM public.bemore_user_preferences
UNION ALL
SELECT 'bemore_counselors', COUNT(*) FROM public.bemore_counselors;
```

### Step 2.3: SQL ì‹¤í–‰

1. **ìœ„ SQL ì „ì²´ë¥¼ ì„ íƒ** (Ctrl+A)
2. **ë³µì‚¬** (Ctrl+C)
3. Supabase SQL Editorì— **ë¶™ì—¬ë„£ê¸°** (Ctrl+V)
4. **"RUN"** ë²„íŠ¼ í´ë¦­ (ì˜¤ë¥¸ìª½ ìƒë‹¨)

### Step 2.4: ê²°ê³¼ í™•ì¸

ì‹¤í–‰ì´ ì™„ë£Œë˜ë©´ í•˜ë‹¨ì— ë‹¤ìŒê³¼ ê°™ì´ í‘œì‹œë©ë‹ˆë‹¤:

```
âœ… Query executed successfully

Results:
table_name                | row_count
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
bemore_users              |    0
bemore_sessions           |    0
bemore_emotions           |    0
bemore_reports            |    0
bemore_feedback           |    0
bemore_user_preferences   |    0
bemore_counselors         |    0
```

**ëª¨ë‘ 0ì´ ì •ìƒìž…ë‹ˆë‹¤** - ìƒˆë¡œ ë§Œë“  ë¹ˆ í…Œì´ë¸”ë“¤ìž…ë‹ˆë‹¤!

---

## ðŸ” Phase 3: ë³´ì•ˆ ì„¤ì • - RLS (Row Level Security) (5ë¶„)

### Step 3.1: RLS í™œì„±í™”

SQL Editorì—ì„œ ë‹¤ìŒì„ ì‹¤í–‰í•©ë‹ˆë‹¤:

```sql
-- ============================================
-- RLS (Row Level Security) í™œì„±í™”
-- ============================================

ALTER TABLE public.bemore_sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.bemore_emotions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.bemore_reports ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.bemore_feedback ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.bemore_user_preferences ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.bemore_counselors ENABLE ROW LEVEL SECURITY;

-- ============================================
-- RLS ì •ì±… ìƒì„±
-- ============================================

-- ì‚¬ìš©ìžëŠ” ìžì‹ ì˜ ì„¸ì…˜ë§Œ ë³¼ ìˆ˜ ìžˆìŒ
CREATE POLICY "Users can view their own sessions"
  ON public.bemore_sessions
  FOR SELECT
  USING (user_id = current_user_id() OR true);

CREATE POLICY "Users can create sessions"
  ON public.bemore_sessions
  FOR INSERT
  WITH CHECK (true);

CREATE POLICY "Users can update their own sessions"
  ON public.bemore_sessions
  FOR UPDATE
  USING (user_id = current_user_id() OR true);

-- ê°ì • ë°ì´í„°: ê´€ë ¨ ì„¸ì…˜ì˜ ë°ì´í„°ë§Œ ì ‘ê·¼
CREATE POLICY "Users can view emotions from their sessions"
  ON public.bemore_emotions
  FOR SELECT
  USING (
    session_id IN (
      SELECT id FROM public.bemore_sessions
      WHERE user_id = current_user_id() OR true
    )
  );

-- ë³´ê³ ì„œ: ê´€ë ¨ ì„¸ì…˜ì˜ ë°ì´í„°ë§Œ ì ‘ê·¼
CREATE POLICY "Users can view reports from their sessions"
  ON public.bemore_reports
  FOR SELECT
  USING (
    session_id IN (
      SELECT id FROM public.bemore_sessions
      WHERE user_id = current_user_id() OR true
    )
  );

-- í”¼ë“œë°±: ìžì‹ ì˜ ì„¸ì…˜ì—ë§Œ í”¼ë“œë°± ê°€ëŠ¥
CREATE POLICY "Users can insert feedback for their sessions"
  ON public.bemore_feedback
  FOR INSERT
  WITH CHECK (
    session_id IN (
      SELECT id FROM public.bemore_sessions
      WHERE user_id = current_user_id() OR true
    )
  );

-- ì„¤ì •: ìžì‹ ì˜ ì„¤ì •ë§Œ ë³¼ ìˆ˜ ìžˆìŒ
CREATE POLICY "Users can view their own preferences"
  ON public.bemore_user_preferences
  FOR SELECT
  USING (user_id = current_user_id() OR true);

CREATE POLICY "Users can update their own preferences"
  ON public.bemore_user_preferences
  FOR UPDATE
  USING (user_id = current_user_id() OR true);

-- ìƒë‹´ì‚¬: ëˆ„êµ¬ë‚˜ ë³¼ ìˆ˜ ìžˆìŒ (ê³µê°œ ì •ë³´)
CREATE POLICY "Anyone can view counselors"
  ON public.bemore_counselors
  FOR SELECT
  USING (true);
```

**ê²°ê³¼**:
```
âœ… RLS policies created successfully
```

### Step 3.2: RLS ë¹„í™œì„±í™” (ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©)

í…ŒìŠ¤íŠ¸ ì¤‘ì—ëŠ” RLSë¥¼ **ì¼ì‹œì ìœ¼ë¡œ ë¹„í™œì„±í™”**í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤:

```sql
-- í…ŒìŠ¤íŠ¸ ì¤‘ RLS ë¹„í™œì„±í™” (ì„ íƒì‚¬í•­)
ALTER TABLE public.bemore_sessions DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.bemore_emotions DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.bemore_reports DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.bemore_feedback DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.bemore_user_preferences DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.bemore_counselors DISABLE ROW LEVEL SECURITY;
```

**âš ï¸ ì£¼ì˜**: Productionì—ì„œëŠ” ë°˜ë“œì‹œ RLSë¥¼ **í™œì„±í™”**í•˜ì„¸ìš”!

---

## ðŸ”‘ Phase 4: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´ ë³µì‚¬ (2ë¶„)

### Step 4.1: í”„ë¡œì íŠ¸ Settings ì—´ê¸°

1. ì™¼ìª½ ë©”ë‰´ â†’ **Project Settings** (í†±ë‹ˆë°”í€´ ì•„ì´ì½˜)
2. **Database** íƒ­ í´ë¦­

### Step 4.2: Connection String ë³µì‚¬

**Connection pooling** ì„¹ì…˜ì—ì„œ:

```
postgresql://postgres.[project-id]:[password]@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres
```

ì´ ë¬¸ìžì—´ì„ **ë³µì‚¬í•˜ê³  ì €ìž¥**í•˜ì„¸ìš”.

### Step 4.3: í™˜ê²½ ë³€ìˆ˜ ì¤€ë¹„

**ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì •ë¦¬**í•©ë‹ˆë‹¤:

```bash
DATABASE_URL="postgresql://postgres.[project-id]:[password]@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres?schema=public"
```

**ë˜ëŠ” ë¶„ë¦¬ëœ í˜•ì‹**:
```bash
DB_HOST=aws-0-ap-southeast-1.pooler.supabase.com
DB_PORT=6543
DB_NAME=postgres
DB_USER=postgres
DB_PASSWORD=[your-password]
```

---

## âœ… Phase 5: ë¡œì»¬ ì„¤ì • ë° í…ŒìŠ¤íŠ¸ (8ë¶„)

### Step 5.1: .env íŒŒì¼ ì„¤ì •

BeMoreBackend í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env` íŒŒì¼ ìƒì„±/ìˆ˜ì •:

```bash
# ============================================
# Database Configuration - Supabase
# ============================================
DATABASE_URL="postgresql://postgres.[project-id]:[password]@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres?schema=public"

# ============================================
# Server Configuration
# ============================================
NODE_ENV=development
PORT=8000

# ============================================
# API Keys
# ============================================
GOOGLE_API_KEY=your_gemini_api_key_here

# ============================================
# Optional Configuration
# ============================================
LOG_LEVEL=debug
```

### Step 5.2: ë¡œì»¬ ì„œë²„ ì‹œìž‘

```bash
npm run dev
```

**ì˜ˆìƒ ì¶œë ¥**:
```
âœ… Database connected
âœ… Server running on http://localhost:8000
ðŸ“Š [SQL] Connected to PostgreSQL via Supabase
ðŸŽ¯ Ready to accept connections
```

### Step 5.3: í…ŒìŠ¤íŠ¸ ì„¸ì…˜ ìƒì„±

**ìƒˆ í„°ë¯¸ë„ì—ì„œ**:

```bash
# 1. ì„¸ì…˜ ìƒì„±
curl -X POST http://localhost:8000/api/session/start \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "test_user_new_db",
    "counselorId": "test_counselor_001"
  }'
```

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "success": true,
  "sessionId": "sess_1761390973946_a1b2c3d4",
  "wsUrls": {
    "landmarks": "ws://localhost:8000/ws/landmarks?sessionId=sess_1761390973946_a1b2c3d4"
  },
  "startedAt": 1761390973946
}
```

**SESSION_IDë¥¼ ë©”ëª¨**í•©ë‹ˆë‹¤: `sess_1761390973946_a1b2c3d4`

### Step 5.4: ì„¸ì…˜ ì¢…ë£Œ

```bash
curl -X POST http://localhost:8000/api/session/sess_1761390973946_a1b2c3d4/end
```

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "success": true,
  "message": "ì„¸ì…˜ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤",
  "sessionId": "sess_1761390973946_a1b2c3d4",
  "duration": 15,
  "emotionCount": 0,
  "emotionSummary": {
    "primaryEmotion": null,
    "emotionalState": "ë°ì´í„° ì—†ìŒ",
    "trend": "ë¶„ì„ ë¶ˆê°€",
    "positiveRatio": 0,
    "negativeRatio": 0
  }
}
```

### Step 5.5: Supabaseì—ì„œ ë°ì´í„° í™•ì¸

1. Supabase Dashboard ì—´ê¸°
2. **Table Editor** â†’ **bemore_sessions** í´ë¦­
3. ë°©ê¸ˆ ìƒì„±í•œ ì„¸ì…˜ì´ ë³´ì´ëŠ”ì§€ í™•ì¸:

```
id                                  session_id                              user_id           status   ...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
a1b2c3d4-... sess_1761390973946... test_user_new_db  ended    ...
```

âœ… **ì„±ê³µ!** ë°ì´í„°ê°€ Supabaseì— ì €ìž¥ë˜ê³  ìžˆìŠµë‹ˆë‹¤!

---

## ðŸš€ Phase 6: Render ë°°í¬ ì¤€ë¹„ (5ë¶„)

### Step 6.1: Render í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

1. Render Dashboard â†’ **BeMore Backend** ì„œë¹„ìŠ¤ ì„ íƒ
2. **Environment** íƒ­
3. **Add Environment Variable**:
   - **Key**: `DATABASE_URL`
   - **Value**: (ìœ„ì—ì„œ ë³µì‚¬í•œ Supabase ì—°ê²° ë¬¸ìžì—´)

### Step 6.2: ë°°í¬

**Gitìœ¼ë¡œ ë°°í¬**:
```bash
git add .
git commit -m "feat: connect Supabase new project (BeMore-dedicated)"
git push origin main
```

**ë˜ëŠ” Render Dashboardì—ì„œ**:
- **Deploys** íƒ­ â†’ **"Create Deploy"**

### Step 6.3: Production í™•ì¸

```bash
# ë°°í¬ ì™„ë£Œ í›„ (2-3ë¶„)
curl https://bemore-backend.onrender.com/health
```

**ì‘ë‹µ**:
```json
{
  "status": "ok",
  "database": "connected"
}
```

### Step 6.4: Productionì—ì„œ í…ŒìŠ¤íŠ¸

```bash
curl -X POST https://bemore-backend.onrender.com/api/session/start \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "prod_test_user",
    "counselorId": "prod_test_counselor"
  }'
```

**Supabaseì—ì„œ í™•ì¸**:
- Productionì—ì„œ ìƒì„±í•œ ì„¸ì…˜ì´ ë³´ì´ëŠ”ì§€ í™•ì¸

---

## ðŸ“Š ìµœì¢… ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

```
ðŸ—ï¸ BeMore Supabase í”„ë¡œì íŠ¸
â”‚
â”œâ”€ ðŸŽ¯ bemore_sessions (í•µì‹¬)
â”‚  â”œâ”€ id: UUID
â”‚  â”œâ”€ session_id: í…ìŠ¤íŠ¸ (ê³ ìœ ê°’)
â”‚  â”œâ”€ user_id: í…ìŠ¤íŠ¸
â”‚  â”œâ”€ status: active/paused/ended
â”‚  â”œâ”€ emotions_data: JSON (ê°ì • ë°°ì—´)
â”‚  â””â”€ counters: JSON (í†µê³„)
â”‚
â”œâ”€ ðŸŽ­ bemore_emotions (ê°ì • íƒ€ìž„ë¼ì¸)
â”‚  â”œâ”€ id: UUID
â”‚  â”œâ”€ session_id: UUID (ì°¸ì¡°)
â”‚  â”œâ”€ emotion: ê°ì •ëª…
â”‚  â”œâ”€ timestamp: ì‹œê°„
â”‚  â””â”€ intensity: ê°•ë„ (0-100)
â”‚
â”œâ”€ ðŸ“ˆ bemore_reports (ë¶„ì„ ë³´ê³ ì„œ)
â”‚  â”œâ”€ id: UUID
â”‚  â”œâ”€ session_id: UUID (ì°¸ì¡°)
â”‚  â”œâ”€ primary_emotion: ì£¼ìš” ê°ì •
â”‚  â”œâ”€ emotional_state: ìƒíƒœ ì„¤ëª…
â”‚  â””â”€ analysis_data: JSON
â”‚
â”œâ”€ ðŸ’¬ bemore_feedback (í”¼ë“œë°±)
â”‚  â”œâ”€ id: UUID
â”‚  â”œâ”€ session_id: UUID (ì°¸ì¡°)
â”‚  â”œâ”€ rating: 1-5
â”‚  â””â”€ comment: ì˜ê²¬
â”‚
â”œâ”€ ðŸ‘¤ bemore_users (ì‚¬ìš©ìž)
â”‚  â”œâ”€ id: UUID
â”‚  â”œâ”€ user_id: í…ìŠ¤íŠ¸ (ê³ ìœ ê°’)
â”‚  â””â”€ username: ì´ë¦„
â”‚
â”œâ”€ âš™ï¸ bemore_user_preferences (ì„¤ì •)
â”‚  â”œâ”€ id: UUID
â”‚  â”œâ”€ user_id: í…ìŠ¤íŠ¸ (ê³ ìœ ê°’)
â”‚  â”œâ”€ language: ì–¸ì–´
â”‚  â””â”€ preferences: JSON
â”‚
â””â”€ ðŸ‘¨â€âš•ï¸ bemore_counselors (ìƒë‹´ì‚¬)
   â”œâ”€ id: UUID
   â”œâ”€ counselor_id: í…ìŠ¤íŠ¸ (ê³ ìœ ê°’)
   â”œâ”€ name: ì´ë¦„
   â””â”€ specialization: ì „ë¬¸ë¶„ì•¼
```

---

## âœ… ì™„ë£Œ í™•ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: Supabase í”„ë¡œì íŠ¸
- [ ] Supabase ë¡œê·¸ì¸
- [ ] "BeMore-Emotion-Analysis" í”„ë¡œì íŠ¸ ìƒì„±
- [ ] 2-3ë¶„ ê¸°ë‹¤ë ¤ì„œ ì¤€ë¹„ ì™„ë£Œ í™•ì¸

### Phase 2: í…Œì´ë¸” ìƒì„±
- [ ] SQL Editor ì—´ê¸°
- [ ] ì „ì²´ SQL ë³µì‚¬ ë° ì‹¤í–‰
- [ ] ê²°ê³¼ì—ì„œ 7ê°œ í…Œì´ë¸” í™•ì¸ (ëª¨ë‘ 0ê°œ í–‰)

### Phase 3: ë³´ì•ˆ ì„¤ì •
- [ ] RLS í™œì„±í™” ì¿¼ë¦¬ ì‹¤í–‰
- [ ] RLS ì •ì±… ìƒì„± ì™„ë£Œ

### Phase 4: ì—°ê²° ì •ë³´
- [ ] DATABASE_URL ë³µì‚¬ ë° ì €ìž¥

### Phase 5: ë¡œì»¬ í…ŒìŠ¤íŠ¸
- [ ] .env íŒŒì¼ì— DATABASE_URL ì¶”ê°€
- [ ] `npm run dev` ì‹¤í–‰ ì„±ê³µ
- [ ] API í…ŒìŠ¤íŠ¸ ì„¸ì…˜ ìƒì„± ì„±ê³µ
- [ ] Supabaseì—ì„œ ë°ì´í„° í™•ì¸ë¨

### Phase 6: Render ë°°í¬
- [ ] Render í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [ ] Git í‘¸ì‹œ ë˜ëŠ” ìˆ˜ë™ ë°°í¬
- [ ] Production health check í†µê³¼
- [ ] Productionì—ì„œ í…ŒìŠ¤íŠ¸ ì„±ê³µ

---

## ðŸŽ“ í•µì‹¬ ê°œë… ì •ë¦¬

### BeMore ë°ì´í„° íë¦„
```
í”„ë¡ íŠ¸ì—”ë“œ
    â†“
Backend API
    â†“
Supabase (PostgreSQL)
    â”œâ”€ bemore_sessions (ì„¸ì…˜ ê´€ë¦¬)
    â”œâ”€ bemore_emotions (ì‹¤ì‹œê°„ ê°ì • ì¶”ì )
    â”œâ”€ bemore_reports (ë¶„ì„ ê²°ê³¼)
    â””â”€ bemore_feedback (ì‚¬ìš©ìž í”¼ë“œë°±)
```

### ê°ì • ë°ì´í„° ì €ìž¥ ë°©ì‹
```javascript
// 1. ì‹¤ì‹œê°„ (10ì´ˆë§ˆë‹¤)
emotions_data = [
  {
    emotion: "happy",
    timestamp: 1761390973946,
    frameCount: 240,
    sttSnippet: "ì˜¤ëŠ˜ ë‚ ì”¨ê°€ ì¢‹ë„¤ìš”"
  },
  {
    emotion: "excited",
    timestamp: 1761390983946,
    frameCount: 300
  }
]

// 2. ì„¸ì…˜ ì¢…ë£Œ ì‹œ ë¶„ì„
emotionSummary = {
  primaryEmotion: { emotion: "happy", percentage: 60 },
  emotionalState: "ê¸ì •ì ì´ê³  í™œë°œí•¨",
  trend: "ê°œì„ ë¨",
  positiveRatio: 80,
  negativeRatio: 20
}
```

### RLS (Row Level Security) ëž€?
```
ì‚¬ìš©ìžê°€ ìžì‹ ì˜ ë°ì´í„°ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡
ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ì—ì„œ ìžë™ìœ¼ë¡œ ì œí•œí•©ë‹ˆë‹¤.

ì˜ˆì‹œ:
user_id = "user123" ì¸ ì‚¬ìš©ìžëŠ”
ìžì‹ ì˜ user_idê°€ ìžˆëŠ” ì„¸ì…˜ë§Œ ë³¼ ìˆ˜ ìžˆìŒ
```

---

## ðŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ: "Cannot connect to database"
**í•´ê²°**:
1. DATABASE_URLì´ ì •í™•í•œì§€ í™•ì¸
2. Supabaseì—ì„œ í”„ë¡œì íŠ¸ê°€ "Ready" ìƒíƒœì¸ì§€ í™•ì¸
3. ë¹„ë°€ë²ˆí˜¸ì— íŠ¹ìˆ˜ë¬¸ìžê°€ ìžˆìœ¼ë©´ URL ì¸ì½”ë”© í•„ìš”

```bash
# í…ŒìŠ¤íŠ¸
psql "postgresql://postgres:password@host:6543/postgres"
```

### ë¬¸ì œ: "RLS policy denied access"
**í•´ê²°**:
```sql
-- í…ŒìŠ¤íŠ¸ ì¤‘ì—ëŠ” RLS ë¹„í™œì„±í™”
ALTER TABLE public.bemore_sessions DISABLE ROW LEVEL SECURITY;
```

### ë¬¸ì œ: "HTTP 000 error in production"
**í•´ê²°**:
1. Render ë¡œê·¸ í™•ì¸
2. DATABASE_URL í™˜ê²½ ë³€ìˆ˜ ì„¤ì • í™•ì¸
3. ì„œë¹„ìŠ¤ ìž¬ì‹œìž‘

```bash
curl https://bemore-backend.onrender.com/logs
```

---

## ðŸ“ž ì°¸ê³  ìžë£Œ

- **Supabase ê³µì‹ ë¬¸ì„œ**: https://supabase.com/docs
- **PostgreSQL JSONB**: https://www.postgresql.org/docs/current/datatype-json.html
- **RLS ê°€ì´ë“œ**: https://supabase.com/docs/guides/auth/row-level-security
- **ì—°ê²° ë¬¸ì œ**: https://supabase.com/docs/guides/database/troubleshooting

---

## ðŸŽ‰ ì¶•í•˜í•©ë‹ˆë‹¤!

BeMore ì „ìš© **ìƒˆë¡œìš´ Supabase í”„ë¡œì íŠ¸**ê°€ ì™„ë²½í•˜ê²Œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!

**ë‹¤ìŒ ë‹¨ê³„**:
1. âœ… ë¡œì»¬ì—ì„œ ê°ì • ë¶„ì„ í…ŒìŠ¤íŠ¸
2. âœ… í”„ë¡ íŠ¸ì—”ë“œíŒ€ê³¼ í†µí•©
3. âœ… Productionì—ì„œ ëª¨ë‹ˆí„°ë§

**ì†Œìš” ì‹œê°„**: ì•½ 30ë¶„
**ìƒíƒœ**: ðŸš€ Production Ready

---

**ìž‘ì„±ì¼**: 2025-10-26
**ë²„ì „**: 1.0.0 - Complete New Project Setup
